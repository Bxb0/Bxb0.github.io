<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"www.bxnop.cn",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="0x1 基础概念:   EXE文件和DLL文件基本上只是语义上的区别, 唯一区别是有一个标识字段指出EXE或DLL, 常见的PE文件格式有:DLL，EXE，OCX，SYS, SCR, CPL, OBJ等    64位的PE文件格式, 做了简单的修饰, 叫PE32+&#x2F;PE+, 32位字段扩展位64字段   PE格式的定义地方在 winnt.h 头文件中我们能在其中找到PE文件的定义  如下图VC的路"><meta property="og:type" content="article"><meta property="og:title" content="PE学习"><meta property="og:url" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/index.html"><meta property="og:site_name" content="Bxnop&#39;s blog"><meta property="og:description" content="0x1 基础概念:   EXE文件和DLL文件基本上只是语义上的区别, 唯一区别是有一个标识字段指出EXE或DLL, 常见的PE文件格式有:DLL，EXE，OCX，SYS, SCR, CPL, OBJ等    64位的PE文件格式, 做了简单的修饰, 叫PE32+&#x2F;PE+, 32位字段扩展位64字段   PE格式的定义地方在 winnt.h 头文件中我们能在其中找到PE文件的定义  如下图VC的路"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200507103628502-1590826740464.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200520084527063-1590826622690.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200508155307169-1590826775538.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200507203805570-1590826622690.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200509154933553-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200509170302585-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510143001536-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510151725862-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510151945596-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510153257760-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510154247725-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510154722496-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510160635396-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510161225077-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510161939914-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200518132004979-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519174651226-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519150821954-1590826622691.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519151445783-1590826622692.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519153011688-1590826622692.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519153843705-1590826622692.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519155230578-1590826622692.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519160556676-1590826622692.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519163851829-1590826622692.png"><meta property="og:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519164915615-1590826622692.png"><meta property="article:published_time" content="2020-05-30T08:14:50.000Z"><meta property="article:modified_time" content="2020-06-09T09:39:57.196Z"><meta property="article:author" content="BIX"><meta property="article:tag" content="系统"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200507103628502-1590826740464.png"><link rel="canonical" href="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>PE学习 | Bxnop's blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Bxnop's blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Bxnop's blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> Tags<span class="badge">2</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> Categories<span class="badge">9</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> Archives<span class="badge">22</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="BIX"><meta itemprop="description" content="0x446e37fb"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Bxnop's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> PE学习</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-05-30 16:14:50" itemprop="dateCreated datePublished" datetime="2020-05-30T16:14:50+08:00">2020-05-30</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/PE/" itemprop="url" rel="index"><span itemprop="name">PE</span></a></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">Symbols count in article:</span> <span>13k</span></span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span>12 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="0x1-基础概念"><a href="#0x1-基础概念" class="headerlink" title="0x1 基础概念:"></a>0x1 基础概念:</h2><table><thead><tr><th>EXE文件和DLL文件基本上只是语义上的区别, 唯一区别是有一个标识字段指出EXE或DLL, 常见的PE文件格式有:DLL，EXE，OCX，SYS, SCR, CPL, OBJ等</th></tr></thead><tbody><tr><td><strong>64位的PE文件格式, 做了简单的修饰, 叫PE32+/PE+, 32位字段扩展位64字段</strong></td></tr><tr><td><strong>PE格式的定义地方在 <code>winnt.h</code> 头文件中我们能在其中找到PE文件的定义</strong> <strong><em>如下图VC的路径查找</em></strong><a id="more"></a></td></tr><tr><td><img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200507103628502-1590826740464.png" alt="image-20200507103628502"></td></tr><tr><td><strong>VA是进程虚拟内存的绝对地址, RVA是相对虚拟地址 RVA+ImageBase = VA</strong></td></tr><tr><td><strong>32位的Windows OS中, 各进程都分配有4GB的虚拟内存, 所以VA范围: 00000000 ~ FFFFFFFF</strong></td></tr></tbody></table><p>PE文件总体框架.</p><p><img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200520084527063-1590826622690.png" alt="image-20200520084527063"></p><p>PE文件执行顺序.</p><table><thead><tr><th>1.执行一个PE文件时, PE装载器首先会找DOS头签名(MZ),检查是否有效, 然后是DOS头里的找 e_lfanew(最后一个成员, 指示PE头的), 如果找到, 则直接跳转.</th></tr></thead><tbody><tr><td><strong>2.找到PE头, 开始检查PE头信息属性是否有效, 如果有效, 就跳转到PE头尾部.</strong></td></tr><tr><td><strong>3.紧跟PE头尾部的是节表, PE装载器开始读取节表中记录了每个属性的信息. 平且采用文件映射将这些节映射到内存. <u>文件映射: 在执行一个PE文件的时候，Windows并不在一开始就将整个文件读入内存,而是采用与内存映射的机制,也就是说，Windows装载器在装载的时候仅仅建立好虚拟地址和PE文件之间的映射关系,只有真正执行到某个内存页中的指令或者访问某一页中的数据时,这个页面才会被从磁盘提交到物理内存,这种机制使文件装入的速度和文件大小没有太大的关系</u></strong></td></tr><tr><td><strong>4.PE文件映射入内存后, PE装载器继续处理一些逻辑结构, 如输入表的修正.</strong></td></tr></tbody></table><h2 id="0x2-MS-DOS头部及DOS存根"><a href="#0x2-MS-DOS头部及DOS存根" class="headerlink" title="0x2 MS-DOS头部及DOS存根"></a>0x2 MS-DOS头部及DOS存根</h2><table><thead><tr><th>DOS头的作用是兼容MS-DOS操作系统中的可执行文件, 该结构体大小为64字节(0x40)</th></tr></thead><tbody><tr><td><strong>2个重要成员 e_magic(DOS头第一个成员): DOS签名(4D5A -&gt; ASCII值 MZ) e_lfanew(DOS头最后一个成员): 指示NT头的偏移, 从这里找到PE头(取决于DOS存根大小)</strong></td></tr><tr><td><strong>DOS存根是DOS头与PE文件头中间部分的内容, 为16位的汇编指令组成, 既有代码也有数据, 大小不固定</strong></td></tr><tr><td><strong>我们知道DOS存根的内容是当我们的程序在DOS环境中运行时执行的代码, 也就是给一个提示信息:<code>This is program cannot be run in DOS mode</code>, 那我们是可以随便将其内容修改为自己想填充的东西, 反正不会影响在window os中的运行, 但记住这个大小是不能修改的, 会影响后面指令索引地址跟着出错, 最后程序崩溃(刚开始学习时在一道逆向题中, 就犯了这个错)</strong> <strong>如下图所示OD程序, 重要字段已标出(DOS存根从0x40 - 0x1FF)</strong></td></tr><tr><td><img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200508155307169-1590826775538.png" alt="image-20200508155307169"></td></tr></tbody></table><h2 id="0x3-NT头"><a href="#0x3-NT头" class="headerlink" title="0x3 NT头"></a>0x3 NT头</h2><p><strong>分别介绍3个结构体</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    DOWORD Signature;</span><br><span class="line">    <span class="comment">//PE头的标志 50450000</span></span><br><span class="line">    </span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;</span><br><span class="line">    <span class="comment">//文件头  size: 0xF8  记载文件的大部分属性</span></span><br><span class="line">    </span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span><br><span class="line">    <span class="comment">//可选头  very important</span></span><br><span class="line">    </span><br><span class="line">&#125;IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_FILE_HEADER</span></span></span><br><span class="line"><span class="class"> &#123;</span>											</span><br><span class="line">     WORD    Machine;</span><br><span class="line">     <span class="comment">//指出该PE文件运行的平台,每个CPU都有唯一的标识码,一般0x14c(x86)</span></span><br><span class="line">     <span class="number">014</span>C</span><br><span class="line">            </span><br><span class="line">     WORD    NumberOfSections; </span><br><span class="line">     <span class="comment">//指出文件中存在的节区数量 注:这里的定义一定要等于实际</span></span><br><span class="line">     <span class="comment">//大小, 不然程序会运行失败</span></span><br><span class="line">     <span class="number">0008</span>      </span><br><span class="line">         </span><br><span class="line">     DWORD   TimeDateStamp;</span><br><span class="line">     <span class="comment">//PE文件的创建时间，一般有连接器填写 UTC（世界标准时间）进</span></span><br><span class="line">     <span class="comment">//行存储 从1970年1月1日00:00:00算起的秒数值 我们可以用C</span></span><br><span class="line">     <span class="comment">//语言的localtime()函数(时区也会转换)计算.</span></span><br><span class="line">     <span class="number">40B</span>10868  </span><br><span class="line">         </span><br><span class="line">     DWORD   PointerToSymbolTable;</span><br><span class="line">     <span class="comment">//指向符号表COFF的指针, 用于调试信息. 发现每次看都是0</span></span><br><span class="line">     <span class="number">00000000</span></span><br><span class="line">         </span><br><span class="line">     DWORD   NumberOfSymbols;</span><br><span class="line">     <span class="comment">//符号表数量. 发现每次看都是0</span></span><br><span class="line">     <span class="number">00000000</span></span><br><span class="line">         </span><br><span class="line">     WORD    SizeOfOptionalHeader;</span><br><span class="line">     <span class="comment">//指出PE的IMAGE_OPTIONAL_HEADER32结构体或者</span></span><br><span class="line">     <span class="comment">//PE+格式文件的IMAGE_OPTIONAL_HEADER64结构体的长度</span></span><br><span class="line">     <span class="comment">//这两个结构体尺寸是不相同的，所以需要SizeOfOptionalHeader</span></span><br><span class="line">     <span class="comment">//中指明大小	32位通常位: E0  64位通常为: F0	(不是绝对的)</span></span><br><span class="line">     <span class="comment">//它们只是最小值，可能有更大的值</span></span><br><span class="line">     <span class="number">00E0</span>    </span><br><span class="line">         </span><br><span class="line">     WORD    Characteristics;</span><br><span class="line">     <span class="comment">//标识文件的属性, 文件是否可运行, 是否为DLL文件等.</span></span><br><span class="line">     <span class="comment">//二进制中每一位代表不同属性, 以 bit oR形式结合起来</span></span><br><span class="line">     <span class="comment">//2个需要记住的值. 0002h:.exe文件  2000h: .dll文件 </span></span><br><span class="line">     <span class="number">010</span>E				        </span><br><span class="line">     	     </span><br><span class="line"> &#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br><span class="line"> </span><br><span class="line"> 下图为OD程序的文件头. 在上面每个成员下面依次标出.</span><br></pre></td></tr></table></figure><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200507203805570-1590826622690.png" alt="image-20200507203805570"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">DATA_DIRECTORY</span>////定义了<span class="title">DataDirectory</span>的结构体 </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    DOWORD VirtualAddress;</span><br><span class="line">    <span class="comment">//该结构体的RVA</span></span><br><span class="line">    </span><br><span class="line">    DOWORD Size;</span><br><span class="line">    <span class="comment">//该结构体的大小</span></span><br><span class="line">&#125;IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_NUMBEROF_DIRECTORY_ENTRIES 16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER</span>   </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    WORD    Magic;</span><br><span class="line">    <span class="comment">//这个可选头的类型  PE: 10Bh   PE+: 20Bh  可以依次区分是32位还是64位</span></span><br><span class="line">    <span class="number">010B</span></span><br><span class="line">    </span><br><span class="line">    BYTE    MajorLinkerVersion;</span><br><span class="line">    <span class="comment">//链接器的版本号(不重要)</span></span><br><span class="line">    <span class="number">05</span></span><br><span class="line">    </span><br><span class="line">    BYTE    MinorLinkerVersion;</span><br><span class="line">    <span class="comment">//链接器的小版本号(不重要)</span></span><br><span class="line">    <span class="number">00</span></span><br><span class="line">    </span><br><span class="line">    DWORD   SizeOfCode;</span><br><span class="line">    <span class="comment">//代码段的长度</span></span><br><span class="line">    <span class="number">000</span>AF000</span><br><span class="line">    </span><br><span class="line">    DWORD   SizeOfInitializedData;</span><br><span class="line">    <span class="comment">//初始化的数据长度</span></span><br><span class="line">    <span class="number">0008</span>EC00</span><br><span class="line">    </span><br><span class="line">    DWORD   SizeOfUninitializedData;</span><br><span class="line">    <span class="comment">//未初始化的数据长度</span></span><br><span class="line">    <span class="number">00000000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   AddressOfEntryPoint;</span><br><span class="line">    <span class="comment">//程序EP的RVA, 指出程序最先执行代码的起始地址 (很重要)</span></span><br><span class="line">    <span class="number">00000100</span></span><br><span class="line">    </span><br><span class="line">    DWORD   BaseOfCode;</span><br><span class="line">    <span class="comment">//代码段起始地址的RVA</span></span><br><span class="line">    <span class="number">00000100</span></span><br><span class="line">    </span><br><span class="line">    DWORD   BaseOfData;</span><br><span class="line">    <span class="comment">//数据段起始地址的RVA</span></span><br><span class="line">    <span class="number">000B</span>0000</span><br><span class="line">    </span><br><span class="line">    DWORD   ImageBase;</span><br><span class="line">    <span class="comment">//VA: 0~FFFFFFFF(32位系统).PE文件加载到虚拟内存时, 指出文件优先装入地址</span></span><br><span class="line">    <span class="comment">//EXE, DLL文件被装载到0~7FFFFFFF</span></span><br><span class="line">    <span class="comment">//SYS文件载入内核内存的 80000000~FFFFFFFF</span></span><br><span class="line">    <span class="comment">//执行PE文件时,PE装载器会把EIP设置为: ImageBase+AddressOfEntrypoint</span></span><br><span class="line">    <span class="number">00400000</span>		   	 </span><br><span class="line">    				     </span><br><span class="line">    DWORD   SectionAlignment;</span><br><span class="line">    <span class="comment">//节在内存中的最小单位 (对齐单位) 一般为: 1000h</span></span><br><span class="line">    <span class="number">00001000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   FileAlignment;</span><br><span class="line">    <span class="comment">//节在磁盘文件中的最小单位 (对齐单位) 一般为: 200h</span></span><br><span class="line">    <span class="comment">//一般SectionAlignment &lt;= FileAlignment,节省储存空间.</span></span><br><span class="line">    <span class="number">00000200</span>			     </span><br><span class="line">    </span><br><span class="line">    WORD    MajorOperatingSystemVersion;</span><br><span class="line">    <span class="comment">//操作系统主版本号(不重要)</span></span><br><span class="line">    <span class="number">0004</span></span><br><span class="line">    </span><br><span class="line">    WORD    MinorOperatingSystemVersion;</span><br><span class="line">    <span class="comment">//操作系统小版本号(不重要)</span></span><br><span class="line">    <span class="number">0000</span></span><br><span class="line">    </span><br><span class="line">    WORD    MajorImageVersion;</span><br><span class="line">    <span class="comment">//映象文件主版本号, 这个是开发者自己指定的，由连接器填写(不重要)</span></span><br><span class="line">    <span class="number">0000</span></span><br><span class="line">    </span><br><span class="line">    WORD    MinorImageVersion;</span><br><span class="line">    <span class="comment">//映象文件小版本号(不重要)</span></span><br><span class="line">    <span class="number">0000</span></span><br><span class="line">    </span><br><span class="line">    WORD    MajorSubsystemVersion;</span><br><span class="line">    <span class="comment">//子系统版本号</span></span><br><span class="line">    <span class="number">0004</span></span><br><span class="line">    </span><br><span class="line">    WORD    MinorSubsystemVersion;</span><br><span class="line">    <span class="comment">//子系统小版本号</span></span><br><span class="line">    <span class="number">0000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   Win32VersionValue;</span><br><span class="line">    <span class="comment">//Win32版本值 目前看过的文件都是 0</span></span><br><span class="line">    <span class="number">00000000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   SizeOfImage;</span><br><span class="line">    <span class="comment">//指定PE image在虚拟内存中所占空间的大小 SectionAlignment的倍数</span></span><br><span class="line">    <span class="number">00180000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   SizeOfHeaders;</span><br><span class="line">    <span class="comment">//指出整个PE头的大小(FileAlignment整数倍)</span></span><br><span class="line">    <span class="comment">//它也是从文件的开头到第一节的原始数据的偏移量, 可以找到第一节区</span></span><br><span class="line">    <span class="number">00000600</span>			   </span><br><span class="line">    </span><br><span class="line">    DWORD   CheckSum;</span><br><span class="line">    <span class="comment">//映象文件的校验和 目的是为了防止载入无论如何都会冲突的、已损坏的二进制文件</span></span><br><span class="line">    <span class="number">00000000</span></span><br><span class="line">    </span><br><span class="line">    WORD    Subsystem;</span><br><span class="line">    <span class="comment">//说明映像文件应运行于什么样的NT子系统之上</span></span><br><span class="line">    <span class="comment">//该值用来区分系统驱动文件(*.sys)与普通的可执行文件(*.exe, *.dll)</span></span><br><span class="line">    <span class="comment">//value: 1   含义: Driver文件  tips: 系统驱动(如: ntfs.sys)</span></span><br><span class="line">    <span class="comment">//value: 2   含义: GUI文件	  tips: 窗口应用程序(如: notepad.exe)</span></span><br><span class="line">    <span class="comment">//value: 3   含义: CUI文件     tips: 控制台应用程序(如: cmd.exe)</span></span><br><span class="line">    <span class="number">0002</span>			   </span><br><span class="line">    				        					</span><br><span class="line">    WORD    DllCharacteristics;</span><br><span class="line">    <span class="comment">//DLL的文件属性 如果是DLL文件，何时调用DLL文件的入口点</span></span><br><span class="line">    <span class="comment">//一般的exe文件有以下2个属性:</span></span><br><span class="line">    <span class="comment">//IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE(表示支</span></span><br><span class="line">    <span class="comment">//持终端服务器)8000h  IMAGE_DLLCHARACTERISTICS_NX_COMPAT</span></span><br><span class="line">    <span class="comment">//(表示程序采用了)/NXCOMPAT编译100h  (bit or 为 81000)</span></span><br><span class="line">    <span class="comment">//但是开启了ASLR的程序会多一个</span></span><br><span class="line">    <span class="comment">//IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE(DLL can move)</span></span><br><span class="line">    <span class="comment">//40h的属性  (bit or 后为8140),那可以修改这里关闭ASLR</span></span><br><span class="line">    <span class="number">0000</span>						</span><br><span class="line">    							  													   </span><br><span class="line">    DWORD   SizeOfStackReserve;</span><br><span class="line">    <span class="comment">//保留栈的大小 默认是1MB</span></span><br><span class="line">    <span class="number">00100000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   SizeOfStackCommit;</span><br><span class="line">    <span class="comment">//初始时指定栈大小 默认是4KB</span></span><br><span class="line">    <span class="number">00020000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   SizeOfHeapReserve;</span><br><span class="line">    <span class="comment">//保留堆的大小 默认是1MB</span></span><br><span class="line">    <span class="number">01000000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   SizeOfHeapCommit;</span><br><span class="line">    <span class="comment">//指定堆大小 默认是4K</span></span><br><span class="line">    <span class="number">00001000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   LoaderFlags;</span><br><span class="line">    <span class="comment">//看到的资料都是保留 value 为 0</span></span><br><span class="line">    <span class="number">00000000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   NumberOfRvaAndSizes;</span><br><span class="line">    <span class="comment">//数据目录的项数, 即指出了我们下面一个成员数组的个数</span></span><br><span class="line">    <span class="comment">//虽然宏定义了#defineIMAGE_NUMBEROF_DIRECTORY_ENTRIES16</span></span><br><span class="line">    <span class="comment">//但是PE装载器会通过此值来识别数组大小,说明数组大小也可能非16</span></span><br><span class="line">    <span class="number">00000010</span>					   </span><br><span class="line">    							   </span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]; </span><br><span class="line">    <span class="comment">//很重要，一个数据目录，数组中的每一项记录了对于数据项的RVA及Size</span></span><br><span class="line">    <span class="comment">//重点:  EXPORT IMPORT, RESOURCE, TLS Direction</span></span><br><span class="line"> 												</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br></pre></td></tr></table></figure><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200509154933553-1590826622691.png" alt="image-20200509154933553"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_EXPORT          0   <span class="comment">// 输出表(导入表) (重要)</span></span></span><br><span class="line">RVA:<span class="number">0010F</span>000 Size:<span class="number">000012F</span>A </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_IMPORT          1   <span class="comment">// 输入表 (重要)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_RESOURCE        2   <span class="comment">// 资源目录 (重要)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_EXCEPTION       3   <span class="comment">// 异常目录</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_SECURITY        4   <span class="comment">// 安全目录</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_BASERELOC       5   <span class="comment">// 基址重定位表 (重要)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_DEBUG           6   <span class="comment">// 调试目录</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_COPYRIGHT       7   <span class="comment">// 描述信息(版权信息之类)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_ARCHITECTURE    8   <span class="comment">// 架构特定数据</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_GLOBALPTR       9   <span class="comment">// 机器值</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_TLS            10   <span class="comment">// 线程级局部存储目录(重要)</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG    11   <span class="comment">// 载入配置目录</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT   12   <span class="comment">// 绑定输入目录 </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_IAT            13   <span class="comment">// 输入地址表</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT   14   <span class="comment">// 延迟加载导入描述符</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 15   <span class="comment">// COM运行时描述符</span></span></span><br></pre></td></tr></table></figure><blockquote><p>PE文件中的code(代码), data(数据), resource(资源)等按照属性分类储存在不同的节区, (1)这样分类便于统一和查看 (2)这样可以在一定程度上保护程序的安全性, 因为如果把所有的代码数据放在一起的话, 当我们向数据区写数据时, 若输入超过缓冲区的大小, 那么就有可能会将其下的code(指令)覆盖掉, 造成应用程序崩溃. PE文件就可以把相似属性的的数据保存在一个被称为”节区”的地方, 然后为每个节区设置不同的特性,访问权限等.</p></blockquote><h2 id="0x4-节区头"><a href="#0x4-节区头" class="headerlink" title="0x4 节区头"></a>0x4 节区头</h2><p><strong>节区头是由IMAGE_SECTION_HEADER结构体组成的数组, 每个结构体对应一个节区</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_SIZEOF_SHORT_NAME      8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_SECTION_HEADER</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    BYTE NAME[IMAGE_SIZEOF_SHORT_NAME];</span><br><span class="line">    <span class="comment">//节区的名字 8个字节</span></span><br><span class="line">    <span class="comment">//如果所有的8字节都被用光，该字符串就没有0结束符，</span></span><br><span class="line">    <span class="comment">//典型的名称.data .text .bss 形式 (.不是必须)</span></span><br><span class="line">    <span class="comment">//节区名称都和节中的内容不一定相关,</span></span><br><span class="line">    <span class="comment">//节名称没有严格要求前边带有“$”的相同名字的区块在载入时候将会被合并，</span></span><br><span class="line">    <span class="comment">//在并，在合并之后的区块中，他们是照“$”后边的字符的字母顺序进行合并的。</span></span><br><span class="line">    <span class="comment">//每个区块的名称都是唯一的，不能有同名的两个区块</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    &#123;</span><br><span class="line">        DOWORD PhysicalAddress; </span><br><span class="line">        DOWORD VitualSize; </span><br><span class="line">    <span class="comment">//内存中节区所占大小(实际初始了的数据大小, 未内存对齐)</span></span><br><span class="line">   </span><br><span class="line">    &#125;Misc;</span><br><span class="line">    </span><br><span class="line">    DWORD VirtualAddress; </span><br><span class="line">    <span class="comment">//内存中节区的起始地址(RVA). 开始没有值, 由SectionAlignment确定</span></span><br><span class="line">    </span><br><span class="line">    DWORD SizeofRawData; </span><br><span class="line">    <span class="comment">//磁盘文件中节区所占大小(对齐后的大小)</span></span><br><span class="line">    </span><br><span class="line">    DWORD PointerToRawData; </span><br><span class="line">    <span class="comment">//磁盘文件中节区的起始位置. 开始没有值, 由FileAlignment确定</span></span><br><span class="line">    </span><br><span class="line">    DWORD PointerToRelocations; </span><br><span class="line">    <span class="comment">//重定位指针  下面四个都是用于目标文件的信息</span></span><br><span class="line">        </span><br><span class="line">    DWORD PointerToLinenumbers; </span><br><span class="line">    <span class="comment">//行数指针</span></span><br><span class="line">        </span><br><span class="line">    WORD NumberOfRelocations; </span><br><span class="line">    <span class="comment">//重定位数</span></span><br><span class="line">    </span><br><span class="line">    WORD NumberOfLinenumbers; </span><br><span class="line">    <span class="comment">//行数</span></span><br><span class="line">    </span><br><span class="line">    DWORD Characteristics; </span><br><span class="line">    <span class="comment">//指定节的属性,权限. 由不同的值 bit or 而成 </span></span><br><span class="line">    <span class="comment">//0x20: 包含代码.           0x40: 包含初始化数据的节</span></span><br><span class="line">    <span class="comment">//0x80: 包含未初始化数据的节  0x20000000: 可执行 (x)</span></span><br><span class="line">    <span class="comment">//0x40000000: 可读 (r)     0x80000000: 可写 (w)</span></span><br><span class="line">    </span><br><span class="line">&#125;IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;</span><br></pre></td></tr></table></figure><p> <strong>下图展示OD程序的各个节, 并将(.txt)节中的各成员值在上面依次标出</strong> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200509170302585-1590826622691.png" alt="image-20200509170302585"></p><blockquote><p>由于每个节区都有内存地址到文件偏移间的映射(RAW-RVA). 我们可以通过节区的VirtualAddress与PointerToRawData来从RVA-&gt;RAW.</p><p>注: 由于VirtualAddress是未对齐的大小,而SizeofRawData是对齐后的大小, 那么 VirtualAddress一般比SizeofRawData小. 但是也有例外, 就是当含有未初始化数据的节(如.bss), 在磁盘中未初始化数据是不占空间的, 但是到了内存, 未初始化的数据是要赋值占空间.</p></blockquote><hr><h2 id="0x5-IMAGE-EXPORT-DIRECTORY-输出表"><a href="#0x5-IMAGE-EXPORT-DIRECTORY-输出表" class="headerlink" title="0x5 IMAGE_EXPORT_DIRECTORY 输出表"></a>0x5 IMAGE_EXPORT_DIRECTORY 输出表</h2><p><strong>一般dll文件才有,DataDirectory[0]记录了RVA及Size.</strong></p><p><strong>用来描述模块（dll）中的导出函数的结构，如果一个模块导出了函数，那么这个函数会被记录在导出表中,从 库向其他PE文件提供服务</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_EXPORT_DIRECTORY</span> &#123;</span></span><br><span class="line">    DWORD   Characteristics;</span><br><span class="line">    <span class="comment">//通常为0</span></span><br><span class="line">    <span class="number">00000000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   TimeDateStamp;</span><br><span class="line">    <span class="comment">//创建时间, 不是很有效的值</span></span><br><span class="line">    <span class="number">00000000</span></span><br><span class="line">    </span><br><span class="line">    WORD    MajorVersion;</span><br><span class="line">    <span class="comment">//主版本号</span></span><br><span class="line">    <span class="number">0000</span></span><br><span class="line">    </span><br><span class="line">    WORD    MinorVersion;</span><br><span class="line">    <span class="comment">//小版本号</span></span><br><span class="line">    <span class="number">0000</span></span><br><span class="line">    </span><br><span class="line">    DWORD   Name;</span><br><span class="line">    <span class="comment">//指向以0结尾的ASCII字符串(DLL名称)的RVA</span></span><br><span class="line">    <span class="comment">//如(user32.dll, kernel32.dll)</span></span><br><span class="line">    <span class="number">0010F</span>780						</span><br><span class="line">    </span><br><span class="line">    DWORD   Base;</span><br><span class="line">    <span class="comment">//基址, 一个输出项的序数就是函数地址数组中的索引值加base.</span></span><br><span class="line">    <span class="comment">//base大多时候为1 , 说明第一个输出函数的序数为1</span></span><br><span class="line">    <span class="number">00000001</span>						</span><br><span class="line">    </span><br><span class="line">    DWORD   NumberOfFunctions;</span><br><span class="line">    <span class="comment">//实际Export函数的个数</span></span><br><span class="line">    <span class="number">000000B</span>C</span><br><span class="line">    </span><br><span class="line">    DWORD   NumberOfNames;</span><br><span class="line">    <span class="comment">//Export函数中具名的函数个数(以名称来输出函数的数量)</span></span><br><span class="line">    <span class="number">000000B</span>C</span><br><span class="line">    </span><br><span class="line">    DWORD   AddressOfFunctions;</span><br><span class="line">    <span class="comment">//Export函数地址数组(数组个数: NumberOfFunctions)</span></span><br><span class="line">    <span class="number">0010F</span>028</span><br><span class="line">    </span><br><span class="line">    DWORD   AddressOfNames;</span><br><span class="line">    <span class="comment">//Export函数名称地址数组(数组个数:NumberOfNames)</span></span><br><span class="line">    <span class="number">0010F</span>318</span><br><span class="line">    </span><br><span class="line">    DWORD   AddressOfNameOrdinals;</span><br><span class="line">    <span class="comment">//指向函数名名称对应序数输出条目列表的RVA</span></span><br><span class="line">    <span class="comment">//数组每个名称拥有一个相应的序数(数组个数:NumberOfNames)</span></span><br><span class="line">    <span class="number">0010F</span>608						</span><br><span class="line">    </span><br><span class="line">&#125; IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY;</span><br></pre></td></tr></table></figure><blockquote><p><strong>从导出表中获得函数地址的API为: GetProcAddress()函数. 该API用来引用EAT来获取指定的API的地址.</strong></p><p><strong>注: (1) 导出函数也可能没有名称的, 这时只能通过序数导出 (2) 序数是指定某个输出函数的独一无二的16位数字(2个字节)</strong></p><p>两种导出函数的方法:</p><p><strong>一:按函数名字</strong></p><p>​ <strong>(1)通过AddressOfNames找到函数名称数组. 使用strcmp()函数, 在(RVA)指针数组从索引值0开始依次与我们要找的函数名称对比,从而找到索引值 index_name</strong></p><p>​ <strong>(2)通过AddressOfNameOrdinals找到存放函数序号的数组, 使用步骤(1)获得的index_name为索引值找到函数地址的序号(index_address)</strong></p><p>​ <strong>(3)通过AddressOfFunctions找到函数地址数组(EAT), 在EAT中使用步骤(2)获得的index_address为索引值找到指定函数的RVA</strong></p><p><strong>二:按函数序号</strong></p><p>​ <strong>(1)使用我们函数的序号减去 _IMAGE_EXPORT_DIRECTORY.Base 的值得到函数地址索引值index_address</strong></p><p>​ <strong>(2)通过AddressOfFunctions找到函数地址数组(EAT), 在EAT中使用步骤(1)获得的index_address为索引值找到指定函数的RVA</strong></p></blockquote><p> <strong>下面依旧用OD程序来看导出表, 并将每个值标在上面每个成员下面, 通过上面IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]介绍, 已经标出导出表的RVA: 0010F000 Size: 000012FA</strong>. 再通过CFF Explorer 工具查看每个节的地址可以计算出输出表的 RAW : <strong>00CE200</strong></p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510143001536-1590826622691.png" alt="image-20200510143001536"></p><p> 1.查看输出表名称(<strong>RVA : 0010F780 -&gt; RAW: 000CE980</strong>)</p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510151725862-1590826622691.png" alt="image-20200510151725862"></p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510151945596-1590826622691.png" alt="image-20200510151945596"></p><p> 2.查找函数名称.</p><p> (1)<strong>AddressOfNames</strong>. (<strong>RVA: 0010F318 -&gt; RAW: 000CE518</strong>)</p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510153257760-1590826622691.png" alt="image-20200510153257760"></p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510154247725-1590826622691.png" alt="image-20200510154247725"></p><p> 由(<strong>RVA:0010F78C -&gt; RAW: 000CE98C</strong>):</p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510154722496-1590826622691.png" alt="image-20200510154722496"></p><p> 现在已经找到了函数的名称, 下面模拟查看一个指定名称函数的RVA. 假设我们找的是<strong>Addsorteddata.</strong>(即第一个函数), (1)通过strcmp(). 得到它的索引值是0, 记为 index_name. (2)通过AddressOfNameOrdinals使用index_name找到函数的序数, 通过下图得到序数0, 记为index_address.</p><p> <strong>AddressOfNameOrdinals</strong>. (<strong>RVA: 0010F608 -&gt; RAW: 000CE808</strong>):<img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510160635396-1590826622691.png" alt="image-20200510160635396"></p><p> (3)通过AddressOfFunctions函数地址数组(EAT), 使用index_address为索引值得到我们指定函数的RVA.</p><p> AddressOfFunctions(<strong>RVA: 0010F028 -&gt; RAW: 000CE228</strong>):<img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510161225077-1590826622691.png" alt="image-20200510161225077"></p><p> 到此, 得到我们指定输出函数<strong>Addsorteddata.</strong>的RVA: <strong>00054EFC</strong>. 最后通过 OD载入OD看一下.<img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200510161939914-1590826622691.png" alt="image-20200510161939914"></p><p> <strong>从这里也说明了, .exe文件也是可能有输出表的</strong></p><hr><h2 id="0x6-IMAGE-IMPORT-DESCRIPTOP-输入表"><a href="#0x6-IMAGE-IMPORT-DESCRIPTOP-输入表" class="headerlink" title="0x6 IMAGE_IMPORT_DESCRIPTOP 输入表"></a>0x6 IMAGE_IMPORT_DESCRIPTOP 输入表</h2><p><strong>记录PE文件要导入那些库文件 DataDirectory[0]记录了RVA及Size.</strong></p><p><strong>首先, 执行一个程序会有很多的函数是公用的,在动态链接库里(动态链接库, .dll文件总是附加在一个要执行的程序中, .dll文件中有说明库EAT的输出表), 如下图, 一个程序加载的部分 .dll文件.</strong><img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200518132004979-1590826622691.png" alt="image-20200518132004979"></p><p><strong>我们的输入表记录了需要用到的函数名称, 通过在加载的动态链接库中搜索该函数得到实际的RVA, 再记录到输入表中, 供程序使用. 另外执行一个普通的程序一般需要多个库, 那导入多少库, 就会有多少个输入表结构体. 这就构成了结构体数组且结构体数组最后以 NULL 结束 (即每个导入的 DLL 都会成为数组中的一项).</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_IMPORT_DESCRIPTOR</span> &#123;</span></span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        DWORD   Characteristics</span><br><span class="line">    	<span class="comment">// 由于是一个联合, 如果这是该结构体数组的最后一</span></span><br><span class="line">    	<span class="comment">// 项, 那使用 Characteristics成员,且值为 0</span></span><br><span class="line">    	<span class="comment">// 否则使用下面一个成员</span></span><br><span class="line">        									</span><br><span class="line">        DWORD   OriginalFirstThunk;</span><br><span class="line">    	<span class="comment">// INT(import name table)结构体数组的RVA</span></span><br><span class="line">    	<span class="comment">// 数组每个成员记录了要使用函数名称与序号</span></span><br><span class="line">        									</span><br><span class="line">    &#125; DUMMYUNIONNAME;</span><br><span class="line">    </span><br><span class="line">    DWORD   TimeDateStamp;                  </span><br><span class="line">    <span class="comment">// 映象绑定前，这个值是0，绑定后是导入模块的时间戳</span></span><br><span class="line">    <span class="comment">// 据说可以用来确定输入表是否绑定从而是否需要重定位</span></span><br><span class="line"> 										</span><br><span class="line">    DWORD   ForwarderChain;                 </span><br><span class="line">    <span class="comment">// 中转链, 输入函数列表中第一个中转的、32位的索引</span></span><br><span class="line">    <span class="comment">// 如果没有转发链, 值为 -1</span></span><br><span class="line">    	</span><br><span class="line">    DWORD   Name;</span><br><span class="line">    <span class="comment">// DLL文件的名称（0结尾的ASCII码字符串）的32位的RVA, </span></span><br><span class="line">    <span class="comment">// 所以一个导入模块对应一个这样的数组</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    DWORD   FirstThunk;</span><br><span class="line">    <span class="comment">//IAT(import address table)结构体数组的RVA</span></span><br><span class="line">    </span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">上面的 OriginalFirstThunk(INT), FirstThunk(IAT) 成员在PE文件加载前一般是都同时指向相同地址的 IMAGE_THUNK_DATA 数组.下面是 IMAGE_THUNK_DATA32的定义</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_THUNK_DATA32</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">//一个联合, 所以意味着每次只能使用一个成员</span></span><br><span class="line">    <span class="keyword">union</span> 							</span><br><span class="line">    &#123;</span><br><span class="line">        DWORD ForwarderString;</span><br><span class="line">        <span class="comment">// 中转链,一个DLL文件能输出不定义在本DLL文件中却需从另一个</span></span><br><span class="line">        <span class="comment">// DLL文件中的函数.</span></span><br><span class="line">        </span><br><span class="line">        DWORD Function;</span><br><span class="line">        <span class="comment">// 函数的地址</span></span><br><span class="line">        </span><br><span class="line">        DWORD Ordinal;</span><br><span class="line">        <span class="comment">// 函数的序数. 由于所有成员都是同一个地址, 当最高位为1时表</span></span><br><span class="line">        <span class="comment">// 示列表中没有函数的名字信息, 只能通过本序数查找函数,</span></span><br><span class="line">        <span class="comment">// 用低16位表示的序数, 因为最高位作为标志了。</span></span><br><span class="line">        							</span><br><span class="line">        DWORD AddressOfData;</span><br><span class="line">        <span class="comment">// 同上, 由于所有成员都是同一个地址, 当最高位为0时, 则使用</span></span><br><span class="line">        <span class="comment">// 本成员,用低31为表示 _IMAGE_IMPORT_BY_NAME结构的RVA</span></span><br><span class="line">        </span><br><span class="line">    &#125; u1;</span><br><span class="line">&#125; IMAGE_THUNK_DATA32;</span><br><span class="line"><span class="keyword">typedef</span> IMAGE_THUNK_DATA32 * PIMAGE_THUNK_DATA32;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">上面介绍的 AddressOfData成员的低<span class="number">31</span>就记录指向下面所示的 _IMAGE_IMPORT_BY_NAME 结构体数组的地址(RVA), 数组中每个成员的前<span class="number">2</span>个字节是函数的序数, 后面跟着长度不定的函数名称的字符串.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_IMPORT_BY_NAME</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    WORD Hint;</span><br><span class="line">    <span class="comment">// 函数的序数(即索引, 与输出表中讲的一样)</span></span><br><span class="line">    BYTE Name[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 函数名称数组,记录函数的名称. 数量未定义即长度不定.</span></span><br><span class="line">    </span><br><span class="line">&#125;IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME;</span><br></pre></td></tr></table></figure><p><strong>注: 上面所讲的 OriginalFirstThunk 成员(指针数组)的值是不能改写的, 通过它寻找函数的名称. 而 FirstThunk 成员(指针数组)的值在PE文件在被PE装载器时, PE装载器会通过 OriginalFirstThunk 得到函数的名称或者序数, 然后通过函数名称在加载的.dll文件的输出表中找到函数的实际地址, 然后替换到FirstThunk的一个值. 装载完成后, FirstThunk 数组就指向向了函数实际的地址.</strong> 另外上面的 <strong>TimeDateStamp</strong> 成员可以用来确定输入表是否绑定从而是否需要重定位, 如果它的值是0, 那么输入列表没有被绑定, 加载器总是要修复输入表. 否则输入被绑定, 但该时间戳的值必须和.dll文件头中 <strong>TimeDateStamp</strong> 的一样, 如果不一样, 仍会修正输入表, 就会进行下面的步骤.</p><blockquote><p><strong>导入函数输入到 IAT 的顺序</strong></p><p><strong>1.读取 _IMAGE_IMPORT_DESCRIPTOR中的name成员, 获取库名称字符串. 如(user32.dll)</strong></p><p><strong>2.装载相应的库. LoadLibrary(“user32.dll”)</strong></p><p><strong>3.读取_IMAGE_IMPORT_DESCRIPTOR中的 OriginalFirstThunk 成员, 得到 INT地址.</strong></p><p><strong>4.逐一读取 INT中数组的值, 获取相应的 IMAGE_IMPORT_BY_NAME地址(RVA)</strong></p><p><strong>5.使用 IMAGE_IMPORT_BY_NAME的Hint (ordinak/序数)或name项, 获取相应函数的起始地址.</strong></p><p><strong>GetProcAddress(“函数名称”)</strong></p><p><strong>6.读取 IAT 成员, 获得IAT地址.</strong></p><p><strong>7.将上面获得的函数地址输入相应的IAT数组值.</strong></p></blockquote><blockquote><p><strong>8.重复 步骤 4 -7, 直到INT结束.</strong></p></blockquote><p> <strong>图示一下, INT 与 IAT 关系 (技术太差了.png).</strong></p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519174651226-1590826622691.png" alt="image-20200519174651226"></p><p> <strong>下面实例查看OD程序的输入表.</strong></p><p> 1.首先从PE文件可选头的 DataDirectory[1].VirtualAdress 得到输入表的RVA: <strong>10D000h</strong> 及size: <strong>1c87h</strong></p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519150821954-1590826622691.png" alt="image-20200519150821954"></p><p> 2.RVA: <strong>10D000h</strong> -&gt; RAW: <strong>(10D000-10D000+CC400) = CC400h</strong></p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519151445783-1590826622692.png" alt="image-20200519151445783"></p><p> 3.找到输入表. 记录下对应成员的RVA.</p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519153011688-1590826622692.png" alt="image-20200519153011688"></p><p> 4.查看该输入表名称: <strong>ADVAPI32,DLL</strong>, RVA: <strong>10D9C8</strong> -&gt; RAW: <strong>(10D9C8-10D000+CC400) = CCDC8</strong></p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519153843705-1590826622692.png" alt="image-20200519153843705"></p><p> 5.查看 <strong>OriginalFirstThunk( INT )</strong> RVA:<strong>10D0C8</strong> -&gt; RAW: <strong>(10D0C8-10D000+CC400) = CC4C8</strong></p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519155230578-1590826622692.png" alt="image-20200519155230578"></p><p> 6.可以看到第一成员的最高位是 0, 则该值是IMAGE_IMPORT_BY_NAME的RVA.(RVA: <strong>10DA33</strong> -&gt; RAW: <strong>CCE33</strong>)</p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519160556676-1590826622692.png" alt="image-20200519160556676"></p><p> 7.查看 FirstThunk( IAT ) RVA: <strong>10D0E4</strong> -&gt; RAW: <strong>(10D0E4-10D000+CC400) = CC4E4</strong></p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519163851829-1590826622692.png" alt="image-20200519163851829"></p><p> 8.从步骤7可以看到, PE装载器装载PE文件之前, INT与IAT各元素同时指向相同的地址.</p><p> 9.再看 TimeDateStamp 成员的值为 0, 那就是输入表被绑定, 如果与该对应 .dll PE文件的文件头的 TimeDateStamp的值相同, 那这个输入表是不需要修正的.</p><p> 10.从上面知道 IAT 的RVA: <strong>10D0E4</strong>. 库名称: <strong>ADVAPI32,DLL</strong>另外使用一个OD载入这个OD程序看看. 可以看到加载该.dll文件文件的RVA是从 <strong>FC0000</strong>开始的, 而查看未被PE装载器装载前的状态, IAT的RVA是 <strong>10D0E4</strong>,所以显然这是需要PE装载器装载时对输入表修正的, 那也可推出他们的 TimeDateStamp 的值是不同的</p><p> <img src="/2020/05/30/PE%E5%AD%A6%E4%B9%A0/image-20200519164915615-1590826622692.png" alt="image-20200519164915615"></p><blockquote><p>输入表与输出表联系还是比较大, 结合起来看看清楚很多.</p></blockquote><hr></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>Post author:</strong> BIX</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://www.bxnop.cn/2020/05/30/PE%E5%AD%A6%E4%B9%A0/" title="PE学习">https://www.bxnop.cn/2020/05/30/PE学习/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E7%B3%BB%E7%BB%9F/" rel="tag"># 系统</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/05/29/Crypto/" rel="prev" title="Crypto"><i class="fa fa-chevron-left"></i> Crypto</a></div><div class="post-nav-item"> <a href="/2020/06/02/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/" rel="next" title="工具使用总结">工具使用总结<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x1-基础概念"><span class="nav-number">1.</span> <span class="nav-text">0x1 基础概念:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x2-MS-DOS头部及DOS存根"><span class="nav-number">2.</span> <span class="nav-text">0x2 MS-DOS头部及DOS存根</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x3-NT头"><span class="nav-number">3.</span> <span class="nav-text">0x3 NT头</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x4-节区头"><span class="nav-number">4.</span> <span class="nav-text">0x4 节区头</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x5-IMAGE-EXPORT-DIRECTORY-输出表"><span class="nav-number">5.</span> <span class="nav-text">0x5 IMAGE_EXPORT_DIRECTORY 输出表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x6-IMAGE-IMPORT-DESCRIPTOP-输入表"><span class="nav-number">6.</span> <span class="nav-text">0x6 IMAGE_IMPORT_DESCRIPTOP 输入表</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">BIX</p><div class="site-description" itemprop="description">0x446e37fb</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">22</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">9</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">2</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">BIX</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i></span> <span class="post-meta-item-text">Symbols count total:</span> <span title="Symbols count total">95k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">Reading time total &asymp;</span> <span title="Reading time total">1:27</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script type="text/javascript" src="/js/src/clicklove.js"></script><script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"left",width:150,height:300},mobile:{show:!1},log:!1})</script></body></html>