<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/" class="post-title-link" itemprop="url">2020年DASCTF五月线上赛</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-23 20:00:53" itemprop="dateCreated datePublished" datetime="2020-05-23T20:00:53+08:00">2020-05-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-24 10:49:00" itemprop="dateModified" datetime="2020-05-24T10:49:00+08:00">2020-05-24</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>5.5k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>5 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>第二次玩CTF线上赛, 记录一下做了的题.</p>
</blockquote>
<p>[TOC]</p>
<h3 id="ViQinere"><a href="#ViQinere" class="headerlink" title="ViQinere"></a>ViQinere</h3><ul>
<li><p>64位elf文件, 载入ida后发现与以往的不同. 很多函数都没显示出来.</p>
</li>
<li><p>linux中运行一下, 显示对flag加密, 然后是一些乱码.  后来群里通知, 这个是有靶机的.</p>
</li>
<li><p>nc连接一下, 那题目的flag就是存放在本地的, 文件操作取出flag, 经过加密. <img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200523203121150.png" alt="image-20200523203121150"></p>
</li>
<li><p>接着再在ida中看一下, 有几个字符很懵, 后面才发现就是改变输出字符串样式, 这也是为什么linux中运行的时候会有涂鸦与闪动, <img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200523204020172.png" alt="image-20200523204020172"></p>
</li>
<li><p>然后是被涂鸦的那一段坑了, 显示 <strong>Flag was encrypted by <a href="http://cc.TaQini.space" target="_blank" rel="noopener">http://cc.TaQini.space</a></strong> , 一直以为加密和这个有关,  嗯…后来发现是题目作者给自己打的广告. </p>
</li>
<li><p>虽然很多函数不能显示出来, 但也是能猜出来作用. 看看汇编会更清楚. </p>
</li>
<li><p>最后找到加密函数 <strong>sub_1249((__int64)byte_4080);</strong>, 这下就好办了.   进去函数可以知道, 大写字母加密为大写字母, 小写字母加密为小写字母, 其他字符不变.<img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200523204833774.png" alt="image-20200523204833774"></p>
</li>
<li><p>对于逆这个算法, 没有过多的想, 算是直接穷尽的吧(算法太菜).  因为大写字母变大写字母,小写字母变小写字母.</p>
</li>
<li><p>上exp: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_1209</span><span class="params">(<span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">	<span class="keyword">if</span>(a &gt;= <span class="number">97</span> &amp;&amp; a &lt;= <span class="number">122</span>)</span><br><span class="line">		<span class="keyword">return</span> a<span class="number">-97</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(a &gt;= <span class="number">65</span> &amp;&amp; a &lt;= <span class="number">90</span>)</span><br><span class="line">		<span class="keyword">return</span> (a<span class="number">-65</span>)^<span class="number">0xFFFFFF80</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> a; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, v4 = <span class="number">0</span>, j = <span class="number">0</span>, v2 = <span class="number">0</span>, v5 = <span class="number">0</span>, v1 = <span class="number">0</span>; </span><br><span class="line">	<span class="keyword">char</span> a[<span class="number">26</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">char</span> b[] = <span class="string">"TaQini"</span>;</span><br><span class="line">	<span class="keyword">char</span> c[] = <span class="string">"FQD&#123;GfjuJ5UbLrWjZjpvErXkiAZzlvO0xTa!cwnLLAsy3B0iEvEy&#125;"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		a[i] = <span class="number">122</span>-i;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(c); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>((c[i] &gt;= <span class="number">97</span> &amp;&amp; c[i] &lt;= <span class="number">122</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span>(j = <span class="number">97</span>; j &lt;= <span class="number">122</span>; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				v4 = sub_1209(j);</span><br><span class="line">				v2 = sub_1209(b[v5 &amp; <span class="number">5</span>]);</span><br><span class="line">				<span class="keyword">if</span>(c[i] == a[((v2&amp;<span class="number">0x7F</span>) + v4)%<span class="number">26</span>])</span><br><span class="line">				&#123;</span><br><span class="line">					c[i] = j;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; </span><br><span class="line">			v5++; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(c[i] &gt;= <span class="number">65</span> &amp;&amp; c[i] &lt;= <span class="number">90</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span>(j = <span class="number">65</span>; j &lt;= <span class="number">90</span>; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				v4 = sub_1209(j);</span><br><span class="line">				v1 = sub_1209(b[v5 &amp; <span class="number">5</span>]);</span><br><span class="line">				<span class="keyword">if</span>(c[i] == a[(v4+(v1 &amp; <span class="number">0x7F</span>) + <span class="number">128</span>)%<span class="number">26</span>] - <span class="number">32</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					c[i] = j;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; </span><br><span class="line">			v5++;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">puts</span>(c);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后补充一下对改变输出字符串的知识. 也是后面出题师傅 <strong>TaQini</strong> 发的.</p>
<table>
<thead>
<tr>
<th>\033[0m</th>
<th>关闭所有属性</th>
</tr>
</thead>
<tbody><tr>
<td><strong>\033[01m</strong></td>
<td><strong>设置高亮度</strong></td>
</tr>
<tr>
<td><strong>\033[04m</strong></td>
<td><strong>下划线</strong></td>
</tr>
<tr>
<td><strong>\033[05m</strong></td>
<td><strong>闪烁</strong></td>
</tr>
<tr>
<td><strong>\033[07m</strong></td>
<td><strong>反显</strong></td>
</tr>
<tr>
<td><strong>\033[08m</strong></td>
<td><strong>消隐</strong></td>
</tr>
<tr>
<td><strong>\033[30m – \033[37m</strong></td>
<td><strong>设置前景色</strong></td>
</tr>
<tr>
<td><strong>\033[40m – \033[47m</strong></td>
<td><strong>设置背景色</strong></td>
</tr>
<tr>
<td><strong>\033[nA</strong></td>
<td><strong>光标上移n行</strong></td>
</tr>
<tr>
<td><strong>\033[nB</strong></td>
<td><strong>光标下移n行</strong></td>
</tr>
<tr>
<td><strong>\033[nC</strong></td>
<td><strong>光标右移n行</strong></td>
</tr>
<tr>
<td><strong>\033[nD</strong></td>
<td><strong>光标左移n</strong></td>
</tr>
<tr>
<td><strong>\033[y;xH</strong></td>
<td><strong>设置光标位置</strong></td>
</tr>
<tr>
<td><strong>\033[2J</strong></td>
<td><strong>清屏</strong></td>
</tr>
<tr>
<td><strong>\033[K</strong></td>
<td><strong>清除从光标到行尾的内容</strong></td>
</tr>
<tr>
<td><strong>\033[s</strong></td>
<td><strong>保存光标位置</strong></td>
</tr>
<tr>
<td><strong>\033[u</strong></td>
<td><strong>恢复光标位置</strong></td>
</tr>
<tr>
<td><strong>\033[?25l</strong></td>
<td><strong>隐藏光标</strong></td>
</tr>
<tr>
<td><strong>\033[?25h</strong></td>
<td><strong>显示光标</strong></td>
</tr>
</tbody></table>
</li>
<li><p><strong>总结: 题本来很简单, 主要几次被带入坑. 也是没经验吧.</strong></p>
</li>
</ul>
<hr>
<h3 id="MiscVm"><a href="#MiscVm" class="headerlink" title="MiscVm"></a>MiscVm</h3><ul>
<li><p>下载下来, 64位的无壳elf文件和一个操作码文件.  操作码其实题中也有, 这里单独给了方便很多.</p>
</li>
<li><p>载入ida. C++逆向类的, 但还好都是很基本的语法. <img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200524075414831.png" alt="image-20200524075414831"></p>
</li>
<li><p>分别进去三个加密函数. 第一个: <strong>sub_19E2((int64)&amp;v13</strong>, (__int64)&amp;v14);很简单,   就是 2个数的值交换.</p>
<p><img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200524075631032.png" alt="image-20200524075631032"></p>
</li>
<li><p>第二个: <strong>sub_1551((int64)&amp;v14, (int64)&amp;v13);</strong>,  就是按照给定顺序进行简单的值交换.</p>
<p><img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200524075954652.png" alt="image-20200524075954652"></p>
</li>
<li><p>第三个: <strong>v8 = (unsigned int)sub_EEC(&amp;v14, &amp;v15, 0LL) != 0</strong>,   这个相对于要麻烦一些, 但分析一下, 思路理清, 逆回去就好了.</p>
<p><img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200524083055817.png" alt="image-20200524083055817"></p>
</li>
<li><p>exp: C语言写的, 比较冗长. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">decode_4</span><span class="params">(<span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, temp = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">2000</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		j = i;</span><br><span class="line">		</span><br><span class="line">		j ^= <span class="number">10</span>;</span><br><span class="line">		temp = (<span class="number">16</span>*j &gt;&gt; <span class="number">31</span>)&gt;&gt;<span class="number">28</span>;</span><br><span class="line">		<span class="keyword">if</span>(a == j + (((temp + <span class="number">16</span>*(*(<span class="keyword">char</span> *)&amp;j))&amp;<span class="number">0xF</span>)-temp))</span><br><span class="line">			<span class="keyword">break</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> i;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">union</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> ida_chars[<span class="number">152</span>];</span><br><span class="line">		<span class="keyword">int</span> a[<span class="number">37</span>];</span><br><span class="line">	&#125;A = &#123;</span><br><span class="line">   				<span class="number">66</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">74</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">68</span>,   <span class="number">0</span>, </span><br><span class="line">    			<span class="number">0</span>,   <span class="number">0</span>, <span class="number">123</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">51</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">  				<span class="number">112</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">70</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">212</span>,   <span class="number">0</span>, </span><br><span class="line">    			<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">60</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">16</span>,   <span class="number">6</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   				<span class="number">79</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">200</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">108</span>,   <span class="number">0</span>, </span><br><span class="line">   				<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">32</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">30</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">  				<span class="number">144</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">111</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">48</span>,   <span class="number">6</span>, </span><br><span class="line">    			<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">70</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">144</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   				<span class="number">59</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">16</span>,   <span class="number">6</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">29</span>,   <span class="number">0</span>, </span><br><span class="line">    			<span class="number">0</span>,   <span class="number">0</span>, <span class="number">196</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">62</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   				<span class="number">96</span>,   <span class="number">6</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">75</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">208</span>,   <span class="number">0</span>, </span><br><span class="line">    			<span class="number">0</span>,   <span class="number">0</span>, <span class="number">108</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">16</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   				<span class="number">70</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">136</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">51</span>,   <span class="number">0</span>, </span><br><span class="line">    			<span class="number">0</span>,   <span class="number">0</span>, <span class="number">112</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">76</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">  				<span class="number">204</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">125</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    			<span class="number">0</span>,   <span class="number">0</span></span><br><span class="line">				&#125;;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">36</span>, temp = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> d[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;, e[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> a1[<span class="number">100</span>] = &#123;<span class="number">3</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">36</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">36</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">9</span>&#125;;				</span><br><span class="line">	<span class="keyword">int</span> b[<span class="number">100</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">19</span>,<span class="number">31</span>,<span class="number">25</span>,<span class="number">14</span>,<span class="number">23</span>,<span class="number">33</span>,<span class="number">13</span>,<span class="number">9</span>,<span class="number">24</span>,<span class="number">6</span>,<span class="number">26</span>,<span class="number">34</span>,<span class="number">17</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">29</span>,<span class="number">12</span>,<span class="number">15</span>,<span class="number">22</span>,<span class="number">11</span>,<span class="number">18</span>,<span class="number">16</span>,<span class="number">32</span>,<span class="number">28</span>,<span class="number">21</span>,<span class="number">36</span>,<span class="number">20</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">27</span>,<span class="number">30</span>,<span class="number">35</span>,<span class="number">37</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> c[<span class="number">100</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">31</span>,<span class="number">29</span>,<span class="number">7</span>,<span class="number">35</span>,<span class="number">14</span>,<span class="number">21</span>,<span class="number">9</span>,<span class="number">16</span>,<span class="number">27</span>,<span class="number">18</span>,<span class="number">25</span>,<span class="number">10</span>,<span class="number">20</span>,<span class="number">15</span>,<span class="number">17</span>,<span class="number">22</span>,<span class="number">28</span>,<span class="number">26</span>,<span class="number">36</span>,<span class="number">33</span>,<span class="number">32</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">23</span>,<span class="number">34</span>,<span class="number">13</span>,<span class="number">30</span>,<span class="number">24</span>,<span class="number">11</span>,<span class="number">19</span>,<span class="number">6</span>,<span class="number">37</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(i &gt;= <span class="number">-87</span>)</span><br><span class="line">	<span class="keyword">switch</span>(a1[<span class="number">87</span>+i])</span><br><span class="line">	&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">				--j;</span><br><span class="line">				--i;</span><br><span class="line">				A.a[j] = (A.a[j] / <span class="number">16</span>)*<span class="number">2</span>;</span><br><span class="line">				A.a[j] = A.a[j];</span><br><span class="line">				A.a[j] /= <span class="number">2</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">				A.a[j] -= <span class="number">128</span>;</span><br><span class="line">				A.a[j] = A.a[j]*j;</span><br><span class="line">				--i;</span><br><span class="line">				<span class="keyword">break</span>;	</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">				A.a[++j] /= <span class="number">10</span>;</span><br><span class="line">				--i;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">				--j;</span><br><span class="line">				--i;</span><br><span class="line">				A.a[j] = decode_4(A.a[j]);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">				A.a[j] = A.a[j];</span><br><span class="line">				--i;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">				A.a[j--] *= <span class="number">10</span>;</span><br><span class="line">				--i;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">				A.a[j] -= <span class="number">128</span>;</span><br><span class="line">				A.a[j] = ~A.a[j];</span><br><span class="line">				--i;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">				--i;</span><br><span class="line">				--j;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">				A.a[j] /= <span class="number">4</span>;</span><br><span class="line">				--i;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">				--i;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">					 			 </span><br><span class="line">	&#125; </span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">37</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		d[c[i]<span class="number">-1</span>] = A.a[i];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">37</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		e[b[i]<span class="number">-1</span>] = d[i];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">4</span>; i &lt;= <span class="number">19</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		temp = e[i];</span><br><span class="line">		e[i] = e[i+<span class="number">16</span>];</span><br><span class="line">		e[i+<span class="number">16</span>] = temp;</span><br><span class="line">	&#125;  </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">37</span>; i++)	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%c"</span>, e[i]); </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200524083340342.png" alt="image-20200524083340342"></p>
</li>
<li><p><strong>总结: 算法的重要性</strong>.</p>
</li>
</ul>
<hr>
<h3 id="BScript"><a href="#BScript" class="headerlink" title="BScript"></a>BScript</h3><ul>
<li><p>感觉有点意思.  主要就是考对文件内容的提取, 还有就是找规律!!!</p>
</li>
<li><p>下载下来803个exe文件.  随便打开一个看见简单的输入对比, 再打开一个还是同样的.但没有发现与解题相关的东西.</p>
</li>
<li><p>也是后面想着再去看看这个题才发现 每个exe文件让我们输入的都是一个PE文件的一部分, 那 熟悉的 MZ(4D5A)啊.<img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200524100310951.png" alt="image-20200524100310951"></p>
</li>
<li><p>接下来就是去文件内容了. 但是每个程序都是加了upx壳的, 嗯嗯..因为不会写脚本开始还想想着手动去搞, 被803个程序劝退.</p>
</li>
<li><p>然后用C语言写了一个一个.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> a[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">83</span>; i &lt; <span class="number">804</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">sprintf</span>(a, <span class="string">"upx -d %d.exe"</span>, i);</span><br><span class="line">		system(a);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200524102949962.png" alt="image-20200524102949962"></p>
</li>
<li><p>下面提取每个程序的 PE文件那部分的内容. 可是搞完, 保存为exe文件后, 打不开…ida都不行, 看看了PE文件内容发现区段都没有…….</p>
</li>
<li><p>那就提取的内容有问题, 多看了几个原来的exe文件, 发现果然不一样, 有的提取内容的位置不一样. 但803个exe让我怎么找…</p>
</li>
<li><p>开始找规律. 列举了很多还是没发现. 这也是本题花费时间最多的地方……..根据exe文件的字节大小来区分…改了一下提取内容的程序.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">779</span>, j = <span class="number">0</span>, lenth = <span class="number">0</span>; </span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> a[<span class="number">4000</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	FILE *fp = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">char</span> filename[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(n--)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">sprintf</span>(filename, <span class="string">"%d.exe"</span>, j++);</span><br><span class="line">		fp = fopen(filename, <span class="string">"rb"</span>);</span><br><span class="line">		fseek(fp, <span class="number">0</span>, SEEK_END);</span><br><span class="line">		lenth = ftell(fp);</span><br><span class="line">		<span class="keyword">if</span>(lenth == <span class="number">0xBDF1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			fseek(fp, <span class="number">0x1c20</span>, <span class="number">0</span>);</span><br><span class="line">			fread(a, <span class="number">1</span>, <span class="number">0x20</span>, fp);</span><br><span class="line">			fclose(fp);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"%02X"</span>, a[i]);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			fseek(fp, <span class="number">0x1C40</span>, <span class="number">0</span>);</span><br><span class="line">			fread(a, <span class="number">1</span>, <span class="number">0x40</span>, fp);</span><br><span class="line">			fclose(fp);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span>(i = <span class="number">63</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">"%02X"</span>, a[i]);</span><br><span class="line">			&#125;</span><br><span class="line">	</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>仍然打不开, 但是这次区段都是齐的, ida可以打开就好了. </p>
</li>
<li><p>载入ida, 发现有很多干扰项, 但可以在比较函数上面一个看出是 base64加密. 最后与密文比较.</p>
<p><img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200524101529508.png" alt="image-20200524101529508"></p>
</li>
<li><p>找密文. 可以发现是程序运行才赋值的.</p>
<p><img src="/2020/05/23/2020%E5%B9%B4DASCTF%E4%BA%94%E6%9C%88%E7%BA%BF%E4%B8%8A%E8%B5%9B/image-20200524101634787.png" alt="image-20200524101634787"></p>
</li>
<li><p>提取出来base解密一下, 再md5得到flag. <strong>e801bcbcc42d3120d910ccc46ae640dd</strong></p>
</li>
<li><p>总结: 算是熟悉了文件操作吧.哈哈</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/" class="post-title-link" itemprop="url">攻防世界(4)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-15 10:27:16" itemprop="dateCreated datePublished" datetime="2020-05-15T10:27:16+08:00">2020-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-21 12:40:10" itemprop="dateModified" datetime="2020-05-21T12:40:10+08:00">2020-05-21</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>4.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>4 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<h3 id="asong"><a href="#asong" class="headerlink" title="asong"></a>asong</h3></blockquote>
<blockquote>
<p>算是小白第一次接触逆向真正算法的题吧. 吃了算法的亏, 逆向这个算法想了半天🤣</p>
</blockquote>
<h4 id="0x1分析"><a href="#0x1分析" class="headerlink" title="0x1分析"></a>0x1分析</h4><ul>
<li><p>下载下来三个文件, 但这不是我以前遇到的那种同一个题给不同的版本.</p>
</li>
<li><p>依次看了下, 一个64位elf文件无壳, 2个文本文件.  打开文本文件后,没有头绪.  将elf文件载入ida.</p>
</li>
<li><p>整个流程开始看不清楚做什么, 多看几次明白了. 先输入字符串, 打开一个that_girl文件读信息, 最后向out文件写信息. 但这怎么和flag联系起来呢.  其实那个out文件里的就是密文, 我们找到逆向算法, 通过密文求出明文(即我们的输入, 也是flag)</p>
</li>
<li><p>下面具体分析每个函数. 第一函数: <strong>sub_400B4C</strong> 由于很简单, 直接给出函数功能.</p>
<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515112040201.png" alt="image-20200515112040201"></p>
</li>
<li><p><strong>sub_400B4C</strong>: 先判断, 再取 { } 之间的内容.</p>
<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515112333168.png" alt="image-20200515112333168"></p>
</li>
<li><p>下面下一个函数, 也是我遇到的难点开始:  <strong>v4哪里来的及 ++*(_DWORD *)(4LL * v2 + v4);语句的作用</strong></p>
<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515113837252.png" alt="image-20200515113837252"></p>
<p><strong>sub_400936(&amp;buf)</strong>:</p>
<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515170301682.png" alt="image-20200515170301682"></p>
</li>
<li><p>第一次遇到, 没有经验, 后来才想到通过汇编的查看, v4即是我们传了参数 a2(也就是主函数的v3), 这是通过寄存器传递. 64位与32位程序的区别吧. 但该语句功能还不是很清楚.<img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515114501031.png" alt="image-20200515114501031"></p>
<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515114755333.png" alt="image-20200515114755333"></p>
</li>
<li><p>继续看下一个函数<strong>sub_400E54</strong>:  看到这里, 就很清晰了,  就是先通过统计<strong>that_girl</strong>文件中每个字符出现的次数, 然后按照一定的顺序输入字符, 把每个字符出现的次数按一定顺序给下面的 v5 数组赋值.<strong>那所以sub_400936转换字符函数我们是不用管的.</strong></p>
<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515115440782.png" alt="image-20200515115440782"></p>
</li>
<li><p>下面是2个加密函数,  我算法太菜, 逆算法想半天😅, 首先<strong>sub_400D33((unsigned __int8 *)v5);</strong></p>
<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515120938171.png" alt="image-20200515120938171"></p>
</li>
<li><p>然后 <strong>sub_400DB4(v5, v4);</strong> 解释起来有点抽象……注意是一个字节, 所以多出的位要舍弃<img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515125253662.png" alt="image-20200515125253662"></p>
</li>
<li><p>举个例子:<img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515134001272.png" alt="image-20200515134001272"></p>
</li>
<li><p>最后一个函数: <strong>sub_400CC0((__int64)v5, “out”, v4);</strong>将加密后的值写入 out文件. </p>
</li>
</ul>
<h4 id="0x2逆向解密"><a href="#0x2逆向解密" class="headerlink" title="0x2逆向解密"></a>0x2逆向解密</h4><ul>
<li><p>直接exp:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">union</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> ida[<span class="number">152</span>];</span><br><span class="line">		<span class="keyword">int</span> change[<span class="number">38</span>];</span><br><span class="line">	&#125;A = &#123;</span><br><span class="line">   			<span class="number">22</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">6</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">2</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">30</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">24</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">9</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">21</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">7</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">18</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">10</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">8</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">12</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">17</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">23</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">13</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">4</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">14</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">  			<span class="number">19</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">11</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">20</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">16</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">15</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">5</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">25</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">36</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">27</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">28</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">29</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">37</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">31</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">32</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">33</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">  			<span class="number">26</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">34</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">35</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">0</span>,   <span class="number">0</span></span><br><span class="line">				&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, a[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;, temp = <span class="number">0</span>, lenth = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> b[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;, c[<span class="number">2000</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> count[<span class="number">127</span>] = &#123;<span class="number">0</span>&#125;, change_[<span class="number">38</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">char</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	FILE *fp = <span class="literal">NULL</span>;</span><br><span class="line">	</span><br><span class="line">	fp = fopen(<span class="string">"out"</span>, <span class="string">"rb"</span>);			<span class="comment">//先从文件读取密文</span></span><br><span class="line">	lenth = fread(b, <span class="number">1</span>, <span class="number">100</span>, fp);		<span class="comment">//返回读取成功个数, 确定字符个数</span></span><br><span class="line">	fclose(fp);</span><br><span class="line">		</span><br><span class="line">    </span><br><span class="line">    									<span class="comment">//第一层解密</span></span><br><span class="line">	temp = b[lenth<span class="number">-1</span>]&amp;<span class="number">7</span>;			    <span class="comment">//&amp;7  取后三位数据.</span></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; lenth; i++)						</span><br><span class="line">	&#123;									<span class="comment">//从整体来看就是将整个数据右移动3位</span></span><br><span class="line">		a[i] = (b[i] &gt;&gt; <span class="number">3</span>) | (temp &lt;&lt; <span class="number">5</span>);</span><br><span class="line">		temp = b[i]&amp;<span class="number">7</span>;</span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	fp = fopen(<span class="string">"that_girl"</span>, <span class="string">"rb"</span>); <span class="comment">//打开that_girl, 统计字符数.</span></span><br><span class="line">	fread(c, <span class="number">1</span>, <span class="number">1742</span>, fp);</span><br><span class="line">	fclose(fp); </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(c); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(c[i] &gt;= <span class="number">65</span> &amp;&amp; c[i] &lt;= <span class="number">90</span>)  </span><br><span class="line">			c[i] += <span class="number">32</span>;					<span class="comment">//因为不区分大小写, 都转换为小写</span></span><br><span class="line">			</span><br><span class="line">		count[c[i]]++; </span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(A.change[i]) </span><br><span class="line">	&#123;</span><br><span class="line">		change_[j++] = A.change[i];  <span class="comment">//统计每个字符出现次数</span></span><br><span class="line">		i = A.change[i];  </span><br><span class="line">	&#125;</span><br><span class="line">	j -= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	temp = a[<span class="number">0</span>], a[<span class="number">0</span>] = a[change_[j]];   <span class="comment">//第二层解密</span></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; lenth<span class="number">-2</span>; i++)		 <span class="comment">//按照给定赋值找到一个未变的值, 倒序赋值回去即可</span></span><br><span class="line">	&#123;</span><br><span class="line">		a[change_[j]] = a[change_[--j]];</span><br><span class="line">	&#125;</span><br><span class="line">	a[change_[j]] = temp; </span><br><span class="line">	</span><br><span class="line">	 </span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; lenth; i++) <span class="comment">//第三层解密, 比对每个字符出现的次数的顺序,进而确定输入顺序</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">127</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(a[i] == count[j])</span><br><span class="line">			&#123;</span><br><span class="line">				flag[i] = j; </span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; </span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"QCTF&#123;%s&#125;"</span>, flag);   <span class="comment">//得到flag.</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515135919513.png" alt="image-20200515135919513"></p>
</li>
<li><p><strong>总结: (1)算法还是太重要. 算法稍微好点的话, 这道题就轻松很多.  (2)注意64位程序的传递参数的方式</strong></p>
<p>​          <strong>(3)要习惯看汇编代码</strong></p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="easyre-153"><a href="#easyre-153" class="headerlink" title="easyre-153"></a>easyre-153</h3></blockquote>
<blockquote>
<p>题其实很简单,  但差点做到自闭… 其实能猜到flag怎么算出来, 但对程序的执行想不明白.</p>
</blockquote>
<ul>
<li><p>32位elf文件加了upx壳, 没有修改过的, 直接upx -d脱壳成功.<img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515184107394.png" alt="image-20200515184107394"></p>
</li>
<li><p>ida打开, 找到主函数. 一开始就认为直接动跳控制函数的走向, 到最后一个 <strong>lol</strong> 函数得到flag. 但是动态总是在read函数卡住, 走不了, 但这里我们并不能直接跳,因为这个函数是向<strong>buf</strong>写内容, 我们最后的flag是要使用buf的内容. 然后又转 GDB 调试, 同然的结果.    纳闷这题了, 它到底是要做什么. 其实猜也是把上面 write的那部分数据作为 buf 的内容, 然后在lol函数得到 flag.  但问题是 程序到底在搞什么…..</p>
<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515185409497.png" alt="image-20200515185409497"></p>
</li>
<li><p>真的做到自闭, 后来才发现我忽略上面的 pipe()函数与fork()函数. 第一次见到, 百度了下, 明白了…….</p>
<blockquote>
<p>首先是管道: 1.其本质是一个伪文件(实为内核缓冲区)</p>
<p>​                     2.由两个文件描述符引用，一个表示读端，一个表示写端。</p>
<p>​                     3.规定数据从管道的写端流入管道，从读端流出</p>
<p>pipe()函数用于创建管道: 1.int pipe(int pipefd[2]); 成功：0；失败：-1，设置errno</p>
<p>​                                           2.函数调用成功返回r/w两个文件描述符。无需open，但需手动close</p>
<p>​                                           3.规定：fd[0] → r； fd[1] → w，就像0对应标准输入，1对应标准输出一样。</p>
<p>​                                           4.向管道文件读写数据其实是在读写内核缓冲区</p>
<p><strong>这里就是通过pipedes[1]写进内容,  从pipedes[0]写出.</strong>                    </p>
</blockquote>
<blockquote>
<p>然后fork()函数. 1.fork（）函数通过系统调用创建一个与原来进程几乎完全相同的进程，</p>
<p>​                            也就是两个进程可以做完全相同的事，但如果初始参数或者传入的变量不同，两个进程                            也可以做不同的事</p>
<p>​                           2.一个进程调用fork（）函数后，系统先给新的进程分配资源，例如存储数据和代码的空                           间。然后把原来的进程的所有值都复制到新的新进程中，只有少数值与原来的进程值                           不同。相当于克隆了一个自己</p>
<p>​                           3.调用fork函数一次, 返回2次值, 若返回0则是子进程, 若是一个数则是父进程的进程号.</p>
<p><strong>所以这里就是先创建一个子进程,返回值v5 == 0, 进入子进程完成写入数据后结束进程, fork()返回新的值父进程进程号,然后执行后面的操作.</strong>        </p>
</blockquote>
</li>
<li><p>这里动态调试这种创建进程的程序是不通畅的. 那就通过修改程序 EIP, 按照本来要执行的顺序执行一遍得到flag.(注意这样可能会有一个问题: 栈不平衡, 因为函数没有正常返回, 那会影响一些函数, 比如scanf()函数执行到了, 不会让我们输入, 而是直接跳过, 这就是堆栈有值它就直接读取了)</p>
<p><img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200515193103677.png" alt="image-20200515193103677"></p>
</li>
<li><p><strong>总结:(1)对于盲区的知识, 搞起来还是麻烦, 积累. (2)熟悉了修改 EIP.</strong> </p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="76号公路"><a href="#76号公路" class="headerlink" title="76号公路"></a>76号公路</h3></blockquote>
<ul>
<li><p>题目看似很难的样子, 但自己确实被题目的信息误导了.</p>
</li>
<li><p>下载后, 2个文本一个32位无壳elf文件, 并且题目信息就给了 <strong>我们认为有份确切的文档记录了每个区域的功能，请协助找出</strong> 这个提示, 所以自己做题时始终想到怎么和文本联系起来, 找线索. 但其实不然</p>
</li>
<li><p>载入ida后, 搜索了下字符串, 找到了主函数, 但是不能转化为伪代码,  因为之前了解过点花指令,其中  <strong>E0</strong> 总是干扰代码的. 改为 <strong>90</strong> nop掉就可以了. </p>
</li>
<li><p>这里同样. 改完后, 开始读汇编代码, 逻辑很简单, 就是提示, 让我们输入字符, 进去一个函数判断.<img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200521123259003.png" alt="image-20200521123259003"></p>
</li>
<li><p>进去判断函数, 可以查看伪代码的. 分析一下就知道是跟着一条线按照顺序检索我们输入的字符串. 但是怎么找顺序呢, 因为文本文件还没用, 我就始终认为在文本文件找, 找了半天…….无果</p>
</li>
<li><p>最后回到程序发现, 可以找到入口点, 顺藤摸瓜的就可以找到了啊. 可以知道从索引 <strong>v2</strong> 从0开始, 直接从这里出发就好了. 直到正确退出循环.<img src="/2020/05/15/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(4)/image-20200521123808376.png" alt="image-20200521123808376"></p>
</li>
<li><p>最后得到flag: <strong>flag{09vdf7wefijbk}</strong>.</p>
</li>
<li><p><strong>总结: (1)不要让题目把自己的思路带偏了, 思维要发散一些.</strong>  </p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/12/%E8%AE%BA%E5%89%91%E5%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/12/%E8%AE%BA%E5%89%91%E5%9C%BA/" class="post-title-link" itemprop="url">论剑场</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-12 19:15:32 / Modified: 20:10:44" itemprop="dateCreated datePublished" datetime="2020-05-12T19:15:32+08:00">2020-05-12</time>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>634</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>首先, 感觉论剑场的一些题很怪, 且没有writeup.</p>
</blockquote>
<blockquote>
<h3 id="Refresh-it"><a href="#Refresh-it" class="headerlink" title="Refresh it"></a>Refresh it</h3></blockquote>
<ul>
<li><p>题目下载下来是一个.pcapng文件. 先用010editor看了看会不会只是简单的将文件格式改了, 因为是reverse题, 看了一圈, 的却是流量包.</p>
</li>
<li><p>在wireshark中尝试搜索了题目关键字refresh, 没有得到有用信息. 又接着尝试了搜索了很多, 都无果. </p>
</li>
<li><p>转到foremost和binwalk看看没有什么隐藏文件.  确实看到了2张图片, 提取出来但打不开, 考虑exe文件隐藏在图片文件中, 查看了图片文件信息, PE文件的影子都没有🤣.  没办法了, 题目先放一段时间.</p>
</li>
<li><p>这又是过了几天来看这个题目, 感觉自己找不到目标, 在盲目的找…很多办法都试了下. 唯一得到的就是图片.</p>
</li>
<li><p>看了看图片信息, 发现F5 refrehsh. 又从题目的信息, 你看到刷新按钮了嘛. 突然想到之前做过一个杂项题是F5-steganography隐写. 后面那个的refresh猜测是密码. 连忙去试了下, 错误…. 但是这个确实很像是考隐写.<img src="/2020/05/12/%E8%AE%BA%E5%89%91%E5%9C%BA/image-20200512194627578.png" alt="image-20200512194627578"></p>
</li>
<li><p>考虑是binwalk提取图片有损坏或者不全的原因, 因为图片是打不开的.  又跑去wireshark. 因为这次明确是找图片, 直接搜索了 jpg, 果然出现了个图片<img src="/2020/05/12/%E8%AE%BA%E5%89%91%E5%9C%BA/image-20200512200418460.png" alt="image-20200512200418460"></p>
</li>
<li><p>追踪tcp流把图片的二进制代码复制下来, winhex重建一个文件粘贴保存.注意文件头FF D8 文件尾 FF D9<img src="/2020/05/12/%E8%AE%BA%E5%89%91%E5%9C%BA/image-20200512200649037.png" alt="image-20200512200649037"></p>
</li>
<li><p>这次图片可以打开了, 是个刷新按钮, 再次去用F5隐写来解密. 终于成功了….</p>
<p><img src="/2020/05/12/%E8%AE%BA%E5%89%91%E5%9C%BA/image-20200512200849581.png" alt="image-20200512200849581"></p>
</li>
<li><p><strong>总结: 感觉花了很多时间, 简直就是杂项题啊. 另外题的提示信息太少. 熟悉了一些工具的使用吧</strong></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/12/ASLR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/12/ASLR/" class="post-title-link" itemprop="url">ASLR</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-12 12:15:30 / Modified: 12:17:24" itemprop="dateCreated datePublished" datetime="2020-05-12T12:15:30+08:00">2020-05-12</time>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p><strong>开始是一道CTF题加了UPX壳,  利用堆栈平衡脱壳,import rec进行IAT修复后,程序不能正常打开了.  后来才知道是开启了ASLR, 关闭后即可打开.  但有一个问题想了很久.  为什么开启了ASLR的程序在有壳时可以打开, 脱壳后就打不开了呢? 目前觉得是 加壳会对PE文件的重定位表进行压缩,在OD直接dump出的程序是丢失重定位表的, 而程序又是开启了ASLR,那程序自然会访问到无效的地址而打不开(如果不对, 希望大佬指正)</strong></p>
</blockquote>
<p>[TOC]</p>
<h6 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h6><ul>
<li><p>ASLR(地址空间布局随机化), 一种针对缓冲区溢出的安全保护技术. 从Windows Vsita(内核版本<strong>6.0</strong>)开始采用, 而Windows XP的内核版本是<strong>5.1</strong>, 所以我们在Windows XP下脱开启了ASLR 的壳是不会有这个问题的.</p>
</li>
<li><p>ASLR就是使我们的PE文件在每次载入内存时起始地址都会变得随机化, 增加恶意用户编写漏洞利用代码的难度(<strong>在之前我们知道只有dll文件在理想地址空间被占用了才会进行重定位</strong>)</p>
</li>
<li><p>对于ASLR功能我们系统(win10)是默认关闭的, 我们可以在设置的安全中心打开.<img src="/2020/05/12/ASLR/image-20200511184233641-1589256958059.png" alt="image-20200511184233641"></p>
<p>另外就是可执行文件的ASLR, 我们在我们的编译器上也可以选择是否引用该功能.<img src="/2020/05/12/ASLR/image-20200511185012962-1589256958060.png" alt="image-20200511185012962"></p>
</li>
</ul>
<h6 id="分析ASLR"><a href="#分析ASLR" class="headerlink" title="分析ASLR."></a>分析ASLR.</h6><ul>
<li><p>以VS编译器写一个程序, 分别生成开启了随机基址与未开启的的版本来分析. (<strong>一共有三个地方不同</strong>)</p>
<p><strong>(1)</strong>未开启ASLR的程序的<strong>文件头的Characteristics</strong>会多一个 <strong>IMAGE_FILE_RELOCS_STRIPPED   0X0001</strong> 的属性, 经过查看官方文档可以看得到属性解释, 所以我们开启ASLRd的程序不会有这个属性<img src="/2020/05/12/ASLR/image-20200511200244008-1589256958060.png" alt="image-20200511200244008"></p>
<p>​    下面看程序对比:</p>
<p><img src="/2020/05/12/ASLR/image-20200511201513817-1589256958060.png" alt="image-20200511201513817"></p>
</li>
</ul>
<p>  <strong>(2)</strong>开启了ASLR的程序的<strong>可选头的DllCharacteristics</strong>多了<strong>IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE</strong></p>
<p>  <strong>0X0040</strong>的属性. 同样查看官方文档. 即重定位时需要的属性.<img src="/2020/05/12/ASLR/image-20200511201801401-1589256958060.png" alt="image-20200511201801401"></p>
<p>  程序对比:<img src="/2020/05/12/ASLR/image-20200511202308748-1589204427416-1589204437657-1589256958060.png" alt="image-20200511202308748"></p>
<p>  <strong>(3)</strong>开启了ASLR的程序会多一个 <strong>.reloc</strong> 节(一般普通的exe文件是不需要该节的, 用于开启ASLR的程序进行重定位, 当然我们关闭了ASLR也可以把这个节删了)<img src="/2020/05/12/ASLR/image-20200511202858464-1589256958060.png" alt="image-20200511202858464"></p>
<h6 id="关闭ASLR"><a href="#关闭ASLR" class="headerlink" title="关闭ASLR"></a>关闭ASLR</h6><ul>
<li><p>由上面的分析知道有3处不同, 其中上面的<strong>(1)</strong>中是开启了ASLR的程序少了 <strong>IMAGE_FILE_RELOCS_STRIPPED   0X0001</strong>属性, 我们增加上这个属性即可关闭ASLR(即 <strong>0102 -&gt; 0103</strong> / <strong>对应属性打上勾即可</strong>).    另外<strong>(2)</strong>中是多了<strong>DLL can move</strong>的属性,删除这个属性,同样可以关闭ASLR(即 <strong>8140 -&gt; 8100</strong> / <strong>对应属性取消打勾即可</strong> )</p>
<p>下面示例在010编译器中修改数值来关闭ASLR.<img src="/2020/05/12/ASLR/image-20200511204613644-1589256958060.png" alt="image-20200511204613644"></p>
</li>
</ul>
<blockquote>
<p><strong>以上是关于ASLR的分析即关闭, 如果开启了ASLR, 我们在脱壳之前还是先关闭它最好,也方便调试时IDA与OD中地址的对应(如果只是想地址对应, 也可以在IDA中启动时把Manual load勾上, 手动输入加载的基地址即可),  既然关闭了ASLR, 那多出的.reloc节也就没用了, 下面手动删除该节区(虽然有很多工具可以直接实现, 还是手动熟悉下PE结构)</strong></p>
</blockquote>
<h6 id="删除-reloc节区"><a href="#删除-reloc节区" class="headerlink" title="删除.reloc节区."></a>删除.reloc节区.</h6><ul>
<li><p>首先每个节都对应一个节区头的, 那先从节区头开始. 使用010editor可以轻松在最后一节区头找到.  我们将其全部用0覆盖填充即可.(注: 不能直接删除了, 不然PE文件的很多属性会对应不上)<img src="/2020/05/12/ASLR/image-20200511205903649-1589256958060.png" alt="image-20200511205903649"></p>
</li>
<li><p>下面删除.reloc整个节区(一般这个节区都是新加的,所以在最后, 我们只要找到偏移地址直接删除到最后即可), 如图, 直接删除到最后即可. (这里的Size: 600h, 下面有用)<img src="/2020/05/12/ASLR/image-20200511210742225-1589256958060.png" alt="image-20200511210742225"></p>
</li>
<li><p>删除完后, 我们知道PE文件头的<strong>_IMAGE_FILE_HEADER</strong>的<strong>NumberOfSections</strong>的值一定要严格的与实际节区对应, 所以去修改 <strong>_IMAGE_FILE_HEADER</strong>的<strong>NumberOfSections</strong>使其减一.<img src="/2020/05/12/ASLR/image-20200511210943674-1589256958060.png" alt="image-20200511210943674">)<img src="/2020/05/12/ASLR/image-20200511211434269-1589256958060.png" alt="image-20200511211434269"></p>
</li>
<li><p>最后还有修改一个属性, 就是PE文件头 <strong>_IMAGE_OPTIONAL_HEADER</strong></p>
<p>的<strong>SizeOfImage</strong>, 修改为减去 .reloc节区后的大小  从上面我们知道.reloc大小是600h, 而该PE文件<strong>SectionAlignment(节在内存中的最小单位 (对齐单位) 一般为: 1000h)为1000h</strong>, 1000h &gt; 600h. 以1000h对齐, 所以我们直接将<strong>SizeOfImage</strong>减去1000h即可.<img src="/2020/05/12/ASLR/image-20200511211537176-1589256958060.png" alt="image-20200511211537176">)<img src="/2020/05/12/ASLR/image-20200511212159056-1589256958060.png" alt="image-20200511212159056"></p>
<blockquote>
<p>如果想增加一个节区, 也可以使用同样的方法</p>
</blockquote>
</li>
<li><p><strong>最后以上是对目前ALSR学习的总结(刚接触不久),  如果有错误的地方请大家指正.</strong> </p>
</li>
<li><p><strong>原CTF题也附上.</strong></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/" class="post-title-link" itemprop="url">攻防世界 (3)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-03 13:49:15" itemprop="dateCreated datePublished" datetime="2020-05-03T13:49:15+08:00">2020-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-12 13:51:38" itemprop="dateModified" datetime="2020-05-12T13:51:38+08:00">2020-05-12</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>4.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>4 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<blockquote>
<h3 id="easy-Maze"><a href="#easy-Maze" class="headerlink" title="easy_Maze"></a>easy_Maze</h3></blockquote>
<ul>
<li><p>这道题还是挺好玩的. </p>
</li>
<li><p>由题目我们能知道是关于迷宫的题. 下载下来是elf文件, 查壳后无壳, 在linux下运行看看大概流程. </p>
</li>
<li><p>载入IDA, 先分析了接受我们输入的字符的函数.  知道在外面一层的主函数是先生成一个每行7个元素的数组. 然后通过我们输入的字符按控制在矩阵迷宫中走向, 最后按照规定的到达一个目的地.<img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200504133456542.png" alt="image-20200504133456542"></p>
</li>
<li><p>接下来返回外侧的主函数, 就是生成矩阵的了. 通过上面的49个元素知道且下面函数的参数7, 知道规模 7*7. <img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200504133948097.png" alt="image-20200504133948097"></p>
</li>
<li><p>进入<strong>Step_0</strong> 看看. 就是简单的把上面49个元素赋值给 v7 数组, 也印证了数组是7*7<img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200506194728611.png" alt="image-20200506194728611"></p>
</li>
<li><p>接下来 <strong>Step_1</strong>, 看起来是很简洁, 但里面的 <strong>getA</strong>与 <strong>getAstart</strong> 函数 算法太冗长了.<img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200506195403856.png" alt="image-20200506195403856"></p>
</li>
<li><p>这个时候, 开始我就把生成矩阵的所有函数及数据都复制到<strong>VC</strong> 编译器中, 再根据栈的特点改下数据的顺序(<strong>数据存放是从下往上, 那么我们取数据时地址每次减1而不是加一</strong>), 然后运行打印出矩阵. 问题是运行后什么也没有打印, 调试发现一个函数中的内存空间和另外一个冲突, 相互覆盖值. 这个函数太多,关联性大, 改起来也麻烦.</p>
</li>
<li><p>然后转向GDB调试, 但是不熟练. 又转向ida动态调试. 首先<strong>在 IDA 的安装目录/dbgsrc/找到 linux_server 和 linux_server64 拷贝到 linux</strong> ,在linux中运行 <strong>linux_server64</strong>, 然后在Debugger的 process options 如下图格式配置. 然后F9开始.</p>
<p><img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200506202545180.png" alt="image-20200506202545180"></p>
</li>
<li><p>先下断点, 找到储存矩阵的空间的地址, 把这个地址转到数据窗口跟随, 然后运行到生成矩阵的下面一个函数(也就是(<strong>Step_1</strong>下面). 在数据窗口出现我们的数据(int型), 由于是49个元素, 49*4/16 = 12 …4  ,那就是12行加4个数据, <strong>shift+E</strong>提取出C语言格式的数据.<img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200504135411101.png" alt="image-20200504135411101"></p>
</li>
<li><p>数据得到后, 用C语言打印出来好观察, 注意每个数据4个字节(小端). </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">union</span> 	<span class="comment">//每个数据4个字节, 且小端. 用联合</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> ida_chars[<span class="number">196</span>];</span><br><span class="line">		<span class="keyword">int</span> a[<span class="number">49</span>];</span><br><span class="line">	&#125;A = &#123;</span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span></span><br><span class="line">		&#125;;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> (*p)[<span class="number">7</span>] = (<span class="keyword">int</span> (*)[<span class="number">7</span>])A.a;  <span class="comment">// 强制转化为数组指针, 方便后面打印</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">7</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%d "</span>, p[i][j]);</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	 </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200506201841271.png" alt="image-20200506201841271"></p>
</li>
<li><p>根据我们打游戏的熟悉 aswd ,朝着1走到最后.  <strong>ssddwdwdddsssaasasaaassddddwdds</strong> 最后在linux下输入.</p>
<p><img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200504140433640.png" alt="image-20200504140433640"></p>
</li>
<li><p><strong>总结: 更加熟悉了linux动态调试的运用,  加深了数组指针的理解.</strong></p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="simple-check-100"><a href="#simple-check-100" class="headerlink" title="simple-check-100"></a>simple-check-100</h3></blockquote>
<ul>
<li><p>题目本来很简单, 但是有坑啊…</p>
</li>
<li><p>首先, 题目下载下来, 有三个版本. 下意识的选择了熟悉的.exe来分析. </p>
</li>
<li><p>查壳无壳, 用ida打开. 第一直觉就是这个最后的flag与我们输入字符没关系, 直接OD动态调试跳过判断条件就好了.</p>
</li>
<li><p>还是先细看一下栈空间, 虽然还是和我们输入的字符没有关系. 但是有问题啊,要用的地址交叉了.  想着万一题就是这样呢, 先取OD试一下. 不出所料, 乱码😢 </p>
</li>
<li><p>开始仔细分析下这个题的栈空间, 在OD反复调试, 发现我们输入字符的空间只有19个字节啊, 为什么我们输入的字符栈空间在OD中调试有19+32 = 51字节空间.</p>
<p><img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200506144401943.png" alt="image-20200506144401943"></p>
</li>
<li><p>看了半天不知道为什么, 后面才看见程序下面有  <strong>v3 = alloca(32);</strong> 百度了一下, 这个是再栈上申请空间的函数. 正好是多出来的32. </p>
</li>
<li><p>经过反复调试, 这个题怎么也和我们输入的字符没关系啊, 程序每次过了判断条件, 算的都一样. 真的奇怪了.</p>
</li>
<li><p>最后没办法了,想不通.  就最后再把文件中这个程序的linux版本载入ida看看,  嗯….这个版本的栈空间就没有交叉. v7一直到v34, 没有像PE文件那个版本在中间多一个指针.<img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200506145151730.png" alt="image-20200506145151730"></p>
</li>
<li><p>在linux下动态调试.<img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200506145627945.png" alt="image-20200506145627945"></p>
</li>
<li><p>😂什么鬼题. PE文件版本居然是有问题的!!!</p>
</li>
<li><p><strong>总结: 文件有多个版本的时候, 注意!!! 张见识了. 虽然多花了时间在PE上耗, 但是对栈更清楚了.</strong></p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="zorropub"><a href="#zorropub" class="headerlink" title="zorropub"></a>zorropub</h3></blockquote>
<ul>
<li><p>查壳查位数后载入ida, 整体思路如下.<img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200508104152981.png" alt="image-20200508104152981"></p>
</li>
<li><p>那其实我们是不用管这个 MD5 加密的 , 也不会这个解密.  直接爆破找到 <strong>i</strong> 值从而得到随机数种子.</p>
</li>
<li><p>那问题来了, 爆破找了一个 <strong>i</strong> 值是1023, 就在linux写了exp(<strong>不能在window下, 因为生成随机数不同</strong>). 但得到的数据都是乱码的, 我还是一直以为问题出现在 <strong>LOBYTE(取最低字节位)</strong> 因为第一次接触. </p>
</li>
<li><p>最后才想起那个 <strong>i</strong> 的值, 它可能不是唯一的. 开始写exp, 取大范围的数据爆破, 果然对了……</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> *c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> b = <span class="number">0</span>, f = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">	srand(a);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">29</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">                b = rand()%<span class="number">1000</span>;</span><br><span class="line">                flag[i] = b^c[<span class="number">4</span>*i];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(flag[i] &gt; <span class="number">126</span> || flag[i] &lt; <span class="number">32</span>)</span><br><span class="line">		f = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!f)</span><br><span class="line">	<span class="built_in">puts</span>(flag);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, b = <span class="number">0</span>, j = <span class="number">0</span>, cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> a[<span class="number">1000</span>] = &#123;</span><br><span class="line">  		<span class="number">200</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">50</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">206</span>,   <span class="number">2</span>,</span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">2</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">127</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,</span><br><span class="line">  		<span class="number">184</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">126</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">136</span>,   <span class="number">1</span>,</span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">73</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">127</span>,   <span class="number">2</span>,   <span class="number">0</span>,   <span class="number">0</span>,</span><br><span class="line">   		<span class="number">94</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">52</span>,   <span class="number">2</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">84</span>,   <span class="number">3</span>,</span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>, <span class="number">163</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">150</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,</span><br><span class="line">   		<span class="number">64</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">40</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">252</span>,   <span class="number">2</span>,</span><br><span class="line">   		<span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">142</span>,   <span class="number">2</span>,   <span class="number">0</span>,   <span class="number">0</span>,</span><br><span class="line">   		<span class="number">38</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">27</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">42</span>,   <span class="number">3</span>,</span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>, <span class="number">245</span>,   <span class="number">2</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">95</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,</span><br><span class="line">  		<span class="number">104</span>,   <span class="number">3</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">235</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">121</span>,   <span class="number">0</span>,</span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">29</span>,   <span class="number">1</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">78</span>,   <span class="number">2</span>,   <span class="number">0</span>,   <span class="number">0</span></span><br><span class="line">			&#125;;</span><br><span class="line">	<span class="keyword">char</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		j = i;</span><br><span class="line">		<span class="keyword">while</span>(j)</span><br><span class="line">		&#123;</span><br><span class="line">			cnt++;</span><br><span class="line">			j &amp;= j<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span>(cnt &gt; <span class="number">10</span>)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(cnt == <span class="number">10</span>)</span><br><span class="line">		func(i,  a);</span><br><span class="line"></span><br><span class="line">		cnt = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200508105155224.png" alt="image-20200508105155224"></p>
</li>
<li><p>然后做完, 还是去看看大佬的writeup. 想看看那个md5怎解密, 但是没有.  却发现好多都是用的pwntools工具来爆破的, 自己也去试了下, 确实简单很多.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">a = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>, <span class="number">0xffff</span>):</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    j = i</span><br><span class="line">    <span class="keyword">while</span>(j):</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">        j &amp;= j<span class="number">-1</span></span><br><span class="line">    <span class="keyword">if</span> cnt == <span class="number">10</span>:</span><br><span class="line">        a.append(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    p = process(<span class="string">"./11"</span>)</span><br><span class="line">    p.recv()</span><br><span class="line">    p.sendline(<span class="string">'1'</span>)</span><br><span class="line">    p.sendline(str(i))</span><br><span class="line">    ans = p.recv()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"NULL"</span> <span class="keyword">in</span> text:</span><br><span class="line">        <span class="keyword">print</span> (text)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    p.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>总结: (1)既然是爆破就要注意有多种情况 (2) LOBYTE 是ida的宏定义, 取最低字节位. (3)更加熟悉pwntools工具的使用.</strong></p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="BABYRE"><a href="#BABYRE" class="headerlink" title="BABYRE"></a>BABYRE</h3></blockquote>
<ul>
<li><p>题目不难, 但是第一次遇到这样的题.</p>
</li>
<li><p>64位elf文件, ida打开后, 和以往的文件不一样, 开始有一段循环计算赋值的操作,但是又是看不到到底是赋值给了谁.<img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200512134025680.png" alt="image-20200512134025680"></p>
</li>
<li><p>那就动态调试跟来看看, 到了判断条件的时候. 明白了就是类似加壳的程序打开会先进行解压生成代码. 这里开始那一段循环作用, 就改变我们代码的.</p>
</li>
<li><p>跟进判断函数, 算法很简单,直接读汇编,  就是一个异或操作然后对比. </p>
<p><img src="/2020/05/03/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(3)/image-20200512133918795.png" alt="image-20200512133918795"></p>
</li>
<li><p>exp:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a[] = &#123;<span class="number">0x66</span>, <span class="number">0x6D</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x7F</span>, <span class="number">0x6B</span>, <span class="number">0x37</span>, <span class="number">0x64</span>,  <span class="number">0x3B</span>, <span class="number">0x56</span>, <span class="number">0x60</span>, <span class="number">0x3B</span>, <span class="number">0x6E</span>, <span class="number">0x70</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt;= <span class="number">13</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		flag[i] = a[i] ^ i; </span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="built_in">puts</span>(flag);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>总结: 算是长见识吧.</strong></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/" class="post-title-link" itemprop="url">攻防世界 (2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-29 14:53:15" itemprop="dateCreated datePublished" datetime="2020-04-29T14:53:15+08:00">2020-04-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-03 17:55:20" itemprop="dateModified" datetime="2020-05-03T17:55:20+08:00">2020-05-03</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>10k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>9 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<h3 id="Windows-Reverse2"><a href="#Windows-Reverse2" class="headerlink" title="Windows_Reverse2"></a>Windows_Reverse2</h3></blockquote>
<ul>
<li><p>首先,因为是个.exe文件, 先打开看一下程序是做什么的, 出现 <strong>input code:</strong> 也就是让我们输入一个密码验证.</p>
</li>
<li><p>用ida打开, 还是先 shift + 12 搜索一下字符串, 然而并没有发现我们打开程序看到的 *<em>input code: *</em>,并且程序函数也很少, 那就是加壳了的. 开始也忘了用软件查一下壳.</p>
</li>
<li><p>那么用OD打开, 使用堆栈平衡的方法, 找到程序的 OEP, 然后dump, 但是注意改一下加载的初始地址和入口点,   这个程序并不是 0x400000开始, 每次加载都是不一样的地址,应该是 ASLR保护技术吧, 之前有了解过一些.通过内存窗口, 知道了是 0x1F0000.</p>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200429150859645.png" alt="image-20200429150859645"></p>
</li>
<li><p>dump出后,但是打不开, 之前学习脱壳时了解过,但是没有实践. 就去下载<strong>import rec</strong>,但打开找不到桌面的文件,  试了好几个也不行, 百度也无果. 也不想用脱壳软件,主要想操作一下. 其实对于去ida反编译已经足够了,因为那个只是会影响动态链接的函数.</p>
</li>
<li><p>ida再次打开后, 找到主函数, 转换为伪代码, 逻辑很简单, 就是把我们输入的字符先进行判断,然后进行加密,与编码的字符对比. 先看判断函数.</p>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200429152407648.png" alt="image-20200429152407648"></p>
</li>
<li><p>然后看关键的加密函数, 发现最下面还有一个函数 sub_A71000.</p>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200429162141561.png" alt="image-20200429162141561"></p>
</li>
<li><p>sub_A7100, 刚开始看这个函数觉得很麻烦, 但是从以前做的题来看, 并且这个函数有 &gt;&gt; 运算符. 可以往base编码考虑, 那就先看看有没有base编码的标志.</p>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200429155217177.png" alt="image-20200429155217177"></p>
</li>
<li><p>到了这里 , 可以知道, 程序只是标准码换了一下. 我们就用程序编码的数据和 0x76 异或运算得到 得到这里的base64 的码. 然后这个码去解码后面用来做比较的字符,得到第一次转换后的结果. 但是异或运算后, 我们发现这个码就是base64标准码.</p>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200429160021209.png" alt="image-20200429160021209"></p>
</li>
<li><p>最后, 知道开始是把我们输入的字符进行数值转换的, 那么最后解码后我们也要还原一下. 懒得C语言自己写了, 用 python 的 hex(). 最后 flag就是  <strong>ADEBDEAEC7BE</strong> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">s =  base64.b64decode(<span class="string">'reverse+'</span>)</span><br><span class="line"><span class="keyword">print</span> (type(s)) / 刚学python,查看一下是什么类型,因为用hex(), 发现 list, tuple都没有 hex().</span><br><span class="line"><span class="keyword">print</span> (s.hex().upper())</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200501113755270.png" alt="image-20200501113755270"></p>
</li>
<li><p><strong>总结: 1.题目有时候看起来代码很冗长, 但逻辑不难的, 细心分析一下.  要注意base家族的编码与解码.   2.正在学习python中, 每次写python脚本都有收获.</strong></p>
</li>
</ul>
<table>
<thead>
<tr>
<th>字符串前添加r , 表示后续的字符串原样输出, 不进行转义. 如 \\ 转义后为 \</th>
</tr>
</thead>
<tbody><tr>
<td><strong>字符串前添加b, 后面字符串是bytes 类型</strong></td>
</tr>
<tr>
<td><strong>在 Python3 中，bytes 和 str 的互相转换方式是:str.encode(‘utf-8’)   bytes.decode(‘utf-8’)</strong></td>
</tr>
</tbody></table>
<hr>
<blockquote>
<h3 id="Windows-Reverse1"><a href="#Windows-Reverse1" class="headerlink" title="Windows_Reverse1"></a>Windows_Reverse1</h3></blockquote>
<ul>
<li><p>首先这道题与上面的一道是一起的, 做了上面的一道题, 觉得应该还是有壳的, 查一下是 upx.</p>
</li>
<li><p>载入OD还是使用堆栈平衡的原理脱壳, 发现同样是每次载入的地址不一样, 脱壳后还是不能运行, 还是要修复输入表, 但import rec又找不到我电脑的文件…….就先把题做了再来研究.</p>
</li>
<li><p>ida载入后十分简洁. 一个加密函数后进行判断. 看加密函数.<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200430190548596.png" alt="image-20200430190548596"></p>
</li>
<li><p>因为上面的 Reverse1 也是又同样的问题(<strong>不同的变量如何联系在一起的</strong>), 变量地址是相同的. 就先看看上面 <strong>v1的地址, 发现是 ecx 传来的</strong>, 那再看看上一层函数的 ecx . 发现在调用这个加密函数之前有一个ecx赋值. <strong>而要用来最后比较的 v4变量, 它的地址和传给ecx是一样的</strong>.  <strong><em>那这里就是通过寄存器传递的参数.</em></strong></p>
</li>
<li><p>上面的代码觉得奇怪, 怀疑是ida的原因, 把原程序到 OD 动态调试看一下加密函数.  清晰很多.</p>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200430192452991.png" alt="image-20200430192452991"></p>
<p>所以这个函数就是通过我们输入的ASCII为索引值来依次取出编码字符的数据, 最后<strong>DDCTF{reverseME}</strong>进行比较.</p>
</li>
<li><p>可以看到是从 0x402FF8 为首地址开始索引, 但是从ida中可以知道 可打印字符是从0x403018开始的.<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200430200350749.png" alt="image-20200430200350749"></p>
</li>
<li><p>最后,我遇到的很大的坑…..🤣, 字符串复制下来后, 我没有处理其中的  \  的字符, 那么就被默认为转义字符了, 导致2个字符变成一个, 最后结果肯定错.  花了好多时间找这个错误, 还是没有在细节上注意😢.   <strong>exp:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> a[] = <span class="string">"~&#125;|&#123;zyxwvutsrqponmlkjihgfedcba`_^]\\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210/.-,+*)(',27h,'&amp;%$#\"! "</span>; </span><br><span class="line">	<span class="keyword">char</span> b[] = <span class="string">"DDCTF&#123;reverseME&#125;"</span>;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	 </span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(b); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(a); j++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(a[j] == b[i])</span><br><span class="line">			&#123;</span><br><span class="line">				flag[i] = j + <span class="number">0x20</span>;</span><br><span class="line">				<span class="keyword">break</span>; </span><br><span class="line">			&#125; </span><br><span class="line">		&#125; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">puts</span>(flag);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>做完后,开始去了解 <strong>ASLR</strong>, 知道了开启ASLR的PE文件会多了一个.reloc节区, 且IMAGE_OPTIONAL_HEADER32结构中的DllCharacteristics多了一个属性. 如果一个程序开启了ASLR保护, 我们可以将这个DllCharacteristics的值从<strong>8140</strong>改为<strong>8100</strong>从而关闭ASLR.<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200430204438115.png" alt="image-20200430204438115"></p>
</li>
<li><p><strong>总结: (1)一个程序中的参数可能会以寄存器的来传递 (2)字符串中注意 \ 字符, 要用 \\来表示 \ 字符. (3)程序的ASLR的开启标志及关闭方法.</strong> </p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="gametime"><a href="#gametime" class="headerlink" title="gametime"></a>gametime</h3></blockquote>
<ul>
<li><p>首先查壳, 发现无壳. 打开程序看一下.   果然是一个游戏, 简单的看了一下, 是让我们在规定时间输入屏幕上显示的字符. </p>
</li>
<li><p>ida打开, 看伪代码, 很冗长,  向下浏览一下可以看见好几个判断函数. 且都是一个函数, 程序肯定不应该是退出. 我们的目的就是让它的返回值为 <strong>非0</strong></p>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200501104557726.png" alt="image-20200501104557726"></p>
</li>
<li><p>进入 sub_401507 看看. 发现还有个判断的地方, <strong>我们的目的: 让它返回1</strong> 记录下地址. <strong>0x00401563</strong>. <img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200501105251204.png" alt="image-20200501105251204"></p>
</li>
<li><p>此时程序下面还有类似的判断函数, 那么相同的方法, 先找到地址, 记录下来.</p>
</li>
<li><p>最后发现, 程序的核心判断函数就只有2个.  地址分别为:  <strong>0x00401563</strong> ,  <strong>0x004014DB</strong> </p>
</li>
<li><p>把程序载入OD. 跳到我们找到的地址, 发现地址对不上, 那程序是开启了 ASLR 的, 但是 RVA 是一样的, 简单的算一下就可以了.   另外一个地址, 相同的操作.<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200501110440340.png" alt="image-20200501110440340"></p>
</li>
<li><p>最后F9运行, 游戏进行一段时间, 出现flag. <img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200501110942866.png" alt="image-20200501110942866"></p>
</li>
<li><p><strong>总结: 简单的动态调试的应用, 注意地址是不是 image base.</strong></p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="Replace"><a href="#Replace" class="headerlink" title="Replace"></a>Replace</h3></blockquote>
<ul>
<li><p>首先查壳, 发现是 upx. 载入OD, 准备脱壳, 但是发现 <strong>VA</strong> 不是默认加载的0x400000, 应该是开启了 ASLR.  转到010editor,找到 <strong>struct DLL_CHARACTERISTICS DllCharacteristics</strong>, 将8140改为8100.<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200502082437777.png" alt="image-20200502082437777"></p>
</li>
<li><p>接下来, 重新载入OD,使用堆栈平衡找到程序 EOP, 然后 dump.</p>
</li>
<li><p>脱壳后载入IDA, 程序逻辑简单, 首先限制长度 &lt;= 37, 然后一个判断函数, 我们进入: 算法也不难.<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200502083116266.png" alt="image-20200502083116266"></p>
</li>
<li><p>exp:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> a[] = &#123;</span><br><span class="line">   <span class="number">50</span>,  <span class="number">97</span>,  <span class="number">52</span>,  <span class="number">57</span>, <span class="number">102</span>,  <span class="number">54</span>,  <span class="number">57</span>,  <span class="number">99</span>,  <span class="number">51</span>,  <span class="number">56</span>, </span><br><span class="line">   <span class="number">51</span>,  <span class="number">57</span>,  <span class="number">53</span>,  <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>,  <span class="number">57</span>,  <span class="number">54</span>, <span class="number">100</span>,  <span class="number">54</span>, </span><br><span class="line">  <span class="number">100</span>, <span class="number">101</span>,  <span class="number">57</span>,  <span class="number">54</span>, <span class="number">100</span>,  <span class="number">54</span>, <span class="number">102</span>,  <span class="number">52</span>, <span class="number">101</span>,  <span class="number">48</span>, </span><br><span class="line">   <span class="number">50</span>,  <span class="number">53</span>,  <span class="number">52</span>,  <span class="number">56</span>,  <span class="number">52</span>,  <span class="number">57</span>,  <span class="number">53</span>,  <span class="number">52</span>, <span class="number">100</span>,  <span class="number">54</span>, </span><br><span class="line">   <span class="number">49</span>,  <span class="number">57</span>,  <span class="number">53</span>,  <span class="number">52</span>,  <span class="number">52</span>,  <span class="number">56</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>,  <span class="number">54</span>, </span><br><span class="line">  <span class="number">101</span>,  <span class="number">50</span>, <span class="number">100</span>,  <span class="number">97</span>, <span class="number">100</span>,  <span class="number">54</span>,  <span class="number">55</span>,  <span class="number">55</span>,  <span class="number">56</span>,  <span class="number">54</span>, </span><br><span class="line">  <span class="number">101</span>,  <span class="number">50</span>,  <span class="number">49</span>, <span class="number">100</span>,  <span class="number">53</span>,  <span class="number">97</span>, <span class="number">100</span>,  <span class="number">97</span>, <span class="number">101</span>,  <span class="number">54</span>, </span><br><span class="line">    <span class="number">0</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">char</span> b[] = &#123;</span><br><span class="line">   <span class="number">97</span>,  <span class="number">52</span>,  <span class="number">57</span>, <span class="number">102</span>,  <span class="number">54</span>,  <span class="number">57</span>,  <span class="number">99</span>,  <span class="number">51</span>,  <span class="number">56</span>, </span><br><span class="line">   <span class="number">51</span>,  <span class="number">57</span>,  <span class="number">53</span>,  <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>,  <span class="number">57</span>,  <span class="number">54</span>, <span class="number">100</span>,  <span class="number">54</span>, </span><br><span class="line">  <span class="number">100</span>, <span class="number">101</span>,  <span class="number">57</span>,  <span class="number">54</span>, <span class="number">100</span>,  <span class="number">54</span>, <span class="number">102</span>,  <span class="number">52</span>, <span class="number">101</span>,  <span class="number">48</span>, </span><br><span class="line">   <span class="number">50</span>,  <span class="number">53</span>,  <span class="number">52</span>,  <span class="number">56</span>,  <span class="number">52</span>,  <span class="number">57</span>,  <span class="number">53</span>,  <span class="number">52</span>, <span class="number">100</span>,  <span class="number">54</span>, </span><br><span class="line">   <span class="number">49</span>,  <span class="number">57</span>,  <span class="number">53</span>,  <span class="number">52</span>,  <span class="number">52</span>,  <span class="number">56</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>,  <span class="number">54</span>, </span><br><span class="line">  <span class="number">101</span>,  <span class="number">50</span>, <span class="number">100</span>,  <span class="number">97</span>, <span class="number">100</span>,  <span class="number">54</span>,  <span class="number">55</span>,  <span class="number">55</span>,  <span class="number">56</span>,  <span class="number">54</span>, </span><br><span class="line">  <span class="number">101</span>,  <span class="number">50</span>,  <span class="number">49</span>, <span class="number">100</span>,  <span class="number">53</span>,  <span class="number">97</span>, <span class="number">100</span>,  <span class="number">97</span>, <span class="number">101</span>,  <span class="number">54</span>, </span><br><span class="line">    <span class="number">0</span></span><br><span class="line">			&#125;;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> c[] = &#123;</span><br><span class="line">   <span class="number">99</span>, <span class="number">124</span>, <span class="number">119</span>, <span class="number">123</span>, <span class="number">242</span>, <span class="number">107</span>, <span class="number">111</span>, <span class="number">197</span>,  <span class="number">48</span>,   <span class="number">1</span>, </span><br><span class="line">  <span class="number">103</span>,  <span class="number">43</span>, <span class="number">254</span>, <span class="number">215</span>, <span class="number">171</span>, <span class="number">118</span>, <span class="number">202</span>, <span class="number">130</span>, <span class="number">201</span>, <span class="number">125</span>, </span><br><span class="line">  <span class="number">250</span>,  <span class="number">89</span>,  <span class="number">71</span>, <span class="number">240</span>, <span class="number">173</span>, <span class="number">212</span>, <span class="number">162</span>, <span class="number">175</span>, <span class="number">156</span>, <span class="number">164</span>, </span><br><span class="line">  <span class="number">114</span>, <span class="number">192</span>, <span class="number">183</span>, <span class="number">253</span>, <span class="number">147</span>,  <span class="number">38</span>,  <span class="number">54</span>,  <span class="number">63</span>, <span class="number">247</span>, <span class="number">204</span>, </span><br><span class="line">   <span class="number">52</span>, <span class="number">165</span>, <span class="number">229</span>, <span class="number">241</span>, <span class="number">113</span>, <span class="number">216</span>,  <span class="number">49</span>,  <span class="number">21</span>,   <span class="number">4</span>, <span class="number">199</span>, </span><br><span class="line">   <span class="number">35</span>, <span class="number">195</span>,  <span class="number">24</span>, <span class="number">150</span>,   <span class="number">5</span>, <span class="number">154</span>,   <span class="number">7</span>,  <span class="number">18</span>, <span class="number">128</span>, <span class="number">226</span>, </span><br><span class="line">  <span class="number">235</span>,  <span class="number">39</span>, <span class="number">178</span>, <span class="number">117</span>,   <span class="number">9</span>, <span class="number">131</span>,  <span class="number">44</span>,  <span class="number">26</span>,  <span class="number">27</span>, <span class="number">110</span>, </span><br><span class="line">   <span class="number">90</span>, <span class="number">160</span>,  <span class="number">82</span>,  <span class="number">59</span>, <span class="number">214</span>, <span class="number">179</span>,  <span class="number">41</span>, <span class="number">227</span>,  <span class="number">47</span>, <span class="number">132</span>, </span><br><span class="line">   <span class="number">83</span>, <span class="number">209</span>,   <span class="number">0</span>, <span class="number">237</span>,  <span class="number">32</span>, <span class="number">252</span>, <span class="number">177</span>,  <span class="number">91</span>, <span class="number">106</span>, <span class="number">203</span>, </span><br><span class="line">  <span class="number">190</span>,  <span class="number">57</span>,  <span class="number">74</span>,  <span class="number">76</span>,  <span class="number">88</span>, <span class="number">207</span>, <span class="number">208</span>, <span class="number">239</span>, <span class="number">170</span>, <span class="number">251</span>, </span><br><span class="line">   <span class="number">67</span>,  <span class="number">77</span>,  <span class="number">51</span>, <span class="number">133</span>,  <span class="number">69</span>, <span class="number">249</span>,   <span class="number">2</span>, <span class="number">127</span>,  <span class="number">80</span>,  <span class="number">60</span>, </span><br><span class="line">  <span class="number">159</span>, <span class="number">168</span>,  <span class="number">81</span>, <span class="number">163</span>,  <span class="number">64</span>, <span class="number">143</span>, <span class="number">146</span>, <span class="number">157</span>,  <span class="number">56</span>, <span class="number">245</span>, </span><br><span class="line">  <span class="number">188</span>, <span class="number">182</span>, <span class="number">218</span>,  <span class="number">33</span>,  <span class="number">16</span>, <span class="number">255</span>, <span class="number">243</span>, <span class="number">210</span>, <span class="number">205</span>,  <span class="number">12</span>, </span><br><span class="line">   <span class="number">19</span>, <span class="number">236</span>,  <span class="number">95</span>, <span class="number">151</span>,  <span class="number">68</span>,  <span class="number">23</span>, <span class="number">196</span>, <span class="number">167</span>, <span class="number">126</span>,  <span class="number">61</span>, </span><br><span class="line">  <span class="number">100</span>,  <span class="number">93</span>,  <span class="number">25</span>, <span class="number">115</span>,  <span class="number">96</span>, <span class="number">129</span>,  <span class="number">79</span>, <span class="number">220</span>,  <span class="number">34</span>,  <span class="number">42</span>, </span><br><span class="line">  <span class="number">144</span>, <span class="number">136</span>,  <span class="number">70</span>, <span class="number">238</span>, <span class="number">184</span>,  <span class="number">20</span>, <span class="number">222</span>,  <span class="number">94</span>,  <span class="number">11</span>, <span class="number">219</span>, </span><br><span class="line">  <span class="number">224</span>,  <span class="number">50</span>,  <span class="number">58</span>,  <span class="number">10</span>,  <span class="number">73</span>,   <span class="number">6</span>,  <span class="number">36</span>,  <span class="number">92</span>, <span class="number">194</span>, <span class="number">211</span>, </span><br><span class="line">  <span class="number">172</span>,  <span class="number">98</span>, <span class="number">145</span>, <span class="number">149</span>, <span class="number">228</span>, <span class="number">121</span>, <span class="number">231</span>, <span class="number">200</span>,  <span class="number">55</span>, <span class="number">109</span>, </span><br><span class="line">  <span class="number">141</span>, <span class="number">213</span>,  <span class="number">78</span>, <span class="number">169</span>, <span class="number">108</span>,  <span class="number">86</span>, <span class="number">244</span>, <span class="number">234</span>, <span class="number">101</span>, <span class="number">122</span>, </span><br><span class="line">  <span class="number">174</span>,   <span class="number">8</span>, <span class="number">186</span>, <span class="number">120</span>,  <span class="number">37</span>,  <span class="number">46</span>,  <span class="number">28</span>, <span class="number">166</span>, <span class="number">180</span>, <span class="number">198</span>, </span><br><span class="line">  <span class="number">232</span>, <span class="number">221</span>, <span class="number">116</span>,  <span class="number">31</span>,  <span class="number">75</span>, <span class="number">189</span>, <span class="number">139</span>, <span class="number">138</span>, <span class="number">112</span>,  <span class="number">62</span>, </span><br><span class="line">  <span class="number">181</span>, <span class="number">102</span>,  <span class="number">72</span>,   <span class="number">3</span>, <span class="number">246</span>,  <span class="number">14</span>,  <span class="number">97</span>,  <span class="number">53</span>,  <span class="number">87</span>, <span class="number">185</span>, </span><br><span class="line">  <span class="number">134</span>, <span class="number">193</span>,  <span class="number">29</span>, <span class="number">158</span>, <span class="number">225</span>, <span class="number">248</span>, <span class="number">152</span>,  <span class="number">17</span>, <span class="number">105</span>, <span class="number">217</span>, </span><br><span class="line">  <span class="number">142</span>, <span class="number">148</span>, <span class="number">155</span>,  <span class="number">30</span>, <span class="number">135</span>, <span class="number">233</span>, <span class="number">206</span>,  <span class="number">85</span>,  <span class="number">40</span>, <span class="number">223</span>, </span><br><span class="line">  <span class="number">140</span>, <span class="number">161</span>, <span class="number">137</span>,  <span class="number">13</span>, <span class="number">191</span>, <span class="number">230</span>,  <span class="number">66</span>, <span class="number">104</span>,  <span class="number">65</span>, <span class="number">153</span>, </span><br><span class="line">   <span class="number">45</span>,  <span class="number">15</span>, <span class="number">176</span>,  <span class="number">84</span>, <span class="number">187</span>,  <span class="number">22</span>,  <span class="number">72</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">35</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> temp = <span class="number">0</span>, temp1 = <span class="number">0</span>, q = <span class="number">0</span>, w = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">127</span>; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			 temp = (j &gt;&gt; <span class="number">4</span>) % <span class="number">16</span>; </span><br><span class="line">			 temp1 = (<span class="number">16</span>*j &gt;&gt; <span class="number">4</span>) % <span class="number">16</span>;</span><br><span class="line">			 q = a[<span class="number">2</span>*i];</span><br><span class="line">			 <span class="keyword">if</span>(q &lt; <span class="number">48</span> || q &gt; <span class="number">57</span>)</span><br><span class="line">			 	q = q<span class="number">-87</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				q = q<span class="number">-48</span>;</span><br><span class="line">			q = q*<span class="number">16</span>;</span><br><span class="line">			</span><br><span class="line">			w = b[<span class="number">2</span>*i];</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(w &lt; <span class="number">48</span> || w &gt; <span class="number">57</span>)</span><br><span class="line">				w = w<span class="number">-87</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				w = w<span class="number">-48</span>; </span><br><span class="line">			 </span><br><span class="line">			 </span><br><span class="line">			 <span class="keyword">if</span>(c[<span class="number">16</span>*temp + temp1] == ((w+q) ^ <span class="number">0x19</span>))</span><br><span class="line">			 &#123;</span><br><span class="line">			 	flag[i] = j;</span><br><span class="line">				<span class="keyword">break</span>; </span><br><span class="line">			 &#125; </span><br><span class="line">		&#125;</span><br><span class="line">		 </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">puts</span>(flag); </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200502083319440.png" alt="image-20200502083319440"></p>
</li>
<li><p><strong>总结: &gt;&gt; 运算符移动n位就相当于除以2^n. 且 % 的优先级大于 &gt;&gt;</strong></p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="notsequence"><a href="#notsequence" class="headerlink" title="notsequence"></a>notsequence</h3></blockquote>
<ul>
<li><p>自己算法太菜了, 这道题的2个函数始终没看懂… 看了writeup, 杨辉三角形!</p>
</li>
<li><p>看了writeup, 自己慢慢的分析了下. 首先, check1函数.</p>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200502131757195.png" alt="image-20200502131757195"></p>
</li>
<li><p>然后是check2.</p>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200502133008194.png" alt="image-20200502133008194"></p>
</li>
<li><p>经过这2个函数判断, 就能知道是否是杨辉三角形了. 把前20行的数据经过md5加密就是flag.</p>
</li>
<li><p>最后, 题自己虽然每做出来, 倒是通过这个题重新认识了杨辉三角形. 写了C语言和python的版本. 也是想打印出来看看, 且自己刚接触python, 代码乱而长.</p>
<p><strong>python3:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createL</span><span class="params">(l)</span>:</span></span><br><span class="line">    L = [<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, len(l)):</span><br><span class="line">        L.append(l[x] + l[x<span class="number">-1</span>])</span><br><span class="line">    L.append(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> L</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printL</span><span class="params">(L, W)</span>:</span></span><br><span class="line">    s = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> L:</span><br><span class="line">        s += str(x) + <span class="string">" "</span></span><br><span class="line">    print(s.center(W))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_</span><span class="params">(s, L)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> L:</span><br><span class="line">        s += str(x)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">L = [<span class="number">1</span>]</span><br><span class="line">s = <span class="string">""</span></span><br><span class="line">row = int(input(<span class="string">"请输入行数: "</span>))</span><br><span class="line">width =row* <span class="number">6</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(row):</span><br><span class="line">    printL(L, width)</span><br><span class="line">    s = str_(s, L)</span><br><span class="line">    L = createL(L)</span><br><span class="line">print(s)</span><br><span class="line">m = hashlib.md5(s.encode()).hexdigest()</span><br><span class="line">print(<span class="string">"md5加密后:%s"</span> % m)</span><br></pre></td></tr></table></figure>

<p><strong>C:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> *<span class="title">creat</span><span class="params">(<span class="keyword">int</span> *L, <span class="keyword">int</span> lenth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> *p = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>)*(lenth+<span class="number">1</span>));</span><br><span class="line">	</span><br><span class="line">	p[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; lenth; i++)</span><br><span class="line">	p[i] = L[i<span class="number">-1</span>] + L[i];</span><br><span class="line">	</span><br><span class="line">	p[lenth] = <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> p;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> *L, <span class="keyword">int</span> blank_l, <span class="keyword">int</span> lenth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; blank_l; i++)</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"  "</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; lenth; i++)</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%4d"</span>, L[i]); </span><br><span class="line">	</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">translate</span><span class="params">(<span class="keyword">int</span> *L, <span class="keyword">int</span> lenth)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> *p = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>)*<span class="number">100</span>), temp[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">memset</span>(p, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; lenth; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">sprintf</span>(temp, <span class="string">"%d"</span>, L[i]);</span><br><span class="line">		<span class="built_in">strcat</span>(p, temp); </span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> p;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = <span class="number">0</span>, i = <span class="number">0</span>, *p = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">char</span> a[<span class="number">1000</span>] = &#123;<span class="number">0</span>&#125;; </span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"请输入行数: "</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		p = creat(p, i);</span><br><span class="line">		<span class="built_in">print</span>(p, n-i, i+<span class="number">1</span>);</span><br><span class="line">		<span class="built_in">strcat</span>(a, (<span class="keyword">char</span> *)translate(p, i+<span class="number">1</span>));</span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n所有数值组成的字符串为: %s"</span>, a); </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>总结: 在看不懂代码的时候, 应该把能写出来的值都列举出来, 观察一下规律.</strong></p>
</li>
</ul>
<hr>
<blockquote>
<h3 id="SignIn"><a href="#SignIn" class="headerlink" title="SignIn"></a>SignIn</h3></blockquote>
<ul>
<li><p>这道题更像是是crypto的题, 初次了解了下Rsa.</p>
</li>
<li><p>程序下载下来, 有一系列不认识的函数, 大概知道用法, 还是先取查了查.<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503094008020.png" alt="image-20200503094008020"></p>
</li>
<li><p>GMP(The GNU Multiple Precision Arithmetic Library)又叫GNU多精度算术库，是一个提供了很多操作高精度的大整数，浮点数的运算的算术库，几乎没有什么精度方面的限制，功能丰富. 几个常用的:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">添加头文件：<span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gmp.h&gt; </span></span></span><br><span class="line"></span><br><span class="line">　　cmd编译命令：gcc myprogram.c -lgmp -lm -o myprogram</span><br><span class="line"></span><br><span class="line">　　声明一个gmp的整数rop ：<span class="keyword">mpz_t</span> rop;</span><br><span class="line"></span><br><span class="line">　　把字符串初始化为gmp大整数：<span class="function"><span class="keyword">int</span> <span class="title">mpz_init_set_str</span><span class="params">(<span class="keyword">mpz_t</span> rop, <span class="keyword">char</span>*str, <span class="keyword">int</span> base)</span></span>; </span><br><span class="line"></span><br><span class="line">　　释放空间：<span class="function"><span class="keyword">void</span>  <span class="title">mpz_clear</span><span class="params">(<span class="keyword">mpz_t</span> rop)</span></span>;<span class="comment">//声明了一个变量，在程序的最后一定要释放，不然会报错</span></span><br><span class="line"></span><br><span class="line">　　加法：<span class="function"><span class="keyword">void</span> <span class="title">mpz_add</span><span class="params">(<span class="keyword">mpz_t</span> rop, <span class="keyword">mpz_t</span> op1, <span class="keyword">mpz_t</span> op2)</span></span>;  <span class="comment">//rop = op1 + op2</span></span><br><span class="line"></span><br><span class="line">　　减法：<span class="function"><span class="keyword">void</span> <span class="title">mpz_sub</span><span class="params">(<span class="keyword">mpz_t</span> rop, <span class="keyword">mpz_t</span> op1, <span class="keyword">mpz_t</span> op2)</span></span>;  <span class="comment">//rop = op1 - op2</span></span><br><span class="line"></span><br><span class="line">　　乘法：<span class="function"><span class="keyword">void</span> <span class="title">mpz_mul</span><span class="params">(<span class="keyword">mpz_t</span> rop, <span class="keyword">mpz_t</span> op1, <span class="keyword">mpz_t</span> op2)</span></span>; <span class="comment">//rop = op1 * op2</span></span><br><span class="line"></span><br><span class="line">　　除法：<span class="function"><span class="keyword">void</span> <span class="title">mpz_cdiv_q</span> <span class="params">(<span class="keyword">mpz_t</span> q, <span class="keyword">mpz_t</span> n, <span class="keyword">mpz_t</span> d)</span></span>;  <span class="comment">//q = n/d,这个有很多种类型，具体的看使用手册</span></span><br><span class="line"></span><br><span class="line">　　幂运算：<span class="function"><span class="keyword">void</span> <span class="title">mpz_pow_ui</span> <span class="params">(<span class="keyword">mpz_t</span> rop, <span class="keyword">mpz_t</span> base, <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> <span class="built_in">exp</span>)</span></span>;  <span class="comment">//rop = base^exp</span></span><br><span class="line">		  void mpz_powm (mpz_t rop, const mpz_t base, const mpz_t exp, const mpz_t mod)  作用: Set rop to base^exp mod mod. 这是这道题中用到的. 也是rsa加密解密常用的.</span><br><span class="line">          </span><br><span class="line"></span><br><span class="line">　　开方：<span class="function"><span class="keyword">void</span> <span class="title">mpz_sqrt</span> <span class="params">(<span class="keyword">mpz_t</span> rop, <span class="keyword">mpz_t</span> op)</span></span>; <span class="comment">//rop = op开方的向下取整</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>整个流程, 显然是rsa加密.  </p>
<table>
<thead>
<tr>
<th align="center">步骤</th>
<th>说明</th>
<th>描述</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td>找出质数</td>
<td>P 、Q</td>
<td>-</td>
</tr>
<tr>
<td align="center">2</td>
<td>计算公共模数</td>
<td>N = P * Q</td>
<td>-</td>
</tr>
<tr>
<td align="center">3</td>
<td>欧拉函数</td>
<td>φ(N) = (P-1)(Q-1)</td>
<td>-</td>
</tr>
<tr>
<td align="center">4</td>
<td>计算公钥E</td>
<td>1 &lt; E &lt; φ(N)</td>
<td>E的取值必须是整数  E 和 φ(N) 必须是互质数</td>
</tr>
<tr>
<td align="center">5</td>
<td>计算私钥D</td>
<td>E * D % φ(N) = 1</td>
<td>-</td>
</tr>
<tr>
<td align="center">6</td>
<td>加密</td>
<td>C ＝ M ^E mod N</td>
<td>C：密文  M：明文</td>
</tr>
<tr>
<td align="center">7</td>
<td>解密</td>
<td>M ＝C ^D mod N</td>
<td>C：密文  M：明文</td>
</tr>
</tbody></table>
</li>
<li><p>但是之前有一个sub_96A函数.(最上面的箭头所示), 现在进入这个函数看看. 这里是从字符的ASCII转化为16进制, <strong>(最上面的 Windows_Reverse2有从 16进制转化为字符的算法, 都挺简洁的)</strong><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503094306385.png" alt="image-20200503094306385"></p>
</li>
<li><p>整个程序就是将我们输入的字符, 先转化为16进制数值字符, 再变成一个大数作为明文. 经过  <strong>C ＝ M ^E mod N</strong>, 加密后和编码的密文进行对比. 首先这里的 E = v5 = 65537. M是明文. N = v4 = 103461035900816914121390101299049044413950405173712170434161686539878160984549. 根据解密过程, 我们先把 N 分解成 p q , 可以去在线分解.<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503095605681.png" alt="image-20200503095605681"></p>
</li>
<li><p>然后使用 python的gmpy2库先求逆元得到<strong>D</strong>. 最后用  <strong>M ＝C ^D mod N</strong>  解密并从16进制转化为字符. 这个gmpy2的库的安装还费了些时间..🤣 <strong>exp:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = <span class="number">282164587459512124844245113950593348271</span></span><br><span class="line">q = <span class="number">366669102002966856876605669837014229419</span></span><br><span class="line">N = <span class="number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span></span><br><span class="line">c = <span class="number">0xad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">d = gmpy2.invert(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">m = gmpy2.powmod(c, d, p*q)</span><br><span class="line"></span><br><span class="line">print(bytes.fromhex(hex(m)[<span class="number">2</span>:])</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503101307822.png" alt="image-20200503101307822"></p>
<ul>
<li><strong>总结: (1)对rsa有了初步的了解, 学会了简单的加密解密方法. (2)GMP算数库的认识. (3)字符的ASCII转16进制的简洁算法.</strong></li>
</ul>
<hr>
<blockquote>
<h3 id="BabyXor"><a href="#BabyXor" class="headerlink" title="BabyXor"></a>BabyXor</h3></blockquote>
<ul>
<li><p>首先, 明明可以直接OD动态调试, 很快得到flag.  但是我用ida把题做完, 才一下子想起.🤣</p>
</li>
<li><p>发现有壳, 载入OD使用堆栈平衡脱壳. 载入ida, 发现main函数里有很多函数, 上下分析了下, 发现都是干扰的函数. <img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503173759296.png" alt="image-20200503173759296"></p>
<p>确定目标, 就是通过这几个函数从编码的数据中取出字符经过一些简单的异或运算, 存放再一个内存空间. 但是与我们输入数据没有关系. (这时候, 就可以直接取OD动态调试直接得到flag的, 唉, 我算出来才想起)</p>
</li>
<li><p>一个疑问的地方<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503174247305.png" alt="image-20200503174247305"></p>
</li>
<li><p>然后看了看汇编代码. 还是不清楚.  <img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503174332262.png" alt="image-20200503174332262"></p>
</li>
<li><p>进去OD调试看看.发现代码又是一个样. 不过这下就清楚了. 先取地址的值. <strong>记住这点</strong><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503174534451.png" alt="image-20200503174534451"></p>
</li>
<li><p><strong>exp:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">union</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> ida_chars[<span class="number">56</span>];</span><br><span class="line">		<span class="keyword">int</span> a[<span class="number">14</span>];</span><br><span class="line">	&#125;A = &#123;</span><br><span class="line">  			<span class="number">102</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">109</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">99</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">0</span>,   <span class="number">0</span>, <span class="number">100</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">127</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">55</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">53</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">48</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">48</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">107</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">58</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">60</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">59</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">32</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span></span><br><span class="line">			&#125;;</span><br><span class="line">			</span><br><span class="line">	<span class="keyword">union</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> ida[<span class="number">56</span>];</span><br><span class="line">		<span class="keyword">int</span> a[<span class="number">14</span>];</span><br><span class="line">	&#125; B = &#123;</span><br><span class="line">   			<span class="number">55</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">111</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">56</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">98</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">54</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">  			<span class="number">124</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">55</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">51</span>,   <span class="number">0</span>, </span><br><span class="line">   			 <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">52</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">118</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">51</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">98</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">100</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>, <span class="number">122</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span></span><br><span class="line">			&#125;;</span><br><span class="line">			</span><br><span class="line">	<span class="keyword">union</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> ida_[<span class="number">56</span>];</span><br><span class="line">		<span class="keyword">int</span> a[<span class="number">14</span>];</span><br><span class="line">	&#125;C = &#123;</span><br><span class="line">   			<span class="number">26</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">81</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">5</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">17</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">84</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">86</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">85</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">89</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   			<span class="number">29</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">9</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">93</span>,   <span class="number">0</span>, </span><br><span class="line">    		<span class="number">0</span>,   <span class="number">0</span>,  <span class="number">18</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span></span><br><span class="line">			&#125;; </span><br><span class="line">	<span class="keyword">char</span> f1[<span class="number">14</span>] = &#123;<span class="number">0</span>&#125;, f2[<span class="number">14</span>] = &#123;<span class="number">0</span>&#125;, f3[<span class="number">14</span>] = &#123;<span class="number">0</span>&#125;, ftemp[<span class="number">14</span>] = &#123;<span class="number">0</span>&#125;, temp = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">14</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		f1[i] = A.a[i] ^ i; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	f2[<span class="number">0</span>] = B.a[<span class="number">0</span>];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; <span class="number">14</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		f2[i] = A.a[i] ^ B.a[i] ^ A.a[i<span class="number">-1</span>]; </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">13</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		temp = C.a[i+<span class="number">1</span>] ^ f2[i]; </span><br><span class="line">		ftemp[i] = temp ^ i;  </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	f3[<span class="number">0</span>] = <span class="number">0x2D</span>;</span><br><span class="line">	<span class="built_in">strcat</span>(f3, ftemp);		</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">strcat</span>(flag, f1);</span><br><span class="line">	<span class="built_in">strcat</span>(flag, f2);</span><br><span class="line">	<span class="built_in">strcat</span>(flag, f3);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">puts</span>(flag); </span><br><span class="line">	</span><br><span class="line">	 <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503174824411.png" alt="image-20200503174824411"></p>
<ul>
<li>下面说一步到位.找到最后一个函数最后赋值代码的地址. 复制下来<img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503175027583.png" alt="image-20200503175027583"></li>
<li>进去OD, 跳到这个地址下断点, 运行起来. 看数据窗口. <img src="/2020/04/29/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C(2)/image-20200503175154926.png" alt="image-20200503175154926"></li>
<li><strong>总结: (1)注意这种flag和输入字符无关的的题. (2)这里 ida中的内存取值与OD中的差异.</strong></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/27/cpp-%E9%80%86%E5%90%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/27/cpp-%E9%80%86%E5%90%91/" class="post-title-link" itemprop="url">.cpp 逆向</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-27 19:35:58" itemprop="dateCreated datePublished" datetime="2020-04-27T19:35:58+08:00">2020-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-10 18:56:19" itemprop="dateModified" datetime="2020-05-10T18:56:19+08:00">2020-05-10</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>2.6k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<h3 id="百越杯2018-crazy"><a href="#百越杯2018-crazy" class="headerlink" title="百越杯2018: crazy"></a>百越杯2018: crazy</h3></blockquote>
<ul>
<li><p>首先, 这道题的算法很简单, 就是考引用C++的字符串类的函数. 但是自己也挖掘了一些感觉有用的东西, 主要是通过这道题总结 c++字符串类.</p>
</li>
<li><p>拖入ExeinfoPe, 题目是64为elf文件, 用64为ida打开.</p>
</li>
<li><p>找到主函数,  查看伪代码, 发现很冗长, 但大多数都是那些字符串类函数和无用的信息. 我们可以先通过点击最后比较要用到的字符串的名称, 这时会把所有相同名称都高亮显示出来, 就可以通过逻辑判断出那些是关键函数和变量.</p>
</li>
<li><p>第一个关键函数  <strong>HighTemplar::HighTemplar((DarkTemplar *)&amp;v23, (__int64)&amp;input);</strong> </p>
<p><img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200427213407581.png" alt="image-20200427213407581"></p>
</li>
<li><p>第二个关键函数 <strong>HighTemplar::calculate((HighTemplar *)&amp;v23);</strong></p>
<p><img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200427213610870.png" alt="image-20200427213610870"></p>
</li>
<li><p>第三个关键函数 <strong>HighTemplar::getSerial((HighTemplar *)&amp;v23)</strong></p>
<p><img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200427213959893.png" alt="image-20200427213959893"></p>
</li>
<li><p>最后wp: 但是要引起注意的是这个flag真的奇怪, 开始以为算错了,检查几遍, 最后就是这个 <strong>tMx<del>qdstOs</del>crvtwb~aOba}qddtbrtcd</strong>  再加上flag{}.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> a[] = <span class="string">"327a6c4304ad5938eaf0efb6cc3e53dc"</span>;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">char</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		a[i] = (a[i] - <span class="number">11</span>) ^ <span class="number">0x13</span>;</span><br><span class="line">		a[i] = (a[i] - <span class="number">23</span>) ^ <span class="number">0x50</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">puts</span>(a);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>总结:</strong></p>
</li>
<li><p>先说一下做这个题想过的一个问题.  我们知道 <strong>rodata</strong> 段是只读的, 存放常量等, 但是这里却有字符串地址的赋值, 他把 <strong>0x401EA0</strong> 地址的值改变了, 但为什么可以这样呢, 查了资料, 也想了很久, 最后认为应该是存放的指针,而且我们可以看到这一段都是8字节的增加, 都是一个指针 8字节的大小.</p>
<p><img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200427215217839.png" alt="image-20200427215217839"></p>
<p>这里也通过查资料, 知道了以前学习指针的疑问.</p>
<p><img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200427215908475.png" alt="image-20200427215908475"></p>
<p><strong>因为我们初始化一个数组时,数组的初始值放在rodata段里面.数组对应开辟的空间上的数值存放在栈上,编译器会去访问rodata段上的初始值然后取来初始化局部变量，因此数组的值才能修改. 而指针指向的是rodata段，是不能被修改的</strong>.</p>
</li>
<li><p>第二个就是通过c++官方手册的查询对各种c++引用的各种字符串的总结. 下面的 a b 为字符数组.</p>
<table>
<thead>
<tr>
<th align="left">std::__cxx11::basic_string&lt;char,std::char_traits<char>,std::allocator<char>&gt;::operator[](a, i)</char></char></th>
</tr>
</thead>
<tbody><tr>
<td align="left">即 <strong>a[i]</strong> 的意思, 如果operator后面没有 <strong>[]</strong>, 那就是  <strong>a+i</strong></td>
</tr>
<tr>
<td align="left">std::__cxx11::basic_string&lt;char,std::char_traits<char>,std::allocator<char>&gt;::basic_string(a, b, lenth)</char></char></td>
</tr>
<tr>
<td align="left">即  <strong>strncpy(a, b, lenth)</strong>  第三个参数可选</td>
</tr>
<tr>
<td align="left">std::allocator<char>::~allocator(a)  <strong>发现只要前面有个 ~ 的都是释放</strong>.</char></td>
</tr>
<tr>
<td align="left">即 <strong>free(a)</strong></td>
</tr>
<tr>
<td align="left">std::__cxx11::basic_string&lt;char,std::char_traits<char>,std::allocator<char>&gt;::length(a)</char></char></td>
</tr>
<tr>
<td align="left">即 <strong>strlen(a)</strong></td>
</tr>
<tr>
<td align="left">std::operator&lt;&lt;&lt;std::char_traits<char>&gt;(&amp;std::cout, “hello”) 后面总跟着下面一句. <strong>关键是count</strong></char></td>
</tr>
<tr>
<td align="left">std::ostream::operator&lt;&lt;(v1, (__int64)&amp;std::endl&lt;char,std::char_traits<char>&gt;)                                                                     即  <strong>printf(“hello”)</strong></char></td>
</tr>
<tr>
<td align="left">std::operator&gt;&gt;&lt;char,std::char_traits<char>,std::allocator<char>&gt;(&amp;std::cin, &amp;a) <strong>关键是in</strong></char></char></td>
</tr>
<tr>
<td align="left">即 <strong>gets(a)</strong></td>
</tr>
</tbody></table>
<hr>
</li>
</ul>
<blockquote>
<h3 id="easyCpp"><a href="#easyCpp" class="headerlink" title="easyCpp"></a>easyCpp</h3></blockquote>
<blockquote>
<p>C++逆向的题, 刚开始接触很多代码看不懂,感觉可读性低.  但是看多了, 还是会好很多. 是一个慢慢熟悉stl的过程吧.</p>
</blockquote>
<ul>
<li><p>经过了一些CPP逆向题的折磨, 这个题大多数函数连懵带猜的看起来还好, 但是遇到了一个不仔细的错误, 想了很久…..</p>
</li>
<li><p>64位elf文件, 载入ida, 函数的大部分还是看懂了. 2个关键函数.  <strong>transform  accumulate</strong></p>
<p><img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200510182506239.png" alt="image-20200510182506239"></p>
</li>
<li><p>先进入 transform. 算法也是很简单, 就是函数读起来更麻烦.</p>
<p><img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200510182650313.png" alt="image-20200510182650313"></p>
</li>
<li><p>下面 accumulate. 这个看起来就不是那么容易了, 有很多地址传过来传过去就很混淆. 那就ida动态调试看看这个函数是做什么.(也是这里自己想了很久的错误, 虽然很简单的, 可能是stl把自己搞昏了吧).</p>
<p><img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200510183307210.png" alt="image-20200510183307210"></p>
</li>
<li><p>发现错误, 重新调试后得到经过 accumulate 函数后的结果. 把结果都记录下来后. 发现只是把 transform函数后的结果进行了逆序.<img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200510183543551.png" alt="image-20200510183543551"></p>
</li>
<li><p>开始写 exp:  得到 <strong>987 -377 -610 -754 -843 -898 -932 -953 -966 -974 -979 -982 -984 -985 -986 -986</strong>. 最后在linux下运行程序输入.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!a || a == <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> fib(a<span class="number">-1</span>) + fib(a<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> flag[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;, i = <span class="number">0</span>; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		flag[i] = fib(i); </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">15</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d "</span>, flag[i] = (i &lt; <span class="number">15</span> ? flag[i] - flag[<span class="number">15</span>]:flag[i]));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/27/cpp-%E9%80%86%E5%90%91/image-20200510184751024.png" alt="image-20200510184751024"></p>
</li>
<li><p><strong>总结: (1)注意传递的参数是指针还是值. (2)cpp逆向太多数都有一个模板一样, 动态调试注意地址的寻找.</strong></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/25/CTF%E6%AF%94%E8%B5%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/25/CTF%E6%AF%94%E8%B5%9B/" class="post-title-link" itemprop="url">CTF比赛</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-25 19:27:55" itemprop="dateCreated datePublished" datetime="2020-04-25T19:27:55+08:00">2020-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-28 12:52:08" itemprop="dateModified" datetime="2020-04-28T12:52:08+08:00">2020-04-28</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>911</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><h3 id="第一次做在线CTF-安恒四月杯"><a href="#第一次做在线CTF-安恒四月杯" class="headerlink" title="第一次做在线CTF: 安恒四月杯"></a>第一次做在线CTF: 安恒四月杯</h3></li>
</ul>
<blockquote>
<p>首先就是杂项的一道题, 虽然简单, 但是记录一下自己的成果.</p>
</blockquote>
<p>下载下来是一个流量包, 题目也没有提示, 就先用binwalk看能不能提取出什么. 直接 <strong>binwalk -e</strong>, 什么也没有, </p>
<p>但是我们往下看一下, 是有个压缩包. 那就手动提取吧. <strong>dd if=3.pcapng bs=1 skip=24437 of=3.zip</strong> </p>
<p><img src="/2020/04/25/CTF%E6%AF%94%E8%B5%9B/image-20200425202118617.png" alt="image-20200425202118617"></p>
<p>这次, 文件所在目录出现了一个压缩包, 尝试打开但是有密码, 但是我们可以看到它提示信息: </p>
<p><img src="/2020/04/25/CTF%E6%AF%94%E8%B5%9B/image-20200425202435440.png" alt="image-20200425202435440"></p>
<p>说密码蓝牙的pin, 我也是刚刚接触这个wireshare这个软件, 百度了一下, 就是我们连接蓝牙时的那个数字.  但是我是不知道怎么找这个东西,就百度怎么用wireshark抓蓝牙的包, 但没有的得到有用消息, 有的还要什么蓝牙驱动. 就自己去搜索bluetooth, 找了一圈也没有得到那个pin.  我就又跑去打暴力破解的打算, 但又没有7z压缩包暴力破解密码的工具, 又去各大论坛找, 找到了但没用😂. 暂时放下了这个题, 去做reverse, reverse的2个题做的还比较顺利.  回来继续看这个题, 这次干脆直接搜 pin 试试, 出现 PIN请求, PIN请求回应, PIN请求回应完成, </p>
<p><img src="/2020/04/25/CTF%E6%AF%94%E8%B5%9B/image-20200425203534918.png" alt="image-20200425203534918"></p>
<p>那么这PIN请求回应的可能性就最大了, 点进去:可以看到 PIN Code : 141854.  </p>
<p><img src="/2020/04/25/CTF%E6%AF%94%E8%B5%9B/image-20200425203900340.png" alt="image-20200425203900340"></p>
<p>最后输入压缩包得到flag.</p>
<p><img src="/2020/04/25/CTF%E6%AF%94%E8%B5%9B/image-20200425204118569.png" alt="image-20200425204118569"></p>
<hr>
<blockquote>
<p>reverse第二题.</p>
</blockquote>
<p>题目下载后, 用ida打开, 找到主函数, 逻辑上很清晰, 说是将flag与我们输入的数字混合在了一起. 程序就做了将我们输入的数字与已经编码了的一些数据进行异或运算然后输出的操作.</p>
<p><img src="/2020/04/25/CTF%E6%AF%94%E8%B5%9B/image-20200426191831676.png" alt="image-20200426191831676"></p>
<p>开始想的是会不会直接就是已经编码的数据, 看了看ASCII,不可能是.  </p>
<p>那有可能就是将我们输入的数据与编码的数据进行或运算后输出的是flag. 那么按照flag的格式, 根据题目说 最后的flag输入的是 flag{}/DACTF{}中的数据, 那么这里的flag也就是这2种格式了. </p>
<p>这样就好办了, 他们末尾都是 <strong>}</strong> 我们把编码数据的最后一位 61 , 找到一个数字与它异或运算位的值为 <strong>}</strong> 的ASCII 125, 就行了. 得到64, 最后把编码的所有数据与<strong>64</strong>进行一个异或运算就得到flag. </p>
<p><strong>但是提取数字时,我们可以直接把代码复制到编译中, 但是注意, 这不是数组, 根据栈的特点, 要倒着遍历.</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/23/BUUCTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/23/BUUCTF/" class="post-title-link" itemprop="url">BUUCTF</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-23 19:05:34" itemprop="dateCreated datePublished" datetime="2020-04-23T19:05:34+08:00">2020-04-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-25 19:06:30" itemprop="dateModified" datetime="2020-04-25T19:06:30+08:00">2020-04-25</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>1.7k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>2 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>reverse: CrackRTF1</strong></p>
<p>从刚开始接触 BUUCTF , 做到逆向的这道题, 看了writeup 也觉得难, 就停滞了一段时间. 到论剑场和攻防世界做了20多天(期间也开始了pwn), 今天突然想到这道题(一直放在桌面顶部).</p>
<p>开始打开ida分析时, 发现逻辑是多么的清晰, 但是当进入第一个关键函数时, 想起了上次的难点. (1)对hash很陌生, 不知道为什么hash不可逆, 必须要爆破. (2)当时一点python都没接触过, 对于要写python脚本爆破, 就觉得很烦(当然经过不断的学习, 这20多天, 接触并开始学习些python). (3)这里第二次输入, 因为没有限制条件, 还不能爆破, 后面又是一些从没听说过的操作.(但其实这次再来看, 其实就是要用<strong>Resource Hacker</strong>这个工具查看.exe文件里的资源文件, 经过一些逻辑上的操作)</p>
<p>首先, 知道是系统调用的函数, 当时就每个都百度了下, 也是很麻烦的(但是逆向的路就是这样, 要知道的很多很多, 只有自己慢慢的积累).记得整个函数作用就是 调用一个hash加密函数. 具体是那个hash, 可以查看官方的介绍, 从这里的编号 : <strong>0x8004</strong> 去找对应的加密, 经过查询是 sha1.</p>
<p><img src="/2020/04/23/BUUCTF/image-20200423194434469.png" alt="image-20200423194434469"></p>
<p>因为hash不可逆, 但是这里有字符串长度是 6 位, 且转化为整数后 &gt;= 100000, 那么范围就确定了: 100000 - 999999, 下面爆破脚本: 得到 <strong>123321@DBApp</strong>, 那么我们输入就是 ; <strong>123321</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">flag = <span class="string">"@DBApp"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100000</span>, <span class="number">999999</span>):</span><br><span class="line">    s = str(i) + flag</span><br><span class="line">    x = hashlib.sha1(s.encode())</span><br><span class="line">    <span class="keyword">if</span> <span class="string">"6E32D0943418C2C33385BC35A1470250DD8923A9"</span>.lower() == x.hexdigest():</span><br><span class="line">        <span class="keyword">print</span> (str(i) + flag)</span><br></pre></td></tr></table></figure>

<p> 接下来, 输入第二个字符串, 但是要加上上面的<strong>123321@DBApp</strong> 然后hash加密操作.但是这次的编号改变了 <strong>0x8003 : mad5</strong>, 这次没有限制条件, 爆破不行了.</p>
<p>经过看大神们的操作, 知道了可以通过下面一个函数.这个函数和我们的fopen那些文件操作不同. </p>
<p>这个 FindResourceA是打开这个.exe文件中资源文件的文件.(这点第一次知道, 还有这种操作!!!, 经过百度, 发现可以将自己的资源文件加入.exe文件中), 打开AAA后, 将里面的内容与我们输入的字符进行异或操作, 最后将内容写入新创建一个 dbapp.rtf 文件. 这里大神的说法都是, 因为是写进.rtf 文件那么开始写入的必然是文件头, 我们就可以随便创建一个.rtf文件, 查看文件头内容. 可以看到是 <strong>{\rtf1</strong>, 正好是6位,我们最后输入的也是6位, 那么把他和AAA文件中的前6位异或一下, 就得到我们输入的了. </p>
<h3 id><a href="#" class="headerlink" title></a><img src="/2020/04/23/BUUCTF/image-20200423200957999.png" alt="image-20200423200957999"></h3><p><img src="/2020/04/23/BUUCTF/image-20200423202735198.png" alt="image-20200423202735198"></p>
<p><img src="/2020/04/23/BUUCTF/image-20200423202025893.png" alt="image-20200423202025893"></p>
<p>下面脚本: 最后得到 <strong>~!3a@0</strong>, 输入程序后, 会创建一个 dbapp.rtf 文件, 打开即是flag.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0x05</span>, <span class="number">0x7D</span>, <span class="number">0x41</span>, <span class="number">0x15</span>, <span class="number">0x26</span>, <span class="number">0x01</span>]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">rtf = <span class="string">"&#123;\\rtf1"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(rtf)):</span><br><span class="line">    x = ord(rtf[i]) ^ a[i]</span><br><span class="line">    flag += chr(x)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<p>但对于最后的 <strong>因为是写进.rtf 文件那么开始写入的必然是文件头</strong> 我是感觉奇怪的, 他创建了一个dbapp.rtf 文件, 写入的不就是文件的内容吗, 为什么文件头都要我们来写入. 噢, 因为以前学习文件操作的时候都是往.txt文件里写内容, 那个没有文件头这一说, 所以可以一开始写进内容. 写入的实质还是填充二进制的01. 所以这里我们要先写 .rtf文件头. </p>
<p><img src="/2020/04/23/BUUCTF/image-20200423204326824.png" alt="image-20200423204326824"></p>
<p>最后, .rtf文件与 docx dox 类似, <strong><em>\</em>富文本格式\</strong>（*<em>Rich Text Format*</em>）即*<em>RTF格式*</em>，又称*<em>多文本格式*</em>，是由<a href="https://baike.baidu.com/item/微软" target="_blank" rel="noopener">微软</a>公司开发的跨平台<a href="https://baike.baidu.com/item/文档" target="_blank" rel="noopener">文档</a>格式。大多数的<a href="https://baike.baidu.com/item/文字处理" target="_blank" rel="noopener">文字处理</a>软件都能读取和保存RTF文档。**</p>
<p>mac先创建的文本文件, 默认都是 .rtf.</p>
<p>心得: 如果做到感觉很吃力的题可以先放一放, 等学习一段时间, 知识积累的更多了再来看, 不要死磕!</p>
<p>当一条路不同时, 注意其他函数的功能, 想它的存在为什么. </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/18/pwn%E5%BF%83%E5%BE%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BIX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/18/pwn%E5%BF%83%E5%BE%97/" class="post-title-link" itemprop="url">PWN</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-18 09:57:01" itemprop="dateCreated datePublished" datetime="2020-04-18T09:57:01+08:00">2020-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-25 19:04:36" itemprop="dateModified" datetime="2020-04-25T19:04:36+08:00">2020-04-25</time>
              </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>714</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>1 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>由于汇编语言是底层的编程语言，各种函数参数都要直接控制栈进行存取，在混合编程中，要用汇编来调用C函数，当然就要知道参数的压栈情况了。<br>    当知道C函数的参数压栈顺序是从右到左时，我觉得很奇怪，因为大多数情况下，人们的习惯是从左到右的，难不成设计者学咱们中国古代写字从右到左的习惯不成？<br>    当时只是记下了这个规则而已，并没有去探究这其中的缘由，后来在实验中自己用汇编实现了printf和scanf函数的基本功能，尝到了压栈从右到左的好处，但是仍然没有多想。<br>    直到前阵子看斯坦福大学公开课的时候，老师解释了一番才恍然大悟！<br>    那么，这是为什么呢？<br>    要回答这个问题，就不得不谈一谈printf()函数，printf函数的原型是：printf（const char* format,…）<br>    没错，它是一个不定参函数，那么我们在实际使用中是怎么样知道它的参数个数呢？这就要靠format了，编译器通过format中的%占位符的个数来确定参数的个数。<br>     现在我们假设参数的压栈顺序是从左到右的，这时，函数调用的时候，format最先进栈，之后是各个参数进栈，最后pc进栈，此时，由于format先进栈了，上面压着未知个数的参数，想要知道参数的个数，必须找到format，而要找到format，必须要知道参数的个数，这样就陷入了一个无法求解的死循环了！！<br>    而如果把参数从右到左压栈，情况又是怎么样的？函数调用时，先把若干个参数都压入栈中，再压format，最后压pc，这样一来，栈顶指针加2便找到了format，通过format中的%占位符，取得后面参数的个数，从而正确取得所有参数。<br>    所以，如果不存在…这种不定参的函数，则参数的压栈顺序无论是从左到右还是从右到左都是没关系的</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BIX</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BIX</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">54k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">49 mins.</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

</body>
</html>
