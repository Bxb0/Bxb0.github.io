<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/2.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/2.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"bxb0.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="从各处Android题来学习。"><meta property="og:type" content="article"><meta property="og:title" content="Andriod之CTF学习"><meta property="og:url" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/index.html"><meta property="og:site_name" content="Bxb0&#39;s blog"><meta property="og:description" content="从各处Android题来学习。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205171126725.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205222314992.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205222830438.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205223604786.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205223928065.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205224023165.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210206212259169.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210206210632330.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210207182454660.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210207182859376.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210207184727271.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/ncjKwbuX1qBF6ke.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208171841729.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208172040397.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208172227628.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208172543745.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208175926442.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208172846985.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208173320567.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208173332255.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208175231246.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208175306552.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208175435115.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208185306706.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208190250967.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210220151141668.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210220151639862.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210220151914447.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210220152303564.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224192959108.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224193105424.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224195210759.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224195529004.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224202624546.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210225225117463.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210303203021780.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210303203358493.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210303204003498.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210304192508917.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210304192711623.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210304193133042.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210304193230661.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/H1aGYAcMoEPShpW.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305193418021.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305193507242.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305213542600.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305222644097.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305223009728.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305223046697.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310201450601.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310203122424.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310203554497.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310204857678.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310205935229.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310210138830.png"><meta property="og:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310210853842.png"><meta property="article:published_time" content="2021-02-05T07:09:15.000Z"><meta property="article:modified_time" content="2021-05-05T02:57:58.281Z"><meta property="article:author" content="ooo"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205171126725.png"><link rel="canonical" href="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>Andriod之CTF学习 | Bxb0's blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Bxb0's blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Bxb0's blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> Categories<span class="badge">15</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> Archives<span class="badge">46</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="ooo"><meta itemprop="description" content="0x446e37fb"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Bxb0's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Andriod之CTF学习</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-02-05 15:09:15" itemprop="dateCreated datePublished" datetime="2021-02-05T15:09:15+08:00">2021-02-05</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Andriod/" itemprop="url" rel="index"><span itemprop="name">Andriod</span></a></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">Symbols count in article:</span> <span>13k</span></span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span>11 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><p>从各处Android题来学习。</p><a id="more"></a><h2 id="攻防世界"><a href="#攻防世界" class="headerlink" title="攻防世界"></a>攻防世界</h2><h3 id="easyjni"><a href="#easyjni" class="headerlink" title="easyjni"></a>easyjni</h3><p>来到关键事件，取出输入后传入a方法，在a方法又把输入传入了实例化的一个a类对象中的a方法。全是a。。最后调用native层的ncheck函数。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205171126725.png" alt="image-20210205171126725"></p><p>a类中的a方法一个换表的base64，native层ncheck函数进行简单加密后与密文对比。</p><p>native层有JNIEnv方法，ida不会自动识别，将指定变量改一下类型就行了。<strong>JNIEnv*</strong></p><p>用一下ida-python。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">base = [<span class="string">'i'</span>, <span class="string">'5'</span>, <span class="string">'j'</span>, <span class="string">'L'</span>, <span class="string">'W'</span>, <span class="string">'7'</span>, <span class="string">'S'</span>, <span class="string">'0'</span>, <span class="string">'G'</span>, <span class="string">'X'</span>, <span class="string">'6'</span>, <span class="string">'u'</span>, <span class="string">'f'</span>, <span class="string">'1'</span>, <span class="string">'c'</span>, <span class="string">'v'</span>, <span class="string">'3'</span>, <span class="string">'n'</span>, <span class="string">'y'</span>, <span class="string">'4'</span>, <span class="string">'q'</span>, <span class="string">'8'</span>, <span class="string">'e'</span>, <span class="string">'s'</span>, <span class="string">'2'</span>, <span class="string">'Q'</span>, <span class="string">'+'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>, <span class="string">'k'</span>, <span class="string">'Y'</span>, <span class="string">'g'</span>, <span class="string">'K'</span>, <span class="string">'O'</span>, <span class="string">'I'</span>, <span class="string">'T'</span>, <span class="string">'/'</span>, <span class="string">'t'</span>, <span class="string">'A'</span>, <span class="string">'x'</span>, <span class="string">'U'</span>, <span class="string">'r'</span>, <span class="string">'F'</span>, <span class="string">'l'</span>, <span class="string">'V'</span>, <span class="string">'P'</span>, <span class="string">'z'</span>, <span class="string">'h'</span>, <span class="string">'m'</span>, <span class="string">'o'</span>, <span class="string">'w'</span>, <span class="string">'9'</span>, <span class="string">'B'</span>, <span class="string">'H'</span>, <span class="string">'C'</span>, <span class="string">'M'</span>, <span class="string">'D'</span>, <span class="string">'p'</span>, <span class="string">'E'</span>, <span class="string">'a'</span>, <span class="string">'J'</span>, <span class="string">'R'</span>, <span class="string">'Z'</span>, <span class="string">'N'</span>]</span><br><span class="line">base1 = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span></span><br><span class="line">s = <span class="string">'MbT3sQgX039i3g==AQOoMQFPskB1Bsc7'</span></span><br><span class="line">s = list(s)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)//<span class="number">2</span>):</span><br><span class="line">    s[<span class="number">2</span>*i], s[<span class="number">2</span>*i+<span class="number">1</span>] = s[<span class="number">2</span>*i+<span class="number">1</span>], s[<span class="number">2</span>*i]</span><br><span class="line">s = s[<span class="number">16</span>:<span class="number">32</span>]+s[<span class="number">0</span>:<span class="number">16</span>]</span><br><span class="line">ans = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">if</span> i != <span class="string">'='</span>:</span><br><span class="line">        ans += [base.index(i)]</span><br><span class="line">flag = [base1[i] <span class="keyword">for</span> i <span class="keyword">in</span> ans]</span><br><span class="line">flag = base64.b64decode(<span class="string">''</span>.join(flag)+<span class="string">'=='</span>)</span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment">#flag&#123;just_ANot#er_@p3&#125;</span></span><br></pre></td></tr></table></figure><h3 id="app3"><a href="#app3" class="headerlink" title="app3"></a>app3</h3><p>这个题涉及的知识挺多，对初学安卓挺不错的。</p><p>从010editor发现了ANDROID BACKUP，安卓备份文件。开始出现新的知识了，找了一篇文章讲这个的学习了一下，讲的真好。<a href="https://blog.csdn.net/qq_31387043/article/details/51452782" target="_blank" rel="noopener">Android中allowBackup</a>，知道了这个可以用android-backup-extractor(abe)工具来解析ab文件。</p><p>对于ab文件，前24字节类似文件头的东西，若文件是加密的话，可以在前24字节中看见AES-256标志，否则出现none字符。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205222314992.png" alt="image-20210205222314992"></p><p>使用<code>java -jar abe.jar unpack 1.ab 1.tar</code>解析文件，这样得到一个tar压缩包。解压后发现有一个apk文件和一些数据库文件。</p><p>上学期学习了java和mysql这2门课程，真是好。hha。。</p><p>看了看反编译apk中的代码，发现创建表操作和其中包含的flag文件：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205222830438.png" alt="image-20210205222830438"></p><p>再加上外面的数据库文件，可以猜测我们的flag就那些数据库中。</p><p>查询相关资料，知道了这个要用DB Browser for SQLite中的SQLCiper的打开，下载后准备打开数据库文件发现要密码。这也和猜想的一样，题目就是要让我们找这个密码。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205223604786.png" alt="image-20210205223604786"></p><p>对于key，通过传入Stranger和123456经过a包中的a，b类中的方法加密。a类中的方法就是字符串截取操作，b类中的方法一个MD5一个SHA-1。程序是可以调试的，所以直接调试得到key。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205223928065.png" alt="image-20210205223928065"></p><p>打开数据库得到一串base64字符串，解密得到flag。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210205224023165.png" alt="image-20210205224023165"></p><h3 id="easy-apk"><a href="#easy-apk" class="headerlink" title="easy-apk"></a>easy-apk</h3><p>找到主活动，就一个变表的base64编码，python简单写一下就好：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">base = [<span class="string">'v'</span>, <span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'r'</span>, <span class="string">'s'</span>, <span class="string">'t'</span>, <span class="string">'u'</span>, <span class="string">'o'</span>, <span class="string">'p'</span>, <span class="string">'q'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>,</span><br><span class="line">        <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>, <span class="string">'H'</span>, <span class="string">'I'</span>, <span class="string">'J'</span>,</span><br><span class="line">        <span class="string">'y'</span>, <span class="string">'z'</span>, <span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'P'</span>, <span class="string">'Q'</span>, <span class="string">'R'</span>, <span class="string">'S'</span>, <span class="string">'T'</span>, <span class="string">'K'</span>, <span class="string">'L'</span>, <span class="string">'M'</span>,</span><br><span class="line">        <span class="string">'N'</span>, <span class="string">'O'</span>, <span class="string">'Z'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'U'</span>, <span class="string">'V'</span>, <span class="string">'W'</span>, <span class="string">'X'</span>, <span class="string">'Y'</span>, <span class="string">'e'</span>,</span><br><span class="line">        <span class="string">'f'</span>, <span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>, <span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>, <span class="string">'m'</span>, <span class="string">'n'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'+'</span>, <span class="string">'/'</span>]</span><br><span class="line">enc = <span class="string">'5rFf7E2K6rqN7Hpiyush7E6S5fJg6rsi5NBf6NGT5rs='</span></span><br><span class="line">ans = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span> i != <span class="string">'='</span>:</span><br><span class="line">        ans += [base.index(i)]</span><br><span class="line">ans = <span class="string">''</span>.join([<span class="string">'&#123;:0&gt;6&#125;'</span>.format(bin(i)[<span class="number">2</span>:]) <span class="keyword">for</span> i <span class="keyword">in</span> ans])</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(ans)//<span class="number">8</span>):</span><br><span class="line">    flag += chr(int(ans[<span class="number">8</span>*i:<span class="number">8</span>*(i+<span class="number">1</span>)], <span class="number">2</span>))</span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment">#05397c42f9b6da593a3644162d36eb01</span></span><br></pre></td></tr></table></figure><h3 id="easy-so"><a href="#easy-so" class="headerlink" title="easy-so"></a>easy-so</h3><p>简单考了java中对动态链接库的调用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s = list(<span class="string">'f72c5a36569418a20907b55be5bf95ad'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)//<span class="number">2</span>):</span><br><span class="line">    s[<span class="number">2</span>*i], s[<span class="number">2</span>*i+<span class="number">1</span>] = s[<span class="number">2</span>*i+<span class="number">1</span>], s[<span class="number">2</span>*i]</span><br><span class="line">flag = s[len(s)//<span class="number">2</span>:len(s)] + s[<span class="number">0</span>:len(s)//<span class="number">2</span>]</span><br><span class="line">print(<span class="string">''</span>.join(flag))</span><br><span class="line"><span class="comment">#90705bb55efb59da7fc2a5636549812a</span></span><br></pre></td></tr></table></figure><h3 id="easyjava"><a href="#easyjava" class="headerlink" title="easyjava"></a>easyjava</h3><p>就是读繁琐的java代码，理解程序加密流程。</p><p>考点：java代码的阅读能力；简单的置换加密。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">enc = <span class="string">'wigwrkaugala'</span></span><br><span class="line">base = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">a = [<span class="number">21</span>, <span class="number">4</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">20</span>, <span class="number">5</span>,</span><br><span class="line">     <span class="number">15</span>, <span class="number">9</span>, <span class="number">17</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">18</span>, <span class="number">12</span>, <span class="number">10</span>,</span><br><span class="line">     <span class="number">19</span>, <span class="number">0</span>, <span class="number">22</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">16</span>]</span><br><span class="line">ans = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    ans += [a[base.index(i)]]</span><br><span class="line">print(ans)</span><br><span class="line">b = [<span class="number">17</span>, <span class="number">23</span>, <span class="number">7</span>, <span class="number">22</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">6</span>,</span><br><span class="line">         <span class="number">9</span>, <span class="number">21</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">24</span>,</span><br><span class="line">         <span class="number">4</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">25</span>]</span><br><span class="line">base = list(base)</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ans:</span><br><span class="line">    flag += base[b[i]]</span><br><span class="line">    b = b[<span class="number">1</span>:len(b)] + [b[<span class="number">0</span>]]</span><br><span class="line">    base = base[<span class="number">1</span>:len(base)] + [base[<span class="number">0</span>]]</span><br><span class="line">print(<span class="string">''</span>.join(flag))</span><br><span class="line"><span class="comment">#venividivkcr</span></span><br></pre></td></tr></table></figure><h3 id="Ph0en1x-100"><a href="#Ph0en1x-100" class="headerlink" title="Ph0en1x-100"></a>Ph0en1x-100</h3><p>输入字符和和so层函数获得的字符串经过md5加密后进行比较。</p><p>从这个题练习了下调试so。注意：安卓模拟器不能调试arm架构的so文件，还是最好用真机来调试native层。</p><p>首先是直接模拟程序跑flag：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> a[] =</span><br><span class="line">&#123;</span><br><span class="line">   <span class="number">46</span>,  <span class="number">54</span>,  <span class="number">66</span>,  <span class="number">76</span>,  <span class="number">95</span>, <span class="number">191</span>, <span class="number">224</span>,  <span class="number">58</span>, <span class="number">168</span>, <span class="number">195</span>, </span><br><span class="line">   <span class="number">32</span>,  <span class="number">99</span>, <span class="number">137</span>, <span class="number">183</span>, <span class="number">192</span>,  <span class="number">28</span>,  <span class="number">29</span>,  <span class="number">68</span>, <span class="number">194</span>,  <span class="number">40</span>, </span><br><span class="line">  <span class="number">127</span>, <span class="number">237</span>,   <span class="number">2</span>,  <span class="number">14</span>,  <span class="number">93</span>, <span class="number">102</span>, <span class="number">143</span>, <span class="number">152</span>, <span class="number">181</span>, <span class="number">183</span>, </span><br><span class="line">  <span class="number">208</span>,  <span class="number">22</span>,  <span class="number">77</span>, <span class="number">131</span>, <span class="number">248</span>, <span class="number">251</span>,   <span class="number">1</span>,  <span class="number">67</span>,  <span class="number">71</span>,   <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> b[] = <span class="string">"Hello Ph0en1x"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, v6 = <span class="built_in">strlen</span>(b);</span><br><span class="line">	 </span><br><span class="line">	<span class="keyword">for</span> ( i = <span class="keyword">sizeof</span>(a) - <span class="number">2</span>; i &gt; <span class="number">0</span>; --i )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> v3 = a[i] + <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> *v7 = &amp;a[i - <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">int</span> v4 = i % v6;</span><br><span class="line">		a[i] = (b[v4] ^ (v3 - *v7)) - <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	a[<span class="number">0</span>] = (a[<span class="number">0</span>] ^ <span class="number">0x48</span>) - <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(a)<span class="number">-1</span>; i++)</span><br><span class="line">		<span class="built_in">putchar</span>(a[i]+<span class="number">1</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//flag&#123;Ar3_y0u_go1nG_70_scarborough_Fair&#125;</span></span><br></pre></td></tr></table></figure><p>然后就是调试了。简单记一下流程：</p><p>准备工作：</p><p>1.解包程序，<strong>apktool.bat d a.apk</strong>。在AndroidManifest.xml中的<strong>application</strong>后面加上android:debuggable=”true”。</p><p>2.重新打包程序，<strong>apktool.bat b a</strong>，这时候在a文件夹中的dist下的就是目标重新打包后的程序。</p><p>3.对重打包后的apk进行签名。</p><ul><li>生成签名文件：keytool -genkey -alias abc.keystore -keyalg RSA -validity 20000 -keystore abc.keystore</li><li>进行签名：jarsigner -verbose -keystore abc.keystore -signedjar b.apk a.apk abc.keystore</li></ul><p>接下来把程序装入模拟器，运行，进行调试，操作和常规的调试elf文件差不多了。</p><p>以调试模式启动程序：<strong>adb shell am start -D -n 包名/.活动名</strong></p><p>端口转发：<strong>adb forward tcp:23946 tcp:23946</strong></p><p>因为我用的模拟器，这里用了x86架构的so文件才调试上，虽然有点不能理解，为什么模拟器里程序都能运行，说明对so文件是运行了的啊，那调试怎么就不行呢（<strong>在之后突然想到的想法补充：可能是题目有对应结构的so文件，只是没提供给我们</strong>），且android_server在模拟器里也可以运行的。。其实这里的提示可以看见它调用的是<strong>1/lib/x86/下的so</strong>。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210206212259169.png" alt="image-20210206212259169"></p><p>嗯，，初学一个东西开始总是有很多疑惑的，等接触多了来慢慢理解。</p><p>ida中成功附加上程序后，在Modules模块找到我们要调试的so文件，再继续找到我们要调试的函数。</p><p>得到结果：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210206210632330.png" alt="image-20210206210632330"></p><h3 id="黑客精神"><a href="#黑客精神" class="headerlink" title="黑客精神"></a>黑客精神</h3><p>出现新知识点：so文件中的函数为动态注册。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210207182454660.png" alt="image-20210207182454660"></p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210207182859376.png" alt="image-20210207182859376"></p><p>然后就是一个加上文件读写操作的异或加密。</p><p>2个涉及的函数功能：通常连用来计算出一个文件中数据的字节数。</p><ul><li>C 库函数 <strong>int fseek(FILE *stream, long int offset, int whence)</strong> 设置流 <strong>stream</strong> 的文件位置为给定的偏移 <strong>offset</strong>，参数 offset 意味着从给定的 <strong>whence</strong> 位置查找的字节数。</li><li>C 库函数 <strong>long int ftell(FILE *stream)</strong> 返回给定流 stream 的当前文件位置。</li></ul><p>接下来解题部分：直接输入密文值，在文件中找到异或后的值即是flag。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210207184727271.png" alt="image-20210207184727271"></p><h3 id="easy-dex"><a href="#easy-dex" class="headerlink" title="easy-dex"></a>easy-dex</h3><p>题目得到flag的难度不大，但涉及的知识还需要多学习。</p><p>jadx中发现没有dex文件，从AndroidMainfest.xml看到：NativeActivity，安卓进行ndk开发使用的，所以应该是转战so文件中了。<img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/ncjKwbuX1qBF6ke.png" alt="image-20210208171101099"></p><p>找到android_main函数，首先是进行解密了2个字符串，打印出来就是app包路径相关的。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208171841729.png" alt="image-20210208171841729"></p><p>然后从打印的log，可以帮助识别程序的功能和流程。就是在10s内摇动手机100次，然后会使用这之间的表示次数的数据来解密一些数据代码：就是把enc分为10组，然后前8组分别和9, 19, 29…异或解密，后2组和89异或解密。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208172040397.png" alt="image-20210208172040397"></p><p>然后解压缩数据，写入文件。从上面打印出的路径信息，可以猜测这个就是生成一个dex文件。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208172227628.png" alt="image-20210208172227628"></p><p>仿照程序逻辑使用idapython解密数据后写入文件。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ida_bytes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">data = []</span><br><span class="line">addr = <span class="number">0x07004</span></span><br><span class="line">length = <span class="number">0x3CA10</span></span><br><span class="line">n = length//<span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(length):</span><br><span class="line">    a = get_byte(addr+i)</span><br><span class="line">    b = i//n</span><br><span class="line">    b = <span class="number">8</span> <span class="keyword">if</span> b &gt; <span class="number">8</span> <span class="keyword">else</span> b </span><br><span class="line">    c = b*<span class="number">10</span>+<span class="number">9</span></span><br><span class="line">    data += [a^c]</span><br><span class="line">data = bytes(data)</span><br><span class="line">f = open(<span class="string">'ans.Z'</span>, <span class="string">'wb'</span>)</span><br><span class="line">f.write(data)</span><br><span class="line">f.close()</span><br><span class="line">print(<span class="string">"-------success-----------"</span>)</span><br></pre></td></tr></table></figure><p>然后就是花了点时间的的uncompress操作，试了试linux下的发现不行。然后搜索文件头：<strong>78 9c</strong>，发现可以使用<a href="http://aluigi.org/mytoolz/offzip.zip" target="_blank" rel="noopener">Aluigi’s offzip</a> ：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208172543745.png" alt="image-20210208172543745"></p><p>提取出文件其中的数据，得到一个dex文件：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208175926442.png" alt="image-20210208175926442"></p><p>分析dex文件。发现有很多id，在res\values\public.xml中找到对应id的name，然后再到strings中找到对应name的字符串。对其注释了一下：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208172846985.png" alt="image-20210208172846985"></p><p>看了一圈后，可以知道我们输入的经过一种加密算法后与密文比较，而<strong>I have a male fish and a female fish.</strong>是key，看到只是取了它的32位，然后是key判断。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208173320567.png" alt="image-20210208173320567"></p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208173332255.png" alt="image-20210208173332255"></p><p>开始从字符串fish以为是blowfish加密，但简单看了下流程，完全对不上。</p><blockquote><p><strong>blowfish是加密64bit为数据，密钥也是64bit位。把密文分为每8个字节一组，然后一组分成2个部分，进行轮函数加密。</strong></p></blockquote><p>但这里是每16个字节一组，且加密流程也不一样：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208175231246.png" alt="image-20210208175231246"></p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208175306552.png" alt="image-20210208175306552"></p><p>最后，翻了一下这个加密中的数据用来搜索下找找相关的加密算法。</p><p>从最顶部的数据，google结果：<a href="https://xz.aliyun.com/t/5807" target="_blank" rel="noopener">TwoFish</a></p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208175435115.png" alt="image-20210208175435115"></p><p>然后使用python解密一下：因为33位，不是16的倍数，用0补齐成了48位。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> twofish <span class="keyword">import</span> Twofish</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">-120</span>, <span class="number">77</span>, <span class="number">-14</span>, <span class="number">-38</span>, <span class="number">17</span>, <span class="number">5</span>, <span class="number">-42</span>, <span class="number">44</span>, <span class="number">0xE0</span>, <span class="number">109</span>, <span class="number">85</span>, <span class="number">0x1F</span>, <span class="number">24</span>, <span class="number">-91</span>, <span class="number">0x90</span>, <span class="number">-83</span>, <span class="number">0x40</span>, <span class="number">-83</span>, <span class="number">0x80</span>, <span class="number">84</span>, <span class="number">5</span>, <span class="number">-94</span>, <span class="number">-98</span>, <span class="number">-30</span>, <span class="number">18</span>, <span class="number">70</span>, <span class="number">-26</span>, <span class="number">71</span>, <span class="number">5</span>, <span class="number">-99</span>, <span class="number">-62</span>, <span class="number">-58</span>, <span class="number">0x75</span>, <span class="number">29</span>, <span class="number">-44</span>, <span class="number">6</span>, <span class="number">0x70</span>, <span class="number">-4</span>, <span class="number">81</span>, <span class="number">84</span>, <span class="number">9</span>, <span class="number">22</span>, <span class="number">-51</span>, <span class="number">0x5F</span>, <span class="number">-34</span>, <span class="number">12</span>, <span class="number">0x2F</span>, <span class="number">77</span>]</span><br><span class="line">enc = [i&amp;<span class="number">0xff</span> <span class="keyword">for</span> i <span class="keyword">in</span> enc]</span><br><span class="line">enc = bytes(enc)</span><br><span class="line"></span><br><span class="line">key = <span class="string">'I have a male fish and a female '</span>.encode() <span class="comment">#bytes类型</span></span><br><span class="line"></span><br><span class="line">T = Twofish(key)</span><br><span class="line">flag = <span class="string">b''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(enc)//<span class="number">16</span>):</span><br><span class="line">    flag += T.decrypt(enc[<span class="number">16</span>*i:<span class="number">16</span>*(i+<span class="number">1</span>)])</span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment">#qwb&#123;TH3y_Io&lt;e_EACh_OTh3r_FOrEUER&#125;</span></span><br></pre></td></tr></table></figure><p>最后是做完题看了别人wp学习，发现：</p><ul><li>那个uncompress操作其实可以直接使用python的zlib模块，<strong>zlib.decompress(data)</strong> 就可以了。</li><li>可以把dex合成新的apk文件运行，接下来操作一下。</li></ul><p>dex合成新的apk文件：</p><p>1.把之前的app解包。</p><p>2.把<strong>AndroidManifest.xml</strong>中的android:hasCode=”false”属性去掉，默认为True。原因：之前的app是用c++开发的，app中并不包含java代码，所以把这个属性设置为False。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208185306706.png" alt="image-20210208185306706"></p><p>3.把<strong>AndroidManifest.xml</strong>中activity的android:name改为当前包和MainActivity。</p><p>4.把之前得到的dex文件改名为classes.dex放到解包目录下。</p><p>5.重新打包，并签名。</p><p>成功：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210208190250967.png" alt="image-20210208190250967"></p><h3 id="你是谁"><a href="#你是谁" class="headerlink" title="你是谁"></a>你是谁</h3><p>找到触摸响应的地方，可以看到<strong>sorted flag</strong>相关字符串，然后上面的getsna方法是得到汉字字符的unicode编码进行一个从小到大的选择排序，最后比较。</p><p>这里从排序结果后的汉字编码结果可以推出未经过排序后的值。</p><p>最后按照从字符串的提示，把汉字结果再转回unicode编码再套上flag{}即是。</p><h3 id="基础android"><a href="#基础android" class="headerlink" title="基础android"></a>基础android</h3><p>看了下程序逻辑，解出第一个密码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">107</span>-i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">12</span>)]</span><br></pre></td></tr></table></figure><p>然后进入MainActivity2把第二次的输入作为参数发送了一个广播：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210220151141668.png" alt="image-20210220151141668"></p><p>继续跟到接受广播的地方，看到又开始了一个新的活动。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210220151639862.png" alt="image-20210220151639862"></p><p>但看了后面的NextContent也没有验证图片显示码的地方，但是读了下代码，功能就是取出app中的资源文件中的timg_2.zip作为图片替换原来的图片。直接在jeb的Assets找到该文件，打开即是。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210220151914447.png" alt="image-20210220151914447"></p><p>其实，既然是NextContent活动直接更新了有flag的图片，直接adb启动指定的活动，也可以得到。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -n com.example.test.ctf02/.NextContent</span><br></pre></td></tr></table></figure><p>最后学习知道了<strong>那个图片显示码其实触发广播需要的密码</strong>，在清单文件有。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210220152303564.png" alt="image-20210220152303564"></p><p>且<strong>android:exported=”true”</strong>属性代表可以进行外部调用，那我们还可以用adb构造一个广播来达到目的。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am broadcast -a android.is.very.fun</span><br></pre></td></tr></table></figure><h3 id="APK逆向"><a href="#APK逆向" class="headerlink" title="APK逆向"></a>APK逆向</h3><p>把Tenshine进行md5().hexdigest()加密后取出偶数位。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = md5(<span class="string">b'Tenshine'</span>).hexdigest()</span><br><span class="line">flag = [s[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)) <span class="keyword">if</span> i%<span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line">print(<span class="string">''</span>.join(flag))</span><br></pre></td></tr></table></figure><p>题目很简单，但是从搭环境开始通过这个题学了一下frida hook java层。</p><p>简单记录一下流程：</p><blockquote><ol><li>安卓端执行下载好的对应frida服务。</li><li>进行2次端口转发：<strong><code>adb forward tcp:27043 tcp:27043</code>和<code>adb forward tcp:27042 tcp:27042</code></strong></li><li>安卓端运行app</li><li>执行写好的hook脚本。</li></ol></blockquote><p>贴下hook代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">jscode = <span class="string">'''</span></span><br><span class="line"><span class="string">    Java.perform(function()&#123;</span></span><br><span class="line"><span class="string">        var MainActivity = Java.use('com.example.crackme.MainActivity');</span></span><br><span class="line"><span class="string">        MainActivity.toHexString.implementation = function(a, b)&#123;</span></span><br><span class="line"><span class="string">            var ans = this.toHexString(a, b);</span></span><br><span class="line"><span class="string">            send(ans);</span></span><br><span class="line"><span class="string">            return ans;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span><span class="params">(message, data)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">'type'</span>] == <span class="string">'send'</span>:</span><br><span class="line">        print(message[<span class="string">'payload'</span>][::<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(message)</span><br><span class="line"></span><br><span class="line">process = frida.get_remote_device().attach(<span class="string">'com.example.crackme'</span>)</span><br><span class="line">script = process.create_script(jscode)</span><br><span class="line">script.on(<span class="string">'message'</span>, on_message)</span><br><span class="line">script.load()</span><br></pre></td></tr></table></figure><h3 id="人民的名义-抓捕赵德汉1-200"><a href="#人民的名义-抓捕赵德汉1-200" class="headerlink" title="人民的名义-抓捕赵德汉1-200"></a>人民的名义-抓捕赵德汉1-200</h3><p>一个jar包，用jd-gui看一下java代码。一个md5加密，在线解一下即可。</p><p>这里了解一下什么时候jar包：<strong>jar包是eclipse下的压缩包，由多个class文件压缩而成的。</strong></p><h3 id="boomshakalaka-3"><a href="#boomshakalaka-3" class="headerlink" title="boomshakalaka-3"></a>boomshakalaka-3</h3><p>飞机大战游戏。</p><p>jeb反编译后找到入口类：多次调用了a类中的d方法。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224192959108.png" alt="image-20210224192959108"></p><p>看看a类d方法功能：其中getSharedPreferences()是关键，返回一个SharedPreference对象，它会在/data/data/com.example.plane/下生成一个xml文件，以键值对的形式存储向其中输入的数据。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224193105424.png" alt="image-20210224193105424"></p><p>adb看一下：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224195210759.png" alt="image-20210224195210759"></p><p>但程序提示的打到最高分，java层没有任何与分数相关的地方，进入so中找到分数的地方：分析下且从DATA可以知道，这里就是根据我们打的分数不断向xml文件中添加写入不同的字符串。<img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224195529004.png" alt="image-20210224195529004"></p><p>而要写入字符串字符串的开始和结尾是确定了的，只是中间的字符串会因为分数不同而不通过，这个自己打游戏然后查看数据或者直接ida中分析都可以知道。</p><p>注意的地方：要指定的分数才会写入指定字符串，所以如果打游戏测试的话要算着打😂。</p><p>测试一波后，写入顺序就是给出的，把开始结尾确定好后向中间填充好base64解码得到flag。</p><p><strong>MGN0ZntDMGNvUzJkX0FuRHJvMWRfRzBtRV9Zb1VfS24wdz99</strong></p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210224202624546.png" alt="image-20210224202624546"></p><h3 id="android1"><a href="#android1" class="headerlink" title="android1"></a>android1</h3><p>app进行了梆梆加固，开始准备环境安装dump dex，准备完开始安装app发现报错。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210225225117463.png" alt="image-20210225225117463"></p><p>后面才发现了是因为app没有签名，签上名后还要注意：</p><p>安装时带上-t选项。原因：</p><p>Android Studio 3.0会在debug apk的<code>manifest</code>文件<code>application</code>标签里自动添加 <code>android:testOnly=&quot;true&quot;</code>属性。</p><p>成功安装程序，打开提示资源文件，进而从values的string.xml中找到flag。</p><p><strong>flag{1FF9B2CCB90A2D943DBAA072DF0A279C}</strong></p><h3 id="Android2-0"><a href="#Android2-0" class="headerlink" title="Android2.0"></a>Android2.0</h3><p>简单考了一下so层。</p><p><strong>flag{sosorryla}</strong></p><h3 id="Illusion"><a href="#Illusion" class="headerlink" title="Illusion"></a>Illusion</h3><p>关键就在so层的一个加密函数，开始直接在Exports找到名称为CheckFlag的函数，为了熟悉一下so层的调试，在这个函数下了断点但每次都不断不下来。。</p><p>然后开始找原因，后面发现这个假的函数，真正是动态加载的。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210303203021780.png" alt="image-20210303203021780"></p><p>进入正确的函数开始分析，函数的伪代码明显是有点问题的，看arm汇编就好了。</p><p>其中关键就是<strong>sub_CCB09028</strong>这个函数：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210303203358493.png" alt="image-20210303203358493"></p><p>分析了一下没看出所以然，但这个是一位一位加密的，所以可以直接穷举的。</p><p>写ida-python，但这个穷举最后一位有2个字符都可，空格和‘}’，还好是最后一位，那肯定是字符}了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">enc = <span class="string">"Ku@'G_V9v(yGS"</span></span><br><span class="line">s = <span class="string">'(Ljava/lang/String;Ljava/'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(a1, a2)</span>:</span></span><br><span class="line">    v3 = <span class="number">1</span></span><br><span class="line">    v4 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> a1 &gt;= a2:  </span><br><span class="line">        <span class="keyword">while</span> a2 &lt; a1:</span><br><span class="line">            a2 *= <span class="number">16</span></span><br><span class="line">            v3 *= <span class="number">16</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> a1 &gt;= a2:</span><br><span class="line">                a1 -= a2</span><br><span class="line">                v4 |= v3</span><br><span class="line">            <span class="keyword">if</span> a1 &gt;= a2 &gt;&gt; <span class="number">1</span>:</span><br><span class="line">                a1 -= a2 &gt;&gt; <span class="number">1</span></span><br><span class="line">                v4 |= v3 &gt;&gt; <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> a1 &gt;= a2 &gt;&gt; <span class="number">2</span>:</span><br><span class="line">                a1 -= a2 &gt;&gt; <span class="number">2</span></span><br><span class="line">                v4 |= v3 &gt;&gt; <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> a1 &gt;= a2 &gt;&gt; <span class="number">3</span>:</span><br><span class="line">                a1 -= a2 &gt;&gt; <span class="number">3</span></span><br><span class="line">                v4 |= v3 &gt;&gt; <span class="number">3</span></span><br><span class="line">            <span class="keyword">if</span> a1 == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            v3 &gt;&gt;= <span class="number">4</span></span><br><span class="line">            <span class="keyword">if</span> v3 == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            a2 &gt;&gt;= <span class="number">4</span>      </span><br><span class="line">    <span class="keyword">return</span> v4</span><br><span class="line">    </span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(enc)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">33</span>, <span class="number">127</span>):</span><br><span class="line">        r1 = j+ord(s[i])<span class="number">-64</span></span><br><span class="line">        r2 = <span class="number">0x5d</span></span><br><span class="line">        <span class="keyword">if</span> r1 - fun(r1, r2)*<span class="number">0x5d</span> + <span class="number">0x20</span> == ord(enc[i]):</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">print(flag.encode())</span><br><span class="line"><span class="comment">#CISCN&#123;GJ5728&#125;</span></span><br></pre></td></tr></table></figure><p>写完仔细分析了下那个函数，其实该函数和后面对函数返回值的处理就是<strong>求模（mod）</strong>的操作，但没有使用/与mod，可以学习一下。这从最后的操作看其实很明显。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210303204003498.png" alt="image-20210303204003498"></p><h3 id="APK逆向-2"><a href="#APK逆向-2" class="headerlink" title="APK逆向-2"></a>APK逆向-2</h3><p>首先安装app失败。。</p><p>反编译后首先看了一下<strong>AndroidManifest.xml</strong>，发现空的。。然后看了app的主要逻辑和类，很乱和杂吧，也不清楚要做什么。。</p><p>然后我为了看其中的一个资源文件对app进行了直接解压，这个倒是没看出什么。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210304192508917.png" alt="image-20210304192508917"></p><p>但在其中看到<strong>AndroidManifest.xml</strong>并不是空的，然后尝试使用apktool对apk解包，解包失败。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210304192711623.png" alt="image-20210304192711623"></p><p>由此可以知道，应该是对<strong>AndroidManifest.xml</strong>文件做了手脚。</p><p>然后就是要知道安卓<strong>AndroidManifest.xml</strong>文件格式了，这是修改过的。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210304193133042.png" alt="image-20210304193133042"></p><p>再看一个正常的：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210304193230661.png" alt="image-20210304193230661"></p><p>通过修复后，重新压缩成压缩包，在xml文件中看到flag相关：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/H1aGYAcMoEPShpW.png" alt="image-20210304193456601"></p><h3 id="ill-intentions"><a href="#ill-intentions" class="headerlink" title="ill-intentions"></a>ill-intentions</h3><p>在MainActivity中注册了一个广播接收器：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305193418021.png" alt="image-20210305193418021"></p><p>根据在设置在屏幕上的文本来看Send_to_Activity，就是根据接受到的不同广播消息执行不同的函数。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305193507242.png" alt="image-20210305193507242"></p><p>然后看了一下三个不同的函数，其执行逻辑其实是一样的，把3个指定字符串经过sha224与base64及替换加密后再经过so层函数的操作，最后把结果以广播形式发出，但这里并不是发送给Send_to_Activity。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305213542600.png" alt="image-20210305213542600"></p><p>so层的加密操作一个异或，能想到运算结果就是我们要的flag。</p><p>由于只有三种结果，用ida-python模拟了程序的运算逻辑，在IsThisTheRealOne活动得到flag。这里开始一直出错得不到结果，后面调试发现是getClass().getName()得到的类名我没有把整个包加上。。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha224</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">a = [<span class="string">'e'</span>, <span class="string">'W'</span>, <span class="string">'h'</span>, <span class="string">'a'</span>, <span class="string">'t'</span>, <span class="string">'i'</span>, <span class="string">'s'</span>, <span class="string">'d'</span>, <span class="string">'o'</span>, <span class="string">'n'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">en</span><span class="params">(s)</span>:</span></span><br><span class="line">    s = sha224(s.encode()).hexdigest().encode()</span><br><span class="line">    s = base64.b64encode(s).decode().replace(<span class="string">'='</span>, <span class="string">'?'</span>)</span><br><span class="line">    s = list(s)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)):</span><br><span class="line">        temp = ord(s[i])</span><br><span class="line">        <span class="keyword">if</span>  temp &gt; <span class="number">47</span> <span class="keyword">and</span> temp &lt; <span class="number">58</span>:</span><br><span class="line">            s[i] = a[temp<span class="number">-48</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(s)</span><br><span class="line">    </span><br><span class="line">s1 = <span class="string">b'TRytfrgooq|F&#123;i-JovFBungFk'</span>+<span class="string">b'\\VlphgQbwvj~HuDgaeTzuSt.@Lex^~'</span></span><br><span class="line">s1 = list(s1) + [<span class="number">119</span>, <span class="number">110</span>, <span class="number">119</span>, <span class="number">71</span>, <span class="number">114</span>, <span class="number">97</span>, <span class="number">98</span>, <span class="number">123</span>, <span class="number">79</span>, <span class="number">117</span>, </span><br><span class="line">  <span class="number">116</span>, <span class="number">98</span>, <span class="number">104</span>, <span class="number">127</span>, <span class="number">114</span>, <span class="number">67</span>] + list(<span class="string">b'tfqm&#125;'</span>)</span><br><span class="line">s2 = <span class="string">'SendAnIntentApplication'</span></span><br><span class="line">s3 = <span class="string">'com.example.application.IsThisTheRealOne$1'</span></span><br><span class="line">s3 = s3[<span class="number">0</span>:len(s3)<span class="number">-2</span>]</span><br><span class="line"></span><br><span class="line">s2 = en(s2).encode()</span><br><span class="line">s3 = en(s3).encode()</span><br><span class="line">print(<span class="string">'---------------------------------------------------'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">76</span>):</span><br><span class="line">    print(chr(s1[i]^s2[i]^s3[i]), end = <span class="string">''</span>)</span><br><span class="line"><span class="comment">#Congratulation!YouFoundTheRightActivityHereYouGo-CTF&#123;IDontHaveABadjokeSorry&#125;</span></span><br></pre></td></tr></table></figure><p>另外，由于app中是多个活动，开始我是想直接用adb命令来启动每个活动，通过调试看输出是什么，但都启动失败，什么权限禁止。通过计算得到flag后，通过搜集发现是要对活动没有指定属性<strong>android:exported=”true”</strong>，</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305222644097.png" alt="image-20210305222644097"></p><blockquote><p><strong>android.intent.action.MAIN：决定应用的入口Activity，也就是我们启动应用时首先显示哪一个Activity。</strong><br><strong>android.intent.category.LAUNCHER：表示activity应该被列入系统的启动器(launcher)(允许用户启动它)。Launcher是安卓系统中的桌面启动器，是桌面UI的统称。</strong></p></blockquote><p>指定后通过adb命令启动成功，可直接通过调试查看生成的字符串，我尝试修改smali来插入打印Log的语句，然后同伙查看日志同样得到flag。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305223009728.png" alt="image-20210305223009728"></p><p>最后查看日志：<br><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210305223046697.png" alt="image-20210305223046697"></p><h2 id="d3ctf"><a href="#d3ctf" class="headerlink" title="d3ctf"></a>d3ctf</h2><h3 id="No-Name"><a href="#No-Name" class="headerlink" title="No Name"></a>No Name</h3><p>找到入口活动，将输入传入FlagChecker类的checkFlag函数，然后又是实现接口中的check函数，最后调用，感觉有点套娃，，实质就是调用native层的check函数。。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310201450601.png" alt="image-20210310201450601"></p><p>但是注意清单文件中application中的android:name属性：这里指定了<strong>app启动时关联的一个application，这个类的作用就是做一些初始化，放一些全局变量和程序上下文相关的东西</strong>，默认是android.app.Application。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310203122424.png" alt="image-20210310203122424"></p><p>来到app启动时指定的这个类：NoNameApp。比较简单的代码，就是得到资源文件data.enc然后获取一个aeskey对其进行aes解密，且这里指定的解密得到的文件和存放路径。然后进行dex加载并把FlagChecker中mFlagChecker的实例进行了替换，也就是把上面我们分析出的native层那个check函数进行了替换。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310203554497.png" alt="image-20210310203554497"></p><p>所以可以知道app真正检查的逻辑在解密出的jar文件中，现在的目的就是得到这个jar，首先想到的就是直接在程序运行后在指定的路径下去找。</p><p>虽然app在加载完解密后对解密出的文件进行了删除，但是可以将app的smali修改，删除<strong>file.delete()；</strong>后对其重新打包然后签名。</p><p>这里签名完后安装遇到了问题，一个是之前知道的app有<strong>android:testOnly=”true”</strong>，解决办法：1.安装时加上-t选项。2.在清单文件中删除该属性。</p><p>第二个问题：</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310204857678.png" alt="image-20210310204857678"></p><p>搜索到这篇文章 <a href="https://testerhome.com/topics/18463" target="_blank" rel="noopener">https://testerhome.com/topics/18463</a></p><blockquote><p>如果 AndroidManifest.xml 中未设置 extractNativeLibs=true，使用 apktool 反编译时有可能导致 extractNativeLibs 被设置为 false。</p></blockquote><p>至于extractNativeLibs属性，开启的话就是把apk中的so解压缩提取到本地存取一份，关闭的话不在本地存储一份，在运行时直接调用app中的so。</p><p>如果关闭的话，且我们apk是未对齐或so文件是压缩状态的话将阻止我们安装apk，也就是上面的报的错。</p><p><strong>然后导致我们默认开启extractNativeLibs的属性关闭的原因：使用apktool对app进行反编译和回编译。</strong></p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310205935229.png" alt="image-20210310205935229"></p><p>最后把这个属性改为true，回编译签名后，运行app，在data/data/包名/下得到解密出的jar文件，简单的异或。。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310210138830.png" alt="image-20210310210138830"></p><p>最后说一下，在AK中反编译apk遇到<strong>com.googlecode.d2j.DexException: not support version</strong>的问题。</p><p>这个是dex2jar版本与dex版本不兼容主动抛出的异常，从报错找到dex-reader-2.1-20190905-lanchon.jar文件中的DexFileReader函数，看源码。</p><p><img src="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/image-20210310210853842.png" alt="image-20210310210853842"></p><p>解决办法，更换最新的dex2jar版本就好了。<a href="https://www.jianshu.com/p/55bf5f688e9a" target="_blank" rel="noopener">https://www.jianshu.com/p/55bf5f688e9a</a></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>Post author:</strong> ooo</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://bxb0.github.io/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/" title="Andriod之CTF学习">https://bxb0.github.io/2021/02/05/Andriod刷题学习/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-item"><a href="/2021/02/04/HGAME%202021/" rel="prev" title="HGAME 2021"><i class="fa fa-chevron-left"></i> HGAME 2021</a></div><div class="post-nav-item"> <a href="/2021/03/12/web%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%88%B7%E9%A2%98/" rel="next" title="web学习之刷题">web学习之刷题<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#攻防世界"><span class="nav-number">1.</span> <span class="nav-text">攻防世界</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#easyjni"><span class="nav-number">1.1.</span> <span class="nav-text">easyjni</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#app3"><span class="nav-number">1.2.</span> <span class="nav-text">app3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-apk"><span class="nav-number">1.3.</span> <span class="nav-text">easy-apk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-so"><span class="nav-number">1.4.</span> <span class="nav-text">easy-so</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easyjava"><span class="nav-number">1.5.</span> <span class="nav-text">easyjava</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ph0en1x-100"><span class="nav-number">1.6.</span> <span class="nav-text">Ph0en1x-100</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#黑客精神"><span class="nav-number">1.7.</span> <span class="nav-text">黑客精神</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-dex"><span class="nav-number">1.8.</span> <span class="nav-text">easy-dex</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#你是谁"><span class="nav-number">1.9.</span> <span class="nav-text">你是谁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基础android"><span class="nav-number">1.10.</span> <span class="nav-text">基础android</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#APK逆向"><span class="nav-number">1.11.</span> <span class="nav-text">APK逆向</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#人民的名义-抓捕赵德汉1-200"><span class="nav-number">1.12.</span> <span class="nav-text">人民的名义-抓捕赵德汉1-200</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#boomshakalaka-3"><span class="nav-number">1.13.</span> <span class="nav-text">boomshakalaka-3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#android1"><span class="nav-number">1.14.</span> <span class="nav-text">android1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android2-0"><span class="nav-number">1.15.</span> <span class="nav-text">Android2.0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Illusion"><span class="nav-number">1.16.</span> <span class="nav-text">Illusion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#APK逆向-2"><span class="nav-number">1.17.</span> <span class="nav-text">APK逆向-2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ill-intentions"><span class="nav-number">1.18.</span> <span class="nav-text">ill-intentions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#d3ctf"><span class="nav-number">2.</span> <span class="nav-text">d3ctf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#No-Name"><span class="nav-number">2.1.</span> <span class="nav-text">No Name</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">ooo</p><div class="site-description" itemprop="description">0x446e37fb</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">46</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">3</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://i0gan.cn:81/" title="http:&#x2F;&#x2F;i0gan.cn:81&#x2F;" rel="noopener" target="_blank">i0gan</a></li><li class="links-of-blogroll-item"> <a href="https://hack-for.fun/" title="https:&#x2F;&#x2F;hack-for.fun&#x2F;" rel="noopener" target="_blank">M0nk3y</a></li><li class="links-of-blogroll-item"> <a href="http://happi0.gitee.io/" title="http:&#x2F;&#x2F;happi0.gitee.io&#x2F;" rel="noopener" target="_blank">happi0</a></li><li class="links-of-blogroll-item"> <a href="https://vino0o0o.github.io/" title="https:&#x2F;&#x2F;vino0o0o.github.io&#x2F;" rel="noopener" target="_blank">Vino0o0o</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">ooo</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i></span> <span class="post-meta-item-text">Symbols count total:</span> <span title="Symbols count total">371k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">Reading time total &asymp;</span> <span title="Reading time total">5:38</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script type="text/javascript" src="/js/src/clicklove.js"></script><script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"left",width:150,height:300},mobile:{show:!0},log:!1})</script></body></html>