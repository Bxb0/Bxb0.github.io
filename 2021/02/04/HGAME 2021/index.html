<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/2.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/2.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"bxb0.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="一个月hgame结束，做完了逆向题，在此记录一下。"><meta property="og:type" content="article"><meta property="og:title" content="HGAME 2021"><meta property="og:url" content="https://bxb0.github.io/2021/02/04/HGAME%202021/index.html"><meta property="og:site_name" content="Bxb0&#39;s blog"><meta property="og:description" content="一个月hgame结束，做完了逆向题，在此记录一下。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://i.loli.net/2021/02/27/imfSALBWP2nDy7o.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/IbUASK8JgpGLFr6.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/zMNw8FvRtLHaGPT.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/56TDYkbSyOjLNpK.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/hcqCNUm63VFPaZR.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/kRrY7a6meKp59Pz.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/Gna2KV58FQRH7oc.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/SMEapnGisTgZIWl.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/3xWMP72bsnJ89qe.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/r6JaDQfPuLT7qCH.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/johwg4l5qzErmNb.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/ZiAxb93RSNz7Foa.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/ruso9GQJk7PqxYE.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/UxcMZYkvEy4TsDh.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/rS7LQ2zW3DjHcZx.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/VhjmxeSoF9OPayk.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/hPdyLxSuDFpTRZE.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/gdX7jNlDYhB2fJv.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/6AUTcPakH9fLeiq.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/vicGJT4f5utmgY9.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/oezlBwiY5mTZuOA.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/CyHbQdXat52eZkR.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/NdvUQpMXrFontj9.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/4rOwLYtVzcUlDmf.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/e9vF4mky3D5oiHp.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/kB8jiNXfsgQzJ4H.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/gD1dcpLSm9QAvo2.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/iQqyeAYgFaJVoMc.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/p7NOiGZoXHwMrKW.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/cpix3L91BESXuGe.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/WRM9vQi1HZD8O7e.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/GRqjEDtQSy2rYsb.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/oYBRAm6M51IbNpl.png"><meta property="og:image" content="https://i.loli.net/2021/02/27/PXbVClN4UeKqJwj.png"><meta property="article:published_time" content="2021-02-04T10:04:15.000Z"><meta property="article:modified_time" content="2021-08-25T10:54:04.597Z"><meta property="article:author" content="ooo"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.loli.net/2021/02/27/imfSALBWP2nDy7o.png"><link rel="canonical" href="https://bxb0.github.io/2021/02/04/HGAME%202021/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>HGAME 2021 | Bxb0's blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Bxb0's blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Bxb0's blog</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> Categories<span class="badge">15</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> Archives<span class="badge">46</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://bxb0.github.io/2021/02/04/HGAME%202021/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="ooo"><meta itemprop="description" content="0x446e37fb"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Bxb0's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> HGAME 2021</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-02-04 18:04:15" itemprop="dateCreated datePublished" datetime="2021-02-04T18:04:15+08:00">2021-02-04</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">Symbols count in article:</span> <span>24k</span></span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span>22 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><p>一个月hgame结束，做完了逆向题，在此记录一下。<a id="more"></a></p><h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="apacha"><a href="#apacha" class="headerlink" title="apacha"></a>apacha</h3><p>考了一个xxtea加密算法：key是{1, 2, 3, 4}</p><p><img src="https://i.loli.net/2021/02/27/imfSALBWP2nDy7o.png" alt="image-20210204180727273"></p><p>跟着算法逻辑逆一下就行了：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> LEN = <span class="number">35</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> delat = <span class="number">0x9E3779B9</span> * (<span class="number">52</span> / LEN) - <span class="number">0x4AB325AA</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> KEY[] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> ENC[] =</span><br><span class="line">&#123;</span><br><span class="line">   <span class="number">35</span>, <span class="number">179</span>,  <span class="number">78</span>, <span class="number">231</span>,  <span class="number">54</span>,  <span class="number">40</span>, <span class="number">167</span>, <span class="number">183</span>, <span class="number">226</span>, <span class="number">111</span>, </span><br><span class="line">  <span class="number">202</span>,  <span class="number">89</span>, <span class="number">193</span>, <span class="number">197</span>, <span class="number">124</span>, <span class="number">150</span>, <span class="number">116</span>,  <span class="number">38</span>, <span class="number">128</span>, <span class="number">231</span>, </span><br><span class="line">  <span class="number">230</span>,  <span class="number">84</span>,  <span class="number">45</span>,  <span class="number">61</span>,  <span class="number">86</span>,   <span class="number">3</span>, <span class="number">157</span>, <span class="number">138</span>, <span class="number">156</span>, <span class="number">195</span>, </span><br><span class="line">  <span class="number">220</span>, <span class="number">153</span>, <span class="number">237</span>, <span class="number">216</span>,  <span class="number">38</span>, <span class="number">112</span>, <span class="number">173</span>, <span class="number">253</span>,  <span class="number">51</span>, <span class="number">106</span>, </span><br><span class="line">   <span class="number">10</span>,  <span class="number">85</span>, <span class="number">150</span>, <span class="number">244</span>, <span class="number">158</span>, <span class="number">111</span>, <span class="number">156</span>,  <span class="number">92</span>,  <span class="number">76</span>, <span class="number">208</span>, </span><br><span class="line">  <span class="number">229</span>,  <span class="number">27</span>,  <span class="number">23</span>, <span class="number">174</span>,  <span class="number">35</span>, <span class="number">103</span>, <span class="number">194</span>, <span class="number">165</span>, <span class="number">112</span>,  <span class="number">82</span>, </span><br><span class="line">   <span class="number">10</span>,  <span class="number">19</span>,  <span class="number">66</span>, <span class="number">172</span>, <span class="number">178</span>, <span class="number">103</span>, <span class="number">190</span>, <span class="number">132</span>, <span class="number">121</span>, <span class="number">199</span>, </span><br><span class="line">   <span class="number">92</span>, <span class="number">112</span>, <span class="number">152</span>,  <span class="number">61</span>,  <span class="number">81</span>,  <span class="number">92</span>,  <span class="number">45</span>, <span class="number">218</span>,  <span class="number">54</span>, <span class="number">251</span>, </span><br><span class="line">   <span class="number">69</span>, <span class="number">150</span>,  <span class="number">23</span>,  <span class="number">34</span>, <span class="number">157</span>,  <span class="number">82</span>, <span class="number">227</span>,  <span class="number">92</span>, <span class="number">251</span>, <span class="number">225</span>, </span><br><span class="line">  <span class="number">137</span>, <span class="number">209</span>, <span class="number">137</span>, <span class="number">212</span>,  <span class="number">91</span>, <span class="number">232</span>,  <span class="number">31</span>, <span class="number">209</span>, <span class="number">200</span>, <span class="number">115</span>, </span><br><span class="line">  <span class="number">150</span>, <span class="number">193</span>, <span class="number">181</span>,  <span class="number">84</span>, <span class="number">144</span>, <span class="number">180</span>, <span class="number">124</span>, <span class="number">182</span>, <span class="number">202</span>, <span class="number">228</span>, </span><br><span class="line">   <span class="number">23</span>,  <span class="number">33</span>, <span class="number">148</span>, <span class="number">249</span>, <span class="number">227</span>, <span class="number">157</span>, <span class="number">170</span>, <span class="number">161</span>,  <span class="number">90</span>,  <span class="number">47</span>, </span><br><span class="line">  <span class="number">253</span>,   <span class="number">1</span>, <span class="number">232</span>, <span class="number">167</span>, <span class="number">171</span>, <span class="number">110</span>,  <span class="number">13</span>, <span class="number">195</span>, <span class="number">156</span>, <span class="number">220</span>, </span><br><span class="line">  <span class="number">173</span>,  <span class="number">27</span>,  <span class="number">74</span>, <span class="number">176</span>,  <span class="number">83</span>,  <span class="number">52</span>, <span class="number">249</span>,   <span class="number">6</span>, <span class="number">164</span>, <span class="number">146</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">de_xxtea</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> *enc = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)ENC;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> *key = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)KEY;</span><br><span class="line">	 </span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">unsigned</span> <span class="keyword">char</span> delat1 = (<span class="keyword">unsigned</span> <span class="keyword">char</span>)(delat &gt;&gt; <span class="number">2</span>);</span><br><span class="line">		enc[LEN<span class="number">-1</span>] -= ((key[((LEN<span class="number">-1</span>)^delat1)&amp;<span class="number">3</span>]^enc[LEN<span class="number">-2</span>])+(enc[<span class="number">0</span>]^delat)) ^ (((<span class="number">4</span>*enc[<span class="number">0</span>])^(enc[LEN<span class="number">-2</span>]&gt;&gt;<span class="number">5</span>))+((<span class="number">16</span>*enc[LEN<span class="number">-2</span>])^(enc[<span class="number">0</span>]&gt;&gt;<span class="number">3</span>)));</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">int</span> i = LEN<span class="number">-2</span>;</span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			enc[i] -= ((key[(i^delat1)&amp;<span class="number">3</span>]^enc[i<span class="number">-1</span>])+(enc[i+<span class="number">1</span>]^delat)) ^ (((<span class="number">4</span>*enc[i+<span class="number">1</span>])^(enc[i<span class="number">-1</span>]&gt;&gt;<span class="number">5</span>))+((<span class="number">16</span>*enc[i<span class="number">-1</span>])^(enc[i+<span class="number">1</span>]&gt;&gt;<span class="number">3</span>)));</span><br><span class="line">			i--; </span><br><span class="line">		&#125;<span class="keyword">while</span>(i != <span class="number">0</span>);</span><br><span class="line">		enc[<span class="number">0</span>] -= ((key[(<span class="number">0</span>^delat1)&amp;<span class="number">3</span>]^enc[LEN<span class="number">-1</span>])+(enc[<span class="number">1</span>]^delat)) ^ (((<span class="number">4</span>*enc[<span class="number">1</span>])^(enc[LEN<span class="number">-1</span>]&gt;&gt;<span class="number">5</span>))+((<span class="number">16</span>*enc[LEN<span class="number">-1</span>])^(enc[<span class="number">1</span>]&gt;&gt;<span class="number">3</span>)));</span><br><span class="line">		</span><br><span class="line">		delat += <span class="number">0x61C88647</span>;</span><br><span class="line">	&#125;<span class="keyword">while</span>(delat != <span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	de_xxtea();</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">35</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%c"</span>, ENC[i*<span class="number">4</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//hgame&#123;l00ks_1ike_y0u_f0Und_th3_t34&#125;</span></span><br></pre></td></tr></table></figure><h3 id="helloRe"><a href="#helloRe" class="headerlink" title="helloRe"></a>helloRe</h3><p>就是一个异或解密，但是可以从这里学习一下STL模板中的string的结构。</p><p>能猜测出v14就是我们输入字符串的长度，但是怎么来的呢？其实使用了string结构。</p><p><img src="https://i.loli.net/2021/02/27/IbUASK8JgpGLFr6.png" alt="image-20210204182522063"></p><p>string结构：一共占24个字节（这也是一个可以让我们用来识别的特征）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">string</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> _Buf[<span class="number">16</span>];           <span class="comment">// 当字符串长度小于等于0xF时，数据存储在_Buf数组中</span></span><br><span class="line">                             <span class="comment">// 大于0xF时将分配一个变量，_Buf存储的是该变量地址。</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> _Mysize;    <span class="comment">// 字符串长度</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> _Myres;     <span class="comment">// 可存储的最大长度</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>来测试一个输入看看：</p><p><img src="https://i.loli.net/2021/02/27/zMNw8FvRtLHaGPT.png" alt="image-20210204182822594"></p><p>最后题解：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ida_bytes <span class="keyword">import</span> *</span><br><span class="line">addr = <span class="number">0x07FF756E13480</span></span><br><span class="line">cnt = <span class="number">0xff</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">22</span>):</span><br><span class="line">    flag += chr(get_byte(addr)^cnt)</span><br><span class="line">    cnt -= <span class="number">1</span></span><br><span class="line">    addr += <span class="number">1</span></span><br><span class="line">print(flag)</span><br><span class="line"><span class="comment">#hgame&#123;hello_re_player&#125;</span></span><br></pre></td></tr></table></figure><h3 id="pypy"><a href="#pypy" class="headerlink" title="pypy"></a>pypy</h3><p>给了通过dis模块得到的python反汇编代码，我把对应的python代码注释了下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">4</span>           <span class="number">0</span> LOAD_GLOBAL              <span class="number">0</span> (input)</span><br><span class="line">              <span class="number">2</span> LOAD_CONST               <span class="number">1</span> (<span class="string">'give me your flag:\n'</span>)</span><br><span class="line">              <span class="number">4</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">              <span class="number">6</span> STORE_FAST               <span class="number">0</span> (raw_flag) 	<span class="comment">#raw_flag = input('give me your flag:\n')</span></span><br><span class="line"></span><br><span class="line">  <span class="number">5</span>           <span class="number">8</span> LOAD_GLOBAL              <span class="number">1</span> (list)</span><br><span class="line">             <span class="number">10</span> LOAD_FAST                <span class="number">0</span> (raw_flag)</span><br><span class="line">             <span class="number">12</span> LOAD_CONST               <span class="number">2</span> (<span class="number">6</span>)</span><br><span class="line">             <span class="number">14</span> LOAD_CONST               <span class="number">3</span> (<span class="number">-1</span>)</span><br><span class="line">             <span class="number">16</span> BUILD_SLICE              <span class="number">2</span></span><br><span class="line">             <span class="number">18</span> BINARY_SUBSCR</span><br><span class="line">             <span class="number">20</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">             <span class="number">22</span> STORE_FAST               <span class="number">1</span> (cipher)	<span class="comment">#cipher = list(raw_flag[6:-1])</span></span><br><span class="line"></span><br><span class="line">  <span class="number">6</span>          <span class="number">24</span> LOAD_GLOBAL              <span class="number">2</span> (len)</span><br><span class="line">             <span class="number">26</span> LOAD_FAST                <span class="number">1</span> (cipher)</span><br><span class="line">             <span class="number">28</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">             <span class="number">30</span> STORE_FAST               <span class="number">2</span> (length)	<span class="comment">#length = len(cipher)</span></span><br><span class="line"></span><br><span class="line">  <span class="number">8</span>          <span class="number">32</span> LOAD_GLOBAL              <span class="number">3</span> (range)</span><br><span class="line">             <span class="number">34</span> LOAD_FAST                <span class="number">2</span> (length)</span><br><span class="line">             <span class="number">36</span> LOAD_CONST               <span class="number">4</span> (<span class="number">2</span>)</span><br><span class="line">             <span class="number">38</span> BINARY_FLOOR_DIVIDE</span><br><span class="line">             <span class="number">40</span> CALL_FUNCTION            <span class="number">1</span>	<span class="comment">#range(length/2)</span></span><br><span class="line">             <span class="number">42</span> GET_ITER</span><br><span class="line">        &gt;&gt;   <span class="number">44</span> FOR_ITER                <span class="number">54</span> (to <span class="number">100</span>)</span><br><span class="line">             <span class="number">46</span> STORE_FAST               <span class="number">3</span> (i)		<span class="comment">#for i in range(length/2):</span></span><br><span class="line"></span><br><span class="line">  <span class="number">9</span>          <span class="number">48</span> LOAD_FAST                <span class="number">1</span> (cipher)</span><br><span class="line">             <span class="number">50</span> LOAD_CONST               <span class="number">4</span> (<span class="number">2</span>)</span><br><span class="line">             <span class="number">52</span> LOAD_FAST                <span class="number">3</span> (i)</span><br><span class="line">             <span class="number">54</span> BINARY_MULTIPLY</span><br><span class="line">             <span class="number">56</span> LOAD_CONST               <span class="number">5</span> (<span class="number">1</span>)</span><br><span class="line">             <span class="number">58</span> BINARY_ADD</span><br><span class="line">             <span class="number">60</span> BINARY_SUBSCR			<span class="comment">#cipher[2*i+1]</span></span><br><span class="line">             <span class="number">62</span> LOAD_FAST                <span class="number">1</span> (cipher)</span><br><span class="line">             <span class="number">64</span> LOAD_CONST               <span class="number">4</span> (<span class="number">2</span>)</span><br><span class="line">             <span class="number">66</span> LOAD_FAST                <span class="number">3</span> (i)</span><br><span class="line">             <span class="number">68</span> BINARY_MULTIPLY</span><br><span class="line">             <span class="number">70</span> BINARY_SUBSCR			<span class="comment">#cipher[2*i]</span></span><br><span class="line">             <span class="number">72</span> ROT_TWO			<span class="comment">#swap 改变指针的指向来实现</span></span><br><span class="line">             <span class="number">74</span> LOAD_FAST                <span class="number">1</span> (cipher)</span><br><span class="line">             <span class="number">76</span> LOAD_CONST               <span class="number">4</span> (<span class="number">2</span>)</span><br><span class="line">             <span class="number">78</span> LOAD_FAST                <span class="number">3</span> (i)</span><br><span class="line">             <span class="number">80</span> BINARY_MULTIPLY</span><br><span class="line">             <span class="number">82</span> STORE_SUBSCR</span><br><span class="line">             <span class="number">84</span> LOAD_FAST                <span class="number">1</span> (cipher)</span><br><span class="line">             <span class="number">86</span> LOAD_CONST               <span class="number">4</span> (<span class="number">2</span>)</span><br><span class="line">             <span class="number">88</span> LOAD_FAST                <span class="number">3</span> (i)</span><br><span class="line">             <span class="number">90</span> BINARY_MULTIPLY</span><br><span class="line">             <span class="number">92</span> LOAD_CONST               <span class="number">5</span> (<span class="number">1</span>)</span><br><span class="line">             <span class="number">94</span> BINARY_ADD</span><br><span class="line">             <span class="number">96</span> STORE_SUBSCR			<span class="comment">#cipher[2*i], cipher[2*i+1] = cipher[2*i+1], cipher[2*i]</span></span><br><span class="line">             <span class="number">98</span> JUMP_ABSOLUTE           <span class="number">44</span>	</span><br><span class="line">					<span class="comment">#for i in range(length/2):</span></span><br><span class="line">						<span class="comment">#cipher[2*i], cipher[2*i+1] = cipher[2*i+1], cipher[2*i]	</span></span><br><span class="line"></span><br><span class="line"> <span class="number">12</span>     &gt;&gt;  <span class="number">100</span> BUILD_LIST               <span class="number">0</span></span><br><span class="line">            <span class="number">102</span> STORE_FAST               <span class="number">4</span> (res)	<span class="comment">#res = []</span></span><br><span class="line"></span><br><span class="line"> <span class="number">13</span>         <span class="number">104</span> LOAD_GLOBAL              <span class="number">3</span> (range)</span><br><span class="line">            <span class="number">106</span> LOAD_FAST                <span class="number">2</span> (length)</span><br><span class="line">            <span class="number">108</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">            <span class="number">110</span> GET_ITER</span><br><span class="line">        &gt;&gt;  <span class="number">112</span> FOR_ITER                <span class="number">26</span> (to <span class="number">140</span>)</span><br><span class="line">            <span class="number">114</span> STORE_FAST               <span class="number">3</span> (i)		<span class="keyword">for</span> i <span class="keyword">in</span> range(length)</span><br><span class="line"></span><br><span class="line"> <span class="number">14</span>         <span class="number">116</span> LOAD_FAST                <span class="number">4</span> (res)</span><br><span class="line">            <span class="number">118</span> LOAD_METHOD              <span class="number">4</span> (append)</span><br><span class="line">            <span class="number">120</span> LOAD_GLOBAL              <span class="number">5</span> (ord)</span><br><span class="line">            <span class="number">122</span> LOAD_FAST                <span class="number">1</span> (cipher)</span><br><span class="line">            <span class="number">124</span> LOAD_FAST                <span class="number">3</span> (i)</span><br><span class="line">            <span class="number">126</span> BINARY_SUBSCR</span><br><span class="line">            <span class="number">128</span> CALL_FUNCTION            <span class="number">1</span>		</span><br><span class="line">            <span class="number">130</span> LOAD_FAST                <span class="number">3</span> (i)</span><br><span class="line">            <span class="number">132</span> BINARY_XOR</span><br><span class="line">            <span class="number">134</span> CALL_METHOD              <span class="number">1</span>		<span class="comment">#res.append(ord(cipher[i])^i)</span></span><br><span class="line">            <span class="number">136</span> POP_TOP</span><br><span class="line">            <span class="number">138</span> JUMP_ABSOLUTE          <span class="number">112</span></span><br><span class="line"></span><br><span class="line"> <span class="number">15</span>     &gt;&gt;  <span class="number">140</span> LOAD_GLOBAL              <span class="number">6</span> (bytes)</span><br><span class="line">            <span class="number">142</span> LOAD_FAST                <span class="number">4</span> (res)</span><br><span class="line">            <span class="number">144</span> CALL_FUNCTION            <span class="number">1</span></span><br><span class="line">            <span class="number">146</span> LOAD_METHOD              <span class="number">7</span> (hex)</span><br><span class="line">            <span class="number">148</span> CALL_METHOD              <span class="number">0</span></span><br><span class="line">            <span class="number">150</span> STORE_FAST               <span class="number">4</span> (res)	<span class="comment">#res = bytes(res).hex()</span></span><br><span class="line"></span><br><span class="line"> <span class="number">16</span>         <span class="number">152</span> LOAD_GLOBAL              <span class="number">8</span> (<span class="keyword">print</span>)</span><br><span class="line">            <span class="number">154</span> LOAD_CONST               <span class="number">6</span> (<span class="string">'your flag: '</span>)</span><br><span class="line">            <span class="number">156</span> LOAD_FAST                <span class="number">4</span> (res)</span><br><span class="line">            <span class="number">158</span> BINARY_ADD</span><br><span class="line">            <span class="number">160</span> CALL_FUNCTION            <span class="number">1</span>		<span class="comment">#print('your flag: ' + res)</span></span><br><span class="line">            <span class="number">162</span> POP_TOP</span><br><span class="line">            <span class="number">164</span> LOAD_CONST               <span class="number">0</span> (<span class="literal">None</span>)</span><br><span class="line">            <span class="number">166</span> RETURN_VALUE</span><br><span class="line"></span><br><span class="line"><span class="comment"># your flag: 30466633346f59213b4139794520572b45514d61583151576638643a</span></span><br></pre></td></tr></table></figure><p>最后简单逆一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">enc = <span class="string">'30466633346f59213b4139794520572b45514d61583151576638643a'</span></span><br><span class="line">enc = bytes.fromhex(enc)</span><br><span class="line">flag = [b^i <span class="keyword">for</span> b, i <span class="keyword">in</span> enumerate(enc)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(flag)//<span class="number">2</span>):</span><br><span class="line">    flag[<span class="number">2</span>*i], flag[<span class="number">2</span>*i+<span class="number">1</span>] = flag[<span class="number">2</span>*i+<span class="number">1</span>], flag[<span class="number">2</span>*i]</span><br><span class="line">print(<span class="string">''</span>.join(map(chr, flag)))</span><br><span class="line"><span class="comment">#G00dj0&amp;_H3r3-I$Y@Ur_$L@G!~!~</span></span><br></pre></td></tr></table></figure><h3 id="ezApk"><a href="#ezApk" class="headerlink" title="ezApk"></a>ezApk</h3><p>简单的安卓，只有java代码，找到按钮活动。</p><p><img src="https://i.loli.net/2021/02/27/56TDYkbSyOjLNpK.png" alt="image-20210215155612517"></p><p>就是取出文本内容，然后把输入和密文传入s方法，验证是否正确。</p><p>到s方法：一个cbc模式的aes加密，填充方式为PKCS7Padding。</p><p><img src="https://i.loli.net/2021/02/27/hcqCNUm63VFPaZR.png" alt="image-20210215155952276"></p><p>所以解密密文就应该是flag了，使用java用同样的方式调用一下解密方法。这里注意一点就是：java中自带的是PKCS5Padding填充，直接使用PKCS7Padding会报错，但搜索到这2个使用起来是一样的，就直接改成PKCS5Padding就好了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ctf;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidAlgorithmParameterException;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidKeyException;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.BadPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.IllegalBlockSizeException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.NoSuchPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cry</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] hash(String a, String b) <span class="keyword">throws</span> NoSuchAlgorithmException, UnsupportedEncodingException&#123;</span><br><span class="line">		MessageDigest v2 = MessageDigest.getInstance(a);</span><br><span class="line">		<span class="keyword">byte</span>[] v3 = b.getBytes(<span class="string">"UTF-8"</span>);</span><br><span class="line">		<span class="keyword">byte</span>[] ans = v2.digest(v3);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">aes_test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchAlgorithmException, UnsupportedEncodingException, NoSuchPaddingException, InvalidKeyException, InvalidAlgorithmParameterException, IllegalBlockSizeException, BadPaddingException</span>&#123;</span><br><span class="line">		</span><br><span class="line">		String key = <span class="string">"A_HIDDEN_KEY"</span>;</span><br><span class="line">		String input = <span class="string">"EEB23sI1Wd9Gvhvk1sgWyQZhjilnYwCi5au1guzOaIg5dMAj9qPA7lnIyVoPSdRY"</span>;</span><br><span class="line">		Base64.Decoder decoder = Base64.getDecoder();</span><br><span class="line">		<span class="keyword">byte</span>[] enc = decoder.decode(input);</span><br><span class="line">		SecretKeySpec v1 = <span class="keyword">new</span> SecretKeySpec(cry.hash(<span class="string">"SHA-256"</span>, key), <span class="string">"AES"</span>);</span><br><span class="line">		IvParameterSpec v2 = <span class="keyword">new</span> IvParameterSpec(cry.hash(<span class="string">"MD5"</span>, key));</span><br><span class="line">		Cipher v5 = Cipher.getInstance(<span class="string">"AES/CBC/PKCS5Padding"</span>);</span><br><span class="line">		v5.init(<span class="number">2</span>, v1, v2);</span><br><span class="line">		System.out.println(<span class="string">"key: "</span> + byte_hex.bytes2hex(v1.getEncoded()));</span><br><span class="line">		System.out.println(<span class="string">"iv: "</span> + byte_hex.bytes2hex(v2.getIV()));</span><br><span class="line">		<span class="keyword">byte</span>[] plain = v5.doFinal(enc);</span><br><span class="line">		System.out.println(<span class="keyword">new</span> String(plain));</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">key: fca5fed0bc096dbb2f21c64b77a908b5c9944dfcaba05a482b2424a44a15ffe6</span></span><br><span class="line"><span class="comment">iv: 99c6bd34c31b78b4c4b964a7745e6300</span></span><br><span class="line"><span class="comment">hgame&#123;jUst_A_3z4pp_write_in_k07l1n&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>其实也不用这么麻烦的，关键是想练习一下java。</p><p>自己算一下hash得到的key和iv用python或者在线网站解密一下，方便的多。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AesEncry</span><span class="params">(object)</span>:</span></span><br><span class="line">    key = <span class="string">'fca5fed0bc096dbb2f21c64b77a908b5c9944dfcaba05a482b2424a44a15ffe6'</span></span><br><span class="line">    key = bytes.fromhex(key)                            </span><br><span class="line">    </span><br><span class="line">    iv = <span class="string">'99c6bd34c31b78b4c4b964a7745e6300'</span></span><br><span class="line">    iv = bytes.fromhex(iv)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        mode = AES.MODE_ECB</span><br><span class="line">        padding = <span class="keyword">lambda</span> s: s + (<span class="number">16</span> - len(s) % <span class="number">16</span>) * chr(<span class="number">16</span> - len(s) % <span class="number">16</span>)</span><br><span class="line">        cryptos = AES.new(self.key, mode)</span><br><span class="line">        cipher_text = cryptos.encrypt(data)</span><br><span class="line">        <span class="keyword">return</span> cipher_text.hex()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        cryptos = AES.new(self.key, AES.MODE_CBC, self.iv)</span><br><span class="line">        decrpytBytes = base64.b64decode(data)</span><br><span class="line">        plaint = cryptos.decrypt(decrpytBytes)</span><br><span class="line">        <span class="keyword">return</span> plaint</span><br><span class="line"></span><br><span class="line">enc = <span class="string">'EEB23sI1Wd9Gvhvk1sgWyQZhjilnYwCi5au1guzOaIg5dMAj9qPA7lnIyVoPSdRY'</span></span><br><span class="line">flag = AesEncry().decrypt(enc)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><h3 id="helloRe2"><a href="#helloRe2" class="headerlink" title="helloRe2"></a>helloRe2</h3><p>首先输入pass1的逻辑，转化一个128位的大数与指定大数比较，然后以挂起创建自身进程的子进程，调用CreateFileMappingA()函数把文件映像到内存，再使用MapViewOfFile()函数把文件视映像到进程地址空间上（用于把当前进程的内存空间的数据与子进程共享），然后在非调试状态下对要共享的数据简单的异或加密一下，最后恢复启动刚刚创建的子进程，自身进程睡眠挂起：</p><p><img src="https://i.loli.net/2021/02/27/kRrY7a6meKp59Pz.png" alt="image-20210215190636690"></p><p>子进程启动后，调用OpenFileMappingA()与MapViewOfFile()查看父进程共享的内存数据，若存在则调用输入pass2的逻辑，然后一个cbc模式的aes加密。</p><p><img src="https://i.loli.net/2021/02/27/Gna2KV58FQRH7oc.png" alt="image-20210215191030835"></p><p>使用python解密一下得到pass2：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">key = <span class="string">b'2b0c5e6a3a20b189'</span></span><br><span class="line">key = [key[i]^i <span class="keyword">for</span> i <span class="keyword">in</span> range(len(key))]</span><br><span class="line">key = bytes(key)</span><br><span class="line"><span class="comment">#key = bytes.fromhex(key)                            </span></span><br><span class="line"></span><br><span class="line">iv = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]</span><br><span class="line">iv = bytes(iv)</span><br><span class="line"><span class="comment">#iv = bytes.fromhex(iv)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(data)</span>:</span></span><br><span class="line">    mode = AES.MODE_ECB</span><br><span class="line">    padding = <span class="keyword">lambda</span> s: s + (<span class="number">16</span> - len(s) % <span class="number">16</span>) * chr(<span class="number">16</span> - len(s) % <span class="number">16</span>)</span><br><span class="line">    cryptos = AES.new(self.key, mode)</span><br><span class="line">    cipher_text = cryptos.encrypt(data)</span><br><span class="line">    <span class="keyword">return</span> cipher_text.hex()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(data)</span>:</span></span><br><span class="line">    cryptos = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    decrpytBytes = base64.b64decode(data)</span><br><span class="line">    plaint = cryptos.decrypt(decrpytBytes)</span><br><span class="line">    <span class="keyword">return</span> plaint</span><br><span class="line"></span><br><span class="line">enc = <span class="string">'t/7+2Qd2eWU/Tl9i1QL2fg=='</span></span><br><span class="line">flag = decrypt(enc)</span><br><span class="line">print(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#7a4ad6c5671fb313</span></span><br></pre></td></tr></table></figure><p>最后：<strong>hgame{2b0c5e6a3a20b189_7a4ad6c5671fb313}</strong></p><h3 id="fake-debugger-beta"><a href="#fake-debugger-beta" class="headerlink" title="fake_debugger beta"></a>fake_debugger beta</h3><p>nc连上后，空格加回车进行单步调试。</p><p>容易发现，是对输入一位一位的异或加密后与指定值比较，不对则退出。</p><p><img src="https://i.loli.net/2021/02/27/SMEapnGisTgZIWl.png" alt="image-20210216180859920"></p><p>开始的格式是知道的，所以后面一位一位慢慢的跟一下就好了。</p><p><strong>hgame{You_Kn0w_debuGg3r}</strong></p><h3 id="gun"><a href="#gun" class="headerlink" title="gun"></a>gun</h3><p>jadx反编译后没有发现MainActivity，但从几个特征可以知道app进行梆梆加固免费版进行加固。</p><p><img src="https://i.loli.net/2021/02/27/3xWMP72bsnJ89qe.png" alt="image-20210227105625088"></p><p>我们的目的主要是得到解密后的关键dex分析MainActivity，所以可以直接考虑用frida-dumpdex来dump出内存中的dex。项目地址：<a href="https://github.com/hluwa/FRIDA-DEXDump" target="_blank" rel="noopener">https://github.com/hluwa/FRIDA-DEXDump</a></p><p>搭建frida环境时注意一点：安装的frida的版本要和服务端安装的frida-server版本要一致。</p><p>dump出dex后从到小的拖进jeb中反编译，0xbf03a000.dex是我们要找的。</p><p>可以看到，创建了多个线程进行操作。</p><p><img src="https://i.loli.net/2021/02/27/r6JaDQfPuLT7qCH.png" alt="image-20210227111613020"></p><p>看一下功能：</p><p><img src="https://i.loli.net/2021/02/27/johwg4l5qzErmNb.png" alt="image-20210227111754345"></p><p>继续看fd.i方法：</p><p><img src="https://i.loli.net/2021/02/27/ZiAxb93RSNz7Foa.png" alt="image-20210227112014590"></p><p>到这里基本上就可以知道，是开启多个线程进行发送数据，然后每个线程有不同的睡眠时间，这就有了先后顺序。</p><p>我是直接把所有数据按时间建立关系后，打印出来。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> a[<span class="number">0xfffffff</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	a[<span class="number">19530</span>] = <span class="string">'q'</span>, a[<span class="number">0x75F4</span>] = <span class="string">'e'</span>, a[<span class="number">0xA161</span>] = <span class="string">'d'</span>, a[<span class="number">7337</span>] = <span class="string">'f'</span>;</span><br><span class="line">	a[<span class="number">0x5B0D</span>] = <span class="string">'e'</span>, a[<span class="number">0xC266</span>] = <span class="string">'x'</span>, a[<span class="number">0x887F</span>] = <span class="string">'q'</span>, a[<span class="number">50475</span>] = <span class="string">'u'</span>;</span><br><span class="line">	a[<span class="number">0xC05D</span>] = <span class="string">'a'</span>, a[<span class="number">0x909B</span>] = <span class="string">'u'</span>, a[<span class="number">8488</span>] = <span class="string">'a'</span>, a[<span class="number">0xC1CF</span>] = <span class="string">'r'</span>;</span><br><span class="line">	a[<span class="number">78545</span>] = <span class="string">'0'</span>, a[<span class="number">0x4B4C</span>] = <span class="string">'t'</span>, a[<span class="number">0xC807</span>] = <span class="string">'q'</span>, a[<span class="number">0x8C9B</span>] = <span class="string">'q'</span>;</span><br><span class="line">	a[<span class="number">0xB2B3</span>] = <span class="string">'k'</span>, a[<span class="number">2390</span>] = <span class="string">'z'</span>, a[<span class="number">0x568B</span>] = <span class="string">' '</span>, a[<span class="number">70963</span>] = <span class="string">'y'</span>;</span><br><span class="line">	a[<span class="number">0xAF2B</span>] = <span class="string">' '</span>, a[<span class="number">0x397B</span>] = <span class="string">'d'</span>, a[<span class="number">10110</span>] = <span class="string">' '</span>, a[<span class="number">0xFE0D</span>] = <span class="string">'t'</span>;</span><br><span class="line">	a[<span class="number">0x33DE</span>] = <span class="string">'q'</span>, a[<span class="number">0xE105</span>] = <span class="string">' '</span>, a[<span class="number">40315</span>] = <span class="string">'b'</span>, a[<span class="number">79438</span>] = <span class="string">'d'</span>;</span><br><span class="line">	a[<span class="number">0x54C2</span>] = <span class="string">'e'</span>, a[<span class="number">0xD115</span>] = <span class="string">'y'</span>, a[<span class="number">0x84B9</span>] = <span class="string">'x'</span>, a[<span class="number">0xE4B4</span>] = <span class="string">'q'</span>;</span><br><span class="line">	a[<span class="number">28084</span>] = <span class="string">'f'</span>, a[<span class="number">83607</span>] = <span class="string">'&#125;'</span>, a[<span class="number">0x312F</span>] = <span class="string">'e'</span>, a[<span class="number">0x142F0</span>] = <span class="string">'d'</span>;</span><br><span class="line">	a[<span class="number">50828</span>] = <span class="string">'z'</span>, a[<span class="number">79540</span>] = <span class="string">'_'</span>, a[<span class="number">60636</span>] = <span class="string">'m'</span>, a[<span class="number">20891</span>] = <span class="string">'b'</span>;</span><br><span class="line">	a[<span class="number">0x41D8</span>] = <span class="string">'a'</span>, a[<span class="number">0x18FC</span>] = <span class="string">'m'</span>, a[<span class="number">0xE91A</span>] = <span class="string">'r'</span>, a[<span class="number">0x13F0F</span>] = <span class="string">'I'</span>;</span><br><span class="line">	a[<span class="number">0x70B8</span>] = <span class="string">'t'</span>, a[<span class="number">4741</span>] = <span class="string">'m'</span>, a[<span class="number">30778</span>] = <span class="string">' '</span>, a[<span class="number">0xEFA</span>] = <span class="string">'g'</span>;</span><br><span class="line">	a[<span class="number">11980</span>] = <span class="string">'q'</span>, a[<span class="number">5130</span>] = <span class="string">'p'</span>, a[<span class="number">0x7F0</span>] = <span class="string">'a'</span>, a[<span class="number">0x13FA7</span>] = <span class="string">'0'</span>;</span><br><span class="line">	a[<span class="number">0x4127</span>] = <span class="string">' '</span>, a[<span class="number">0x10D66</span>] = <span class="string">'Q'</span>, a[<span class="number">0x54A</span>] = <span class="string">'O'</span>, a[<span class="number">0xDBA0</span>] = <span class="string">'s'</span>;</span><br><span class="line">	a[<span class="number">0x10EE1</span>] = <span class="string">'h'</span>, a[<span class="number">70302</span>] = <span class="string">'x'</span>, a[<span class="number">0x11C08</span>] = <span class="string">'n'</span>, a[<span class="number">0x4831</span>] = <span class="string">' '</span>;</span><br><span class="line">	a[<span class="number">0xE33C</span>] = <span class="string">'t'</span>, a[<span class="number">0xFAF4</span>] = <span class="string">' '</span>, a[<span class="number">80538</span>] = <span class="string">'i'</span>, a[<span class="number">0xF4E1</span>] = <span class="string">'u'</span>;</span><br><span class="line">	a[<span class="number">22890</span>] = <span class="string">'u'</span>, a[<span class="number">0x803B</span>] = <span class="string">'m'</span>, a[<span class="number">0x655B</span>] = <span class="string">'d'</span>, a[<span class="number">0xDC3A</span>] = <span class="string">'z'</span>;</span><br><span class="line">	a[<span class="number">0x3599</span>] = <span class="string">'o'</span>, a[<span class="number">44072</span>] = <span class="string">'k'</span>, a[<span class="number">0xB205</span>] = <span class="string">'N'</span>, a[<span class="number">0xBB43</span>] = <span class="string">'F'</span>;</span><br><span class="line">	a[<span class="number">80939</span>] = <span class="string">'7'</span>, a[<span class="number">0x3F07</span>] = <span class="string">'f'</span>, a[<span class="number">52068</span>] = <span class="string">'o'</span>, a[<span class="number">0xCAA2</span>] = <span class="string">' '</span>;</span><br><span class="line">	a[<span class="number">72519</span>] = <span class="string">'_'</span>, a[<span class="number">0x11F52</span>] = <span class="string">'k'</span>, a[<span class="number">0x3CA5</span>] = <span class="string">'q'</span>, a[<span class="number">75894</span>] = <span class="string">'F'</span>;</span><br><span class="line">	a[<span class="number">0xF723</span>] = <span class="string">'e'</span>, a[<span class="number">0x7221</span>] = <span class="string">'u'</span>, a[<span class="number">0x2FCD</span>] = <span class="string">' '</span>, a[<span class="number">3501</span>] = <span class="string">'d'</span>;</span><br><span class="line">	a[<span class="number">0x9168</span>] = <span class="string">'e'</span>, a[<span class="number">0x8DC6</span>] = <span class="string">' '</span>, a[<span class="number">0x100CF</span>] = <span class="string">'s'</span>, a[<span class="number">0xCD51</span>] = <span class="string">'m'</span>;</span><br><span class="line">	a[<span class="number">0x10B56</span>] = <span class="string">'d'</span>, a[<span class="number">0x6ABD</span>] = <span class="string">' '</span>, a[<span class="number">0x103F7</span>] = <span class="string">'y'</span>, a[<span class="number">60485</span>] = <span class="string">'x'</span>;</span><br><span class="line">	a[<span class="number">0x9589</span>] = <span class="string">'u'</span>, a[<span class="number">0x1105E</span>] = <span class="string">'3'</span>, a[<span class="number">54002</span>] = <span class="string">'b'</span>, a[<span class="number">0x12C3F</span>] = <span class="string">'1'</span>;</span><br><span class="line">	a[<span class="number">0x6750</span>] = <span class="string">','</span>, a[<span class="number">0xBFCB</span>] = <span class="string">' '</span>, a[<span class="number">70562</span>] = <span class="string">'_'</span>, a[<span class="number">0xE66F</span>] = <span class="string">' '</span>;</span><br><span class="line">	a[<span class="number">47203</span>] = <span class="string">'q'</span>, a[<span class="number">0x4994</span>] = <span class="string">'f'</span>, a[<span class="number">0xF098</span>] = <span class="string">'s'</span>, a[<span class="number">0xC131</span>] = <span class="string">'r'</span>;</span><br><span class="line">	a[<span class="number">0x16FB</span>] = <span class="string">'g'</span>, a[<span class="number">74919</span>] = <span class="string">'z'</span>, a[<span class="number">0xA96B</span>] = <span class="string">' '</span>, a[<span class="number">0x4558</span>] = <span class="string">'r'</span>;</span><br><span class="line">	a[<span class="number">0x222F</span>] = <span class="string">'z'</span>, a[<span class="number">0xAAD0</span>] = <span class="string">'n'</span>, a[<span class="number">0x9841</span>] = <span class="string">'z'</span>, a[<span class="number">71894</span>] = <span class="string">'3'</span>;</span><br><span class="line">	a[<span class="number">0x8AF0</span>] = <span class="string">'s'</span>, a[<span class="number">0x2BFF</span>] = <span class="string">'t'</span>, a[<span class="number">0x525F</span>] = <span class="string">'b'</span>, a[<span class="number">0x9995</span>] = <span class="string">'e'</span>;</span><br><span class="line">	a[<span class="number">68035</span>] = <span class="string">'&#123;'</span>, a[<span class="number">0xA375</span>] = <span class="string">'q'</span>, a[<span class="number">10949</span>] = <span class="string">'f'</span>, a[<span class="number">0x63DD</span>] = <span class="string">'q'</span>;</span><br><span class="line">	a[<span class="number">0xA621</span>] = <span class="string">'p'</span>, a[<span class="number">78398</span>] = <span class="string">'_'</span>, a[<span class="number">0x10780</span>] = <span class="string">'q'</span>, a[<span class="number">0x609E</span>] = <span class="string">'t'</span>;</span><br><span class="line">	a[<span class="number">9603</span>] = <span class="string">'!'</span>, a[<span class="number">0x7E5F</span>] = <span class="string">'t'</span>, a[<span class="number">0x83C0</span>] = <span class="string">'x'</span>, a[<span class="number">0x8A6D</span>] = <span class="string">'z'</span>;</span><br><span class="line">	a[<span class="number">0x1309A</span>] = <span class="string">'3'</span>, a[<span class="number">0xB8F4</span>] = <span class="string">'O'</span>, a[<span class="number">54430</span>] = <span class="string">'m'</span>, a[<span class="number">0x143CF</span>] = <span class="string">'w'</span>;</span><br><span class="line">	a[<span class="number">40499</span>] = <span class="string">'u'</span>, a[<span class="number">0xD882</span>] = <span class="string">'u'</span>, a[<span class="number">0xB5DB</span>] = <span class="string">'f'</span>, a[<span class="number">0x931B</span>] = <span class="string">' '</span>;</span><br><span class="line">	a[<span class="number">0x1FB0</span>] = <span class="string">'u'</span>, a[<span class="number">0xF2F2</span>] = <span class="string">' '</span>, a[<span class="number">0x5031</span>] = <span class="string">'m'</span>, a[<span class="number">0x12720</span>] = <span class="string">'4'</span>;</span><br><span class="line">	a[<span class="number">0x6649</span>] = <span class="string">'q'</span>, a[<span class="number">0xBCA1</span>] = <span class="string">'R'</span>, a[<span class="number">24004</span>] = <span class="string">' '</span>, a[<span class="number">0x10180</span>] = <span class="string">'m'</span>;</span><br><span class="line">	a[<span class="number">77170</span>] = <span class="string">'h'</span>, a[<span class="number">0x7B3C</span>] = <span class="string">'o'</span>, a[<span class="number">3019</span>] = <span class="string">'s'</span>, a[<span class="number">20120</span>] = <span class="string">' '</span>;</span><br><span class="line">	a[<span class="number">74113</span>] = <span class="string">'_'</span>, a[<span class="number">0xDD23</span>] = <span class="string">','</span>, a[<span class="number">58044</span>] = <span class="string">'f'</span>, a[<span class="number">79659</span>] = <span class="string">'z'</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">0xfffffff</span>; i++)</span><br><span class="line">		<span class="keyword">if</span>(a[i])</span><br><span class="line">			<span class="built_in">putchar</span>(a[i]);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到<strong>Oazsdgmpgmfuaz! ftq eqodqf ar ftq mbbe ue tqdq, ftue otmxxqzsq ue uzebudqp nk NkfqOFR arrxuzq omybmusz, ftq rxms ue tsmyq{dQh3x_y3_nk_z4F1h3_0d_zi7I0dw}</strong>，可以看到最后和flag的格式是一样的了，字符数都是一样的，整个字符串的特征猜测凯撒加密。</p><p>从位移12得到结果：</p><p><img src="https://i.loli.net/2021/02/27/ruso9GQJk7PqxYE.png" alt="image-20210227112643799"></p><h3 id="FAKE"><a href="#FAKE" class="headerlink" title="FAKE"></a>FAKE</h3><p>开始没注意，以为就是考下z3的使用，且题目中有提示：<strong>Try angr or z3.</strong>，上来就把36个方程组去写z3，没有发现解。。也可能是我的约束条件写错了。。</p><p>之后注意到题目名字fake，进而看了看程序，发现一个获取TracerPid的反调试和紧接着的smc：</p><p><img src="https://i.loli.net/2021/02/27/UxcMZYkvEy4TsDh.png" alt="image-20210217162653310"></p><p>自己查看一下非调试运行时的状态：<br><img src="https://i.loli.net/2021/02/27/rS7LQ2zW3DjHcZx.png" alt="image-20210217162839393"></p><p>使用idapython或调试到smc后的代码，其实就是2个矩阵的乘法：</p><p><img src="https://i.loli.net/2021/02/27/VhjmxeSoF9OPayk.png" alt="image-20210217163037584"></p><p>先z3解一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line">flag = [BitVec(<span class="string">'flag[%d]'</span>%i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">36</span>)]</span><br><span class="line"></span><br><span class="line">a = [<span class="number">104</span>, <span class="number">103</span>, <span class="number">97</span>, <span class="number">109</span>, <span class="number">101</span>, <span class="number">123</span>, <span class="number">64</span>, <span class="number">95</span>, <span class="number">70</span>, <span class="number">65</span>, <span class="number">75</span>, <span class="number">69</span>, <span class="number">95</span>, <span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">33</span>, <span class="number">45</span>, <span class="number">100</span>, <span class="number">111</span>, <span class="number">95</span>, <span class="number">89</span>, <span class="number">48</span>, <span class="number">117</span>, <span class="number">95</span>, <span class="number">107</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">119</span>, <span class="number">95</span>, <span class="number">83</span>, <span class="number">77</span>, <span class="number">67</span>, <span class="number">63</span>, <span class="number">125</span>]</span><br><span class="line"></span><br><span class="line">b = [<span class="number">55030</span>, <span class="number">61095</span>, <span class="number">60151</span>, <span class="number">57247</span>, <span class="number">56780</span>, <span class="number">55726</span>, <span class="number">46642</span>, <span class="number">52931</span>, <span class="number">53580</span>, <span class="number">50437</span>, <span class="number">50062</span>, <span class="number">44186</span>, <span class="number">44909</span>, <span class="number">46490</span>, <span class="number">46024</span>, <span class="number">44347</span>, <span class="number">43850</span>, <span class="number">44368</span>, <span class="number">54990</span>, <span class="number">61884</span>, <span class="number">61202</span>, <span class="number">58139</span>, <span class="number">57730</span>, <span class="number">54964</span>, <span class="number">48849</span>, <span class="number">51026</span>, <span class="number">49629</span>, <span class="number">48219</span>, <span class="number">47904</span>, <span class="number">50823</span>, <span class="number">46596</span>, <span class="number">50517</span>, <span class="number">48421</span>, <span class="number">46143</span>, <span class="number">46102</span>, <span class="number">46744</span>]</span><br><span class="line">ans = [<span class="number">0</span>]*<span class="number">36</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">		<span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">			ans[<span class="number">6</span>*i+j] += a[<span class="number">6</span>*k+j] * flag[<span class="number">6</span>*i+k]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">		s.add(b[<span class="number">6</span>*i+j] == ans[<span class="number">6</span>*i+j])</span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">	flag = [s.model()[i].as_long() <span class="keyword">for</span> i <span class="keyword">in</span> flag]</span><br><span class="line">	print(bytes(flag))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"unsat"</span>)</span><br><span class="line"><span class="comment">#hgame&#123;E@sy_Se1f-Modifying_C0oodee33&#125;</span></span><br></pre></td></tr></table></figure><p>再使用sage求解看，实质就是先求得一个逆矩阵然后与enc组成的矩阵做乘法。</p><p><img src="https://i.loli.net/2021/02/27/hPdyLxSuDFpTRZE.png" alt="image-20210217163948621"></p><h3 id="helloRe3"><a href="#helloRe3" class="headerlink" title="helloRe3"></a>helloRe3</h3><p>一血。</p><p>开始每管题目的提示信息，直接静态分析了下，看见创建了一个线程，后面开始注册窗口各种操作，然后越看越复杂，定位到这个函数，有iv，key和加密解密操作，从常量识别出是tea类的加密算法？但这个也无从下手，程序中好像没调用这里。。。</p><p><img src="https://i.loli.net/2021/02/27/gdX7jNlDYhB2fJv.png" alt="image-20210217164757847"></p><p>嗯，，回到题目开始看提示信息：开发者留下了调试信息，试试DbgView。就试试吧。</p><p>可以发现，每次输入都会输出相应的响应：</p><p><img src="https://i.loli.net/2021/02/27/6AUTcPakH9fLeiq.png" alt="image-20210217165042094"></p><p>这里我直接去定位input length，因为之前静态分析时看见过。</p><p><img src="https://i.loli.net/2021/02/27/vicGJT4f5utmgY9.png" alt="image-20210217165253173"></p><p>其实上面这个整个函数就是关键了，简单看下汇编，结合DbgView。</p><p>输入长度为20，每一位先和0xff进行异或运算，最后来个rc4加密再和密文比较。<strong>注意：输入的是每个字符的order值，从DbgView可以查看。</strong></p><p>我直接附加调试得到内存信息，然后idapython得到order值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ida_bytes <span class="keyword">import</span> *</span><br><span class="line">addr = <span class="number">0x7FF7E35B5820</span></span><br><span class="line">addr1 = <span class="number">0x07FF7E35A3720</span></span><br><span class="line">flag = []</span><br><span class="line">s = [<span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>]</span><br><span class="line">s = [i^<span class="number">0xff</span> <span class="keyword">for</span> i <span class="keyword">in</span> s]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    flag += [(s[i]^get_byte(addr) ^ get_byte(addr1)) ^<span class="number">0xff</span>]</span><br><span class="line">    addr += <span class="number">1</span></span><br><span class="line">    addr1 += <span class="number">1</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>最后用C语言写一个置表得到输入。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; </span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[] = &#123;<span class="number">59</span>, <span class="number">58</span>, <span class="number">54</span>, <span class="number">72</span>, <span class="number">39</span>, <span class="number">47</span>, <span class="number">26</span>, <span class="number">31</span>,</span><br><span class="line">			 <span class="number">61</span>, <span class="number">24</span>, <span class="number">61</span>, <span class="number">74</span>, <span class="number">24</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">23</span>,</span><br><span class="line">			  <span class="number">68</span>, <span class="number">24</span>, <span class="number">41</span>, <span class="number">48</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> b[<span class="number">1000</span>];</span><br><span class="line"><span class="keyword">char</span> s1[] = <span class="string">"1234567890-+"</span>;</span><br><span class="line"><span class="keyword">char</span> s2[] = <span class="string">"QWERTYUIOP&#123;&#125;|"</span>;</span><br><span class="line"><span class="keyword">char</span> s3[] = <span class="string">"ASDFGHJKL;'"</span>;</span><br><span class="line"><span class="keyword">char</span> s4[] = <span class="string">"ZXCVBNM,./"</span>;</span><br><span class="line"><span class="keyword">char</span> flag[<span class="number">50</span>];</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">21</span>; i &lt;= <span class="number">32</span>; i++)</span><br><span class="line">		b[i] = s1[j++];</span><br><span class="line">	j = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">37</span>; i &lt;= <span class="number">49</span>; i++)</span><br><span class="line">		b[i] = s2[j++];</span><br><span class="line">	j = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">54</span>; i &lt;= <span class="number">64</span>; i++)</span><br><span class="line">		b[i] = s3[j++];</span><br><span class="line">	j = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">66</span>; i &lt;= <span class="number">75</span>; i++)</span><br><span class="line">		b[i] = s4[j++];</span><br><span class="line">	j = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++)</span><br><span class="line">		flag[i] = b[a[i]];</span><br><span class="line">		</span><br><span class="line">	<span class="built_in">puts</span>(flag);</span><br><span class="line">	</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//HGAME&#123;6-K4K.4R+3C4T&#125;</span></span><br></pre></td></tr></table></figure><h3 id="vm"><a href="#vm" class="headerlink" title="vm"></a>vm</h3><p>二血。</p><p>一个简单的vm，调试跟踪得到先是找到输入的最后一位，开始从后向前进行指定值的异或运算，紧接着一轮从后向前的减法运算。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> enc[] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">207</span>, <span class="number">191</span>, <span class="number">128</span>,  <span class="number">59</span>, <span class="number">246</span>, <span class="number">175</span>, <span class="number">126</span>,   <span class="number">2</span>,  <span class="number">36</span>, <span class="number">237</span>, </span><br><span class="line">  <span class="number">112</span>,  <span class="number">58</span>, <span class="number">244</span>, <span class="number">235</span>, <span class="number">122</span>,  <span class="number">74</span>, <span class="number">231</span>, <span class="number">247</span>, <span class="number">162</span>, <span class="number">103</span>, </span><br><span class="line">   <span class="number">23</span>, <span class="number">240</span>, <span class="number">198</span>, <span class="number">118</span>,  <span class="number">54</span>, <span class="number">232</span>, <span class="number">173</span>, <span class="number">130</span>,  <span class="number">46</span>, <span class="number">219</span>, </span><br><span class="line">  <span class="number">183</span>,  <span class="number">79</span>, <span class="number">230</span>,   <span class="number">9</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> a = <span class="number">0xfe</span>, b = <span class="number">0x7a</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">33</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		enc[i] += b;</span><br><span class="line">		b -= <span class="number">0x60</span>;</span><br><span class="line">		enc[i] ^= a;</span><br><span class="line">		a += <span class="number">0x23</span>;	 </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">34</span>; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%c"</span>, enc[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="A-5-Second-Challenge"><a href="#A-5-Second-Challenge" class="headerlink" title="A 5 Second Challenge"></a>A 5 Second Challenge</h3><p>一个扫雷游戏，第一步操作后，如果后面时间超过5s的话游戏结束。这个修改下系统时间就解除了。</p><p>找到关键数据文件夹：</p><p><img src="https://i.loli.net/2021/02/27/oezlBwiY5mTZuOA.png" alt="image-20210227114208257"></p><p>反编译AFiveSecondChallenge.dll：看到获取当前系统的时间，检查是否超时的函数，题目描述的一样，对dll做了手脚，也是<strong>CheckBomAt</strong>这个函数，最后有很多数据，从数量可以猜测对应我们题目中的45*45的格子。</p><p><img src="https://i.loli.net/2021/02/27/CyHbQdXat52eZkR.png" alt="image-20210227114516330"></p><p>现在目的就是找<strong>CheckBomAt</strong>函数，开始想的是可能有办法修复这个dll，搜索一番没有结果。</p><p>转到刚刚那个文件夹的，发现2个关键cpp文件：AFiveSecondChallenge.cpp，Assembly-CSharp.cpp。</p><p>在AFiveSecondChallenge.cpp中发现反编译不出来的函数：从名字可以很好识别其功能，开始做一个超时检查，如果没超时取出matrix中的数据做一个运算后判断。</p><p><img src="https://i.loli.net/2021/02/27/NdvUQpMXrFontj9.png" alt="image-20210227120034686"></p><p>然后从Assembly-CSharp.cpp中看到了整个游戏逻辑。注释相当于把源码都给了吧，真好。</p><p>捕捉鼠标点击后，开始进行各种判断。</p><p><img src="https://i.loli.net/2021/02/27/4rOwLYtVzcUlDmf.png" alt="image-20210227120525813"></p><p>计算周围的雷数，就是判断8个方向，也可以看出返回值为0代表不是雷：</p><p><img src="https://i.loli.net/2021/02/27/e9vF4mky3D5oiHp.png" alt="image-20210227122637114"></p><p>点击后，根据是雷或者不是雷填充对应的色块：</p><p><img src="https://i.loli.net/2021/02/27/kB8jiNXfsgQzJ4H.png" alt="image-20210227122902913"></p><p>如果点击块周围没有雷，则递归的向四个方向扩展开来：</p><p><img src="https://i.loli.net/2021/02/27/gD1dcpLSm9QAvo2.png" alt="image-20210227123011364"></p><p>分析到这里想找最后胜利的判断条件以此看flag怎么来的，好像没有，。。</p><p>到这里知道了关键就是判断一个块是否是雷的函数<strong>CheckBomAt</strong>，按照题目的算法打印出雷的位置，1表示雷。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> a[<span class="number">45</span>][<span class="number">15</span>][<span class="number">3</span>] = &#123;游戏中的数据&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> ans;</span><br><span class="line">	<span class="keyword">double</span> a_, b_, c_, d_;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>, bomb[<span class="number">45</span>][<span class="number">45</span>];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">45</span>; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">45</span>; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			a_ = a[j][i/<span class="number">3</span>][<span class="number">0</span>];</span><br><span class="line">			b_ = a[j][i/<span class="number">3</span>][<span class="number">1</span>];</span><br><span class="line">			c_ = a[j][i/<span class="number">3</span>][<span class="number">2</span>];</span><br><span class="line">			d_ = (<span class="keyword">double</span>)(i%<span class="number">3</span> - <span class="number">1.0</span>);</span><br><span class="line">			ans = (a_*d_*d_ + b_*d_) + c_;</span><br><span class="line">			bomb[j][i] = ans &gt; <span class="number">0.0</span> ? <span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">45</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">45</span>; j++)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%d "</span>, bomb[i][j]);</span><br><span class="line">		<span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用这个数据玩了一下游戏，但是有的地方和算出的雷的位置不一致，大多数还是一样的。。然后一直找是不是哪里算错了，算法也比对了好几次。。就把题放一边了。</p><p>后面看见题目给出提示，二维码，看了看我之前打印的数据。。。</p><p><img src="https://i.loli.net/2021/02/27/iQqyeAYgFaJVoMc.png" alt="image-20210227020942288"></p><p>使用python的PIL模块用这个数据打印出二维码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">x = <span class="number">45</span></span><br><span class="line">y = <span class="number">45</span></span><br><span class="line"></span><br><span class="line">im = Image.new(<span class="string">'RGB'</span>, (x, y))</span><br><span class="line">data = <span class="string">'111111100011101111100101000001110100101111111100000100001011111010001110100011001001000001101110101110100100000100111010100101001011101101110101101010111001001001001111101101011101101110101110001100101111111011101111101011101100000101011000100101000100011111000001000001111111101010101010101010101010101010101111111000000001100001101111000111101010000100000000101111100001111010101111111000000000101111100000100010001011011110010110001010001010000001000101111000011001000111010110100010011001110010100001000010001111010011000100111000001100100110101111100101101101010101110010010101001010001011101001011011101100000101101110000110010000111101101001010000100101110010010101100101111011101101110000101111101101101000100110110100101000010101010000101010100001110011100000010001001001000100010111111101101100111000011110100010000010100111000011011001010010011000001010101101011111000000101010011011011001011111111100110100101111110001000110111110111111110001100000011111000100011110010100011101001010101001011101011010110010000101101011010101110001100001010011000110010100011100011100001111111101110011011111110001111110111110001111110011111001100101101000010101001001101001100100110100111010001011001011111111011110010010011001000011110111111111101001000100011111011001111110011100011010101010010100001111000011011011001000001000100011111010000111001000100100101001100110001101100010111110010000011011101010111101010100000100001101011010011001110011100010111111000101110101110110010100111001110010111010001101000100001110010100010110000010111111000000010010110100110101110111100011110011101001101111111011001100100011010110100110100011100010011111101000111000111111100000000001110101000011000111001101101100010100111111100101011000101010100000011000101011110100000101100000110101000111001010110100011111101110101111001110001111110000000101111110000101110101111010011010010010011010001111001111101110101110100010000101010010100100101101100100000100111010110100001100000101111111001100111111101000101001110100110101100000100100010'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, x):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, y):</span><br><span class="line">        line = data[i*x+j]</span><br><span class="line">        <span class="keyword">if</span> line == <span class="string">'1'</span>:</span><br><span class="line">            im.putpixel((i, j), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            im.putpixel((i, j), (<span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>))</span><br><span class="line">im.show()</span><br></pre></td></tr></table></figure><p>扫一下得到flag：<strong>hgame{YOU<del>hEn-duO_yOU-X|</del>DOU-sHi<del>un1Ty</del>k4i-fA_de_O}</strong></p><h3 id="nllvm"><a href="#nllvm" class="headerlink" title="nllvm"></a>nllvm</h3><p>一血。</p><p>通过这个题学习熟悉下AES加密算法还是不错的。</p><p>首先看一下main函数：先设置控制台显示文本的属性，接着可以看到很多异或运算，这些数据在要使用后同样做了相同的异或运算，所以简单隐藏了下程序中的数据。</p><p><img src="https://i.loli.net/2021/02/27/p7NOiGZoXHwMrKW.png" alt="image-20210223230432003"></p><p>找到加密的地方，开始静态看了一下整个加密流程，只是注意到很多异或运算也不复杂，在一个置位的地方发现加密后的一个aes的s-box。</p><p>确定aes加密后，又进而发现是带有iv的。</p><p><img src="https://i.loli.net/2021/02/27/cpix3L91BESXuGe.png" alt="image-20210223231923153"></p><p>再梳理了一下这里的加密流程：</p><p><img src="https://i.loli.net/2021/02/27/WRM9vQi1HZD8O7e.png" alt="image-20210223233754450"></p><p>可以从重复轮进行了13次可以知道key是256位的，但块长度是128位的。。之前一直以为密钥长度和块长度是一样的。又加上这里移位和混合的方向和我之前了解的正好相反，就感觉是魔改过的aes加密，开始用C自己写逆过程，关键就是行混合不好写，还好有搜索，hh。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> rsbox[<span class="number">256</span>] = &#123;</span><br><span class="line">  <span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6a</span>, <span class="number">0xd5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xa5</span>, <span class="number">0x38</span>, <span class="number">0xbf</span>, <span class="number">0x40</span>, <span class="number">0xa3</span>, <span class="number">0x9e</span>, <span class="number">0x81</span>, <span class="number">0xf3</span>, <span class="number">0xd7</span>, <span class="number">0xfb</span>,</span><br><span class="line">  <span class="number">0x7c</span>, <span class="number">0xe3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9b</span>, <span class="number">0x2f</span>, <span class="number">0xff</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8e</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xe9</span>, <span class="number">0xcb</span>,</span><br><span class="line">  <span class="number">0x54</span>, <span class="number">0x7b</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xa6</span>, <span class="number">0xc2</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>, <span class="number">0xee</span>, <span class="number">0x4c</span>, <span class="number">0x95</span>, <span class="number">0x0b</span>, <span class="number">0x42</span>, <span class="number">0xfa</span>, <span class="number">0xc3</span>, <span class="number">0x4e</span>,</span><br><span class="line">  <span class="number">0x08</span>, <span class="number">0x2e</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0xb2</span>, <span class="number">0x76</span>, <span class="number">0x5b</span>, <span class="number">0xa2</span>, <span class="number">0x49</span>, <span class="number">0x6d</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0x25</span>,</span><br><span class="line">  <span class="number">0x72</span>, <span class="number">0xf8</span>, <span class="number">0xf6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0x5c</span>, <span class="number">0xcc</span>, <span class="number">0x5d</span>, <span class="number">0x65</span>, <span class="number">0xb6</span>, <span class="number">0x92</span>,</span><br><span class="line">  <span class="number">0x6c</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xfd</span>, <span class="number">0xed</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>, <span class="number">0x5e</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xa7</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0x84</span>,</span><br><span class="line">  <span class="number">0x90</span>, <span class="number">0xd8</span>, <span class="number">0xab</span>, <span class="number">0x00</span>, <span class="number">0x8c</span>, <span class="number">0xbc</span>, <span class="number">0xd3</span>, <span class="number">0x0a</span>, <span class="number">0xf7</span>, <span class="number">0xe4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xb8</span>, <span class="number">0xb3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">  <span class="number">0xd0</span>, <span class="number">0x2c</span>, <span class="number">0x1e</span>, <span class="number">0x8f</span>, <span class="number">0xca</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x02</span>, <span class="number">0xc1</span>, <span class="number">0xaf</span>, <span class="number">0xbd</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8a</span>, <span class="number">0x6b</span>,</span><br><span class="line">  <span class="number">0x3a</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4f</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0xea</span>, <span class="number">0x97</span>, <span class="number">0xf2</span>, <span class="number">0xcf</span>, <span class="number">0xce</span>, <span class="number">0xf0</span>, <span class="number">0xb4</span>, <span class="number">0xe6</span>, <span class="number">0x73</span>,</span><br><span class="line">  <span class="number">0x96</span>, <span class="number">0xac</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xe2</span>, <span class="number">0xf9</span>, <span class="number">0x37</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0x75</span>, <span class="number">0xdf</span>, <span class="number">0x6e</span>,</span><br><span class="line">  <span class="number">0x47</span>, <span class="number">0xf1</span>, <span class="number">0x1a</span>, <span class="number">0x71</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>, <span class="number">0x6f</span>, <span class="number">0xb7</span>, <span class="number">0x62</span>, <span class="number">0x0e</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0xbe</span>, <span class="number">0x1b</span>,</span><br><span class="line">  <span class="number">0xfc</span>, <span class="number">0x56</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0xc6</span>, <span class="number">0xd2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9a</span>, <span class="number">0xdb</span>, <span class="number">0xc0</span>, <span class="number">0xfe</span>, <span class="number">0x78</span>, <span class="number">0xcd</span>, <span class="number">0x5a</span>, <span class="number">0xf4</span>,</span><br><span class="line">  <span class="number">0x1f</span>, <span class="number">0xdd</span>, <span class="number">0xa8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xc7</span>, <span class="number">0x31</span>, <span class="number">0xb1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>,</span><br><span class="line">  <span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7f</span>, <span class="number">0xa9</span>, <span class="number">0x19</span>, <span class="number">0xb5</span>, <span class="number">0x4a</span>, <span class="number">0x0d</span>, <span class="number">0x2d</span>, <span class="number">0xe5</span>, <span class="number">0x7a</span>, <span class="number">0x9f</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x9c</span>, <span class="number">0xef</span>,</span><br><span class="line">  <span class="number">0xa0</span>, <span class="number">0xe0</span>, <span class="number">0x3b</span>, <span class="number">0x4d</span>, <span class="number">0xae</span>, <span class="number">0x2a</span>, <span class="number">0xf5</span>, <span class="number">0xb0</span>, <span class="number">0xc8</span>, <span class="number">0xeb</span>, <span class="number">0xbb</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">  <span class="number">0x17</span>, <span class="number">0x2b</span>, <span class="number">0x04</span>, <span class="number">0x7e</span>, <span class="number">0xba</span>, <span class="number">0x77</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>, <span class="number">0xe1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0c</span>, <span class="number">0x7d</span> &#125;;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> key[] = &#123;<span class="number">0x43</span>, <span class="number">0x72</span>, <span class="number">0x79</span>, <span class="number">0x70</span>, <span class="number">0x74</span>, <span class="number">0x6f</span>, <span class="number">0x46</span>, <span class="number">0x41</span>, <span class="number">0x49</span>, <span class="number">0x4c</span>, <span class="number">0x55</span>, <span class="number">0x52</span>, <span class="number">0x45</span>, <span class="number">0x66</span>, <span class="number">0x6f</span>, <span class="number">0x72</span>, <span class="number">0x52</span>, <span class="number">0x53</span>, <span class="number">0x41</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x34</span>, <span class="number">0x38</span>, <span class="number">0x4b</span>, <span class="number">0x65</span>, <span class="number">0x79</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0xbf</span>, <span class="number">0x8f</span>, <span class="number">0x84</span>, <span class="number">0x8d</span>, <span class="number">0xcb</span>, <span class="number">0xe0</span>, <span class="number">0xc2</span>, <span class="number">0xcc</span>, <span class="number">0x82</span>, <span class="number">0xac</span>, <span class="number">0x97</span>, <span class="number">0x9e</span>, <span class="number">0xc7</span>, <span class="number">0xca</span>, <span class="number">0xf8</span>, <span class="number">0xec</span>, <span class="number">0x94</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0xfc</span>, <span class="number">0xa4</span>, <span class="number">0x13</span>, <span class="number">0x38</span>, <span class="number">0xb7</span>, <span class="number">0xc1</span>, <span class="number">0x6a</span>, <span class="number">0x19</span>, <span class="number">0x96</span>, <span class="number">0xe0</span>, <span class="number">0x4b</span>, <span class="number">0x38</span>, <span class="number">0xb7</span>, <span class="number">0x0e</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>, <span class="number">0x6c</span>, <span class="number">0xc5</span>, <span class="number">0x68</span>, <span class="number">0xef</span>, <span class="number">0xa0</span>, <span class="number">0x47</span>, <span class="number">0xc4</span>, <span class="number">0x78</span>, <span class="number">0x3e</span>, <span class="number">0x80</span>, <span class="number">0x0e</span>, <span class="number">0x80</span>, <span class="number">0xd2</span>, <span class="number">0x59</span>, <span class="number">0x8c</span>, <span class="number">0xcd</span>, <span class="number">0x49</span>, <span class="number">0xfd</span>, <span class="number">0x9f</span>, <span class="number">0xf5</span>, <span class="number">0xfe</span>, <span class="number">0x3c</span>, <span class="number">0xf5</span>, <span class="number">0xec</span>, <span class="number">0x68</span>, <span class="number">0xdc</span>, <span class="number">0xbe</span>, <span class="number">0xd4</span>, <span class="number">0xdf</span>, <span class="number">0xa4</span>, <span class="number">0xc0</span>, <span class="number">0xb3</span>, <span class="number">0xea</span>, <span class="number">0x61</span>, <span class="number">0xa8</span>, <span class="number">0x5c</span>, <span class="number">0x4a</span>, <span class="number">0x26</span>, <span class="number">0x6c</span>, <span class="number">0x24</span>, <span class="number">0x74</span>, <span class="number">0xa6</span>, <span class="number">0x62</span>, <span class="number">0xa4</span>, <span class="number">0xa6</span>, <span class="number">0x7d</span>, <span class="number">0x26</span>, <span class="number">0x84</span>, <span class="number">0x6d</span>, <span class="number">0x80</span>, <span class="number">0xb9</span>, <span class="number">0x71</span>, <span class="number">0x93</span>, <span class="number">0xbc</span>, <span class="number">0x4c</span>, <span class="number">0x9d</span>, <span class="number">0xfb</span>, <span class="number">0x60</span>, <span class="number">0xf2</span>, <span class="number">0x49</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0xfb</span>, <span class="number">0x85</span>, <span class="number">0x3a</span>, <span class="number">0x44</span>, <span class="number">0x53</span>, <span class="number">0xd9</span>, <span class="number">0x70</span>, <span class="number">0x62</span>, <span class="number">0x3f</span>, <span class="number">0xfd</span>, <span class="number">0x04</span>, <span class="number">0xc4</span>, <span class="number">0x5d</span>, <span class="number">0x59</span>, <span class="number">0xa2</span>, <span class="number">0x61</span>, <span class="number">0x6a</span>, <span class="number">0x4f</span>, <span class="number">0x57</span>, <span class="number">0xe1</span>, <span class="number">0xd3</span>, <span class="number">0x3e</span>, <span class="number">0xc4</span>, <span class="number">0x5d</span>, <span class="number">0x9f</span>, <span class="number">0xa3</span>, <span class="number">0x3f</span>, <span class="number">0x3d</span>, <span class="number">0x6d</span>, <span class="number">0xea</span>, <span class="number">0x1b</span>, <span class="number">0x09</span>, <span class="number">0x7c</span>, <span class="number">0x2a</span>, <span class="number">0x1d</span>, <span class="number">0x4d</span>, <span class="number">0x2f</span>, <span class="number">0xf3</span>, <span class="number">0x6d</span>, <span class="number">0x2f</span>, <span class="number">0x10</span>, <span class="number">0x0e</span>, <span class="number">0x69</span>, <span class="number">0xeb</span>, <span class="number">0x4d</span>, <span class="number">0x57</span>, <span class="number">0xcb</span>, <span class="number">0x88</span>, <span class="number">0x89</span>, <span class="number">0x14</span>, <span class="number">0x48</span>, <span class="number">0x69</span>, <span class="number">0x5a</span>, <span class="number">0x2a</span>, <span class="number">0x8c</span>, <span class="number">0x34</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>, <span class="number">0xb3</span>, <span class="number">0x09</span>, <span class="number">0xa8</span>, <span class="number">0x63</span>, <span class="number">0xa8</span>, <span class="number">0xeb</span>, <span class="number">0x87</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xa8</span>, <span class="number">0x1b</span>, <span class="number">0x71</span>, <span class="number">0x89</span>, <span class="number">0xb8</span>, <span class="number">0x15</span>, <span class="number">0x18</span>, <span class="number">0x62</span>, <span class="number">0xf5</span>, <span class="number">0x42</span>, <span class="number">0xd3</span>, <span class="number">0x22</span>, <span class="number">0x6f</span>, <span class="number">0x38</span>, <span class="number">0x2e</span>, <span class="number">0x4b</span>, <span class="number">0x35</span>, <span class="number">0x12</span>, <span class="number">0xa2</span>, <span class="number">0x7f</span>, <span class="number">0xf0</span>, <span class="number">0x9b</span>, <span class="number">0x11</span>, <span class="number">0x76</span>, <span class="number">0x58</span>, <span class="number">0xf8</span>, <span class="number">0xb9</span>, <span class="number">0xc1</span>, <span class="number">0xc6</span>, <span class="number">0xbe</span>, <span class="number">0x24</span>, <span class="number">0x67</span>, <span class="number">0x6e</span>, <span class="number">0xa5</span>, <span class="number">0x55</span>, <span class="number">0xee</span>, <span class="number">0xd6</span>, <span class="number">0xb0</span>, <span class="number">0x4d</span>, <span class="number">0x8c</span>, <span class="number">0x23</span>, <span class="number">0xf2</span>, <span class="number">0x9e</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">xtime</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ((x&lt;&lt;<span class="number">1</span>) ^ (((x&gt;&gt;<span class="number">7</span>) &amp; <span class="number">1</span>) * <span class="number">0x1b</span>))&amp;<span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">Multiply</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> x, <span class="keyword">unsigned</span> <span class="keyword">char</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (((y &amp; <span class="number">1</span>) * x) ^</span><br><span class="line">       ((y&gt;&gt;<span class="number">1</span> &amp; <span class="number">1</span>) * xtime(x)) ^</span><br><span class="line">       ((y&gt;&gt;<span class="number">2</span> &amp; <span class="number">1</span>) * xtime(xtime(x))) ^</span><br><span class="line">       ((y&gt;&gt;<span class="number">3</span> &amp; <span class="number">1</span>) * xtime(xtime(xtime(x)))) ^</span><br><span class="line">       ((y&gt;&gt;<span class="number">4</span> &amp; <span class="number">1</span>) * xtime(xtime(xtime(xtime(x)))))); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InvMixColumns</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> a, b, c, d;</span><br><span class="line">   </span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">  &#123; </span><br><span class="line">    a = state[<span class="number">4</span>*i];</span><br><span class="line">    b = state[<span class="number">4</span>*i+<span class="number">1</span>];</span><br><span class="line">    c = state[<span class="number">4</span>*i+<span class="number">2</span>];</span><br><span class="line">    d = state[<span class="number">4</span>*i+<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    state[<span class="number">4</span>*i] = Multiply(a, <span class="number">0x0e</span>) ^ Multiply(b, <span class="number">0x0b</span>) ^ Multiply(c, <span class="number">0x0d</span>) ^ Multiply(d, <span class="number">0x09</span>);</span><br><span class="line">    state[<span class="number">4</span>*i+<span class="number">1</span>] = Multiply(a, <span class="number">0x09</span>) ^ Multiply(b, <span class="number">0x0e</span>) ^ Multiply(c, <span class="number">0x0b</span>) ^ Multiply(d, <span class="number">0x0d</span>);</span><br><span class="line">    state[<span class="number">4</span>*i+<span class="number">2</span>] = Multiply(a, <span class="number">0x0d</span>) ^ Multiply(b, <span class="number">0x09</span>) ^ Multiply(c, <span class="number">0x0e</span>) ^ Multiply(d, <span class="number">0x0b</span>);</span><br><span class="line">    state[<span class="number">4</span>*i+<span class="number">3</span>] = Multiply(a, <span class="number">0x0b</span>) ^ Multiply(b, <span class="number">0x0d</span>) ^ Multiply(c, <span class="number">0x09</span>) ^ Multiply(d, <span class="number">0x0e</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun_xor</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">unsigned</span> <span class="keyword">char</span> *enc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">		enc[i] ^= key[k*<span class="number">16</span> + i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InvShift</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(j = <span class="number">1</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(s &lt; j)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> tmp = a1[<span class="number">4</span>*<span class="number">3</span>+j];</span><br><span class="line">			<span class="keyword">for</span>(i = <span class="number">3</span>; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">				a1[<span class="number">4</span>*i+j] = a1[<span class="number">4</span>*(i<span class="number">-1</span>)+j];</span><br><span class="line">			a1[j] = tmp;</span><br><span class="line">			s++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InvSub</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">		p[i] = rsbox[p[i]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> a[] = &#123;<span class="number">0x91</span>, <span class="number">0xb3</span>, <span class="number">0xc1</span>, <span class="number">0xeb</span>, <span class="number">0x14</span>, <span class="number">0x5d</span>, <span class="number">0xd5</span>, <span class="number">0xce</span>, <span class="number">0x3a</span>, <span class="number">0x1d</span>, <span class="number">0x30</span>, <span class="number">0xe4</span>, <span class="number">0x70</span>, <span class="number">0x6c</span>, <span class="number">0x6b</span>, <span class="number">0xd7</span>, <span class="number">0x69</span>, <span class="number">0x78</span>, <span class="number">0x79</span>, <span class="number">0x02</span>, <span class="number">0xa3</span>, <span class="number">0xa5</span>, <span class="number">0xdf</span>, <span class="number">0x1b</span>, <span class="number">0xfd</span>, <span class="number">0x1c</span>, <span class="number">0x02</span>, <span class="number">0x89</span>, <span class="number">0x14</span>, <span class="number">0x20</span>, <span class="number">0x7a</span>, <span class="number">0xfd</span>, <span class="number">0x24</span>, <span class="number">0x52</span>, <span class="number">0xf8</span>, <span class="number">0xa9</span>, <span class="number">0xf9</span>, <span class="number">0xf1</span>, <span class="number">0x6b</span>, <span class="number">0x1c</span>, <span class="number">0x0f</span>, <span class="number">0x5d</span>, <span class="number">0x50</span>, <span class="number">0x5b</span>, <span class="number">0xec</span>, <span class="number">0x42</span>, <span class="number">0xd1</span>, <span class="number">0x8c</span>, <span class="number">0xb8</span>, <span class="number">0x12</span>, <span class="number">0xcf</span>, <span class="number">0x2c</span>, <span class="number">0xa9</span>, <span class="number">0x69</span>, <span class="number">0x31</span>, <span class="number">0x46</span>, <span class="number">0xfd</span>, <span class="number">0x9b</span>, <span class="number">0xea</span>, <span class="number">0xde</span>, <span class="number">0xc8</span>, <span class="number">0xbf</span>, <span class="number">0x94</span>, <span class="number">0x69</span>&#125;;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *p = a+<span class="number">48</span>, *p1;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> iv[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		fun_xor(<span class="number">0xe</span>, p);</span><br><span class="line">		<span class="keyword">for</span>(j = <span class="number">13</span>; ; j--)</span><br><span class="line">		&#123;</span><br><span class="line">			InvShift(p);</span><br><span class="line">			InvSub(p);</span><br><span class="line">			fun_xor(j, p);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span>(j == <span class="number">0</span>)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			InvMixColumns(p);	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(i != <span class="number">3</span>)</span><br><span class="line">			p1 = p<span class="number">-16</span>;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			p1 = iv;</span><br><span class="line">		<span class="keyword">for</span>(k = <span class="number">0</span>; k &lt; <span class="number">16</span>; k++)</span><br><span class="line">		&#123;</span><br><span class="line">			p[k] ^= p1[k];</span><br><span class="line">		&#125;</span><br><span class="line">		p = p1;</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%c"</span>, a[i]);</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">//hgame&#123;cOsm0s_is_still_fight1ng_and_NEVER_GIVE_UP_O0o0o0oO00o00o&#125;</span></span><br></pre></td></tr></table></figure><p>其实写好逆过程后，开始一直解不来，后面一个一个排查再发现是密文找错了，<strong>再次被从ida的伪代码来看变量的值坑到</strong>。。。</p><p><strong>另外这个aes加密并没有魔改的，后面我又用python的aes模块解了一下，同样解出。。那现在问题就是移位和混合的方向的问题（这里先留一下），后面再好好学习一下。至于块长度和密钥长度是没关系的。</strong></p><p>最后就总结一下aes加密的大概：</p><blockquote><ol><li><strong>重复轮：128位密钥一般重复执行9次，192位密钥一般重复执行11次，256位密钥一般重复执行13次。</strong></li><li><strong>重复轮每轮重复的操作包括：字节替换、行移位、列混乱、轮密钥加。</strong></li><li><strong>在aes中块长度与都是128位，与密钥长度无关。</strong></li><li><strong>每执行一块的加密操作，开始是一个初始轮（与初始密钥异或），然后重复轮，最后一个最终轮（除开列混混合操作）。</strong></li></ol></blockquote><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Base全家福"><a href="#Base全家福" class="headerlink" title="Base全家福"></a>Base全家福</h3><p>从每一步骤后的字符组成可以容易辨认出来。</p><p>base64，base32，base16</p><h3 id="不起眼压缩包的养成的方法"><a href="#不起眼压缩包的养成的方法" class="headerlink" title="不起眼压缩包的养成的方法"></a>不起眼压缩包的养成的方法</h3><p>从图片最后看到一个压缩包和提示密码是图片id。</p><p><a href="https://saucenao.com/" target="_blank" rel="noopener">https://saucenao.com/</a> 上这个网站查该图片的id。</p><p>解压后得到plain.zip和NO PASSWORD.txt，而plain.zip又要密码，看了一下里面的文件，发现也有一个NO PASSWORD.txt文件，它们crc32值。</p><p>这由此想到应该是明文攻击了，而明文攻击有一个条件，2个文件的压缩方式要相同，这在NO PASSWORD.txt中有提示。</p><p><img src="https://i.loli.net/2021/02/27/GRqjEDtQSy2rYsb.png" alt="image-20210204222714426"></p><p>明文攻击得到密码：</p><p><img src="https://i.loli.net/2021/02/27/oYBRAm6M51IbNpl.png" alt="image-20210204222741818"></p><p>最后打开flag文件，是实体编码 entity code，用html写处一个标题让浏览器解析它。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&amp;#x68;&amp;#x67;&amp;#x61;&amp;#x6D;&amp;#x65;&amp;#x7B;&amp;#x32;&amp;#x49;&amp;#x50;&amp;#x5F;&amp;#x69;&amp;#x73;&amp;#x5F;&amp;#x55;&amp;#x73;&amp;#x65;&amp;#x66;&amp;#x75;&amp;#x31;&amp;#x5F;&amp;#x61;&amp;#x6E;&amp;#x64;&amp;#x5F;&amp;#x4D;&amp;#x65;&amp;#x39;&amp;#x75;&amp;#x6D;&amp;#x69;&amp;#x5F;&amp;#x69;&amp;#x35;&amp;#x5F;&amp;#x57;&amp;#x30;&amp;#x72;&amp;#x31;&amp;#x64;&amp;#x7D;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/02/27/PXbVClN4UeKqJwj.png" alt="image-20210204223003807"></p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>Post author:</strong> ooo</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="https://bxb0.github.io/2021/02/04/HGAME%202021/" title="HGAME 2021">https://bxb0.github.io/2021/02/04/HGAME 2021/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally.</li></ul></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-item"><a href="/2021/02/01/2021%E4%B8%80%E6%9C%88DASCTF%E6%9A%A8HWS%E7%A1%AC%E4%BB%B6%E5%86%AC%E4%BB%A4%E8%90%A5%E9%80%89%E6%8B%94%E8%B5%9B/" rel="prev" title="2021一月DASCTF暨HWS硬件冬令营选拔赛"><i class="fa fa-chevron-left"></i> 2021一月DASCTF暨HWS硬件冬令营选拔赛</a></div><div class="post-nav-item"> <a href="/2021/02/05/Andriod%E5%88%B7%E9%A2%98%E5%AD%A6%E4%B9%A0/" rel="next" title="Andriod之CTF学习">Andriod之CTF学习<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Re"><span class="nav-number">1.</span> <span class="nav-text">Re</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#apacha"><span class="nav-number">1.1.</span> <span class="nav-text">apacha</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#helloRe"><span class="nav-number">1.2.</span> <span class="nav-text">helloRe</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pypy"><span class="nav-number">1.3.</span> <span class="nav-text">pypy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ezApk"><span class="nav-number">1.4.</span> <span class="nav-text">ezApk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#helloRe2"><span class="nav-number">1.5.</span> <span class="nav-text">helloRe2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fake-debugger-beta"><span class="nav-number">1.6.</span> <span class="nav-text">fake_debugger beta</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gun"><span class="nav-number">1.7.</span> <span class="nav-text">gun</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FAKE"><span class="nav-number">1.8.</span> <span class="nav-text">FAKE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#helloRe3"><span class="nav-number">1.9.</span> <span class="nav-text">helloRe3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vm"><span class="nav-number">1.10.</span> <span class="nav-text">vm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#A-5-Second-Challenge"><span class="nav-number">1.11.</span> <span class="nav-text">A 5 Second Challenge</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nllvm"><span class="nav-number">1.12.</span> <span class="nav-text">nllvm</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Misc"><span class="nav-number">2.</span> <span class="nav-text">Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Base全家福"><span class="nav-number">2.1.</span> <span class="nav-text">Base全家福</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#不起眼压缩包的养成的方法"><span class="nav-number">2.2.</span> <span class="nav-text">不起眼压缩包的养成的方法</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">ooo</p><div class="site-description" itemprop="description">0x446e37fb</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">46</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">15</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">3</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://i0gan.cn:81/" title="http:&#x2F;&#x2F;i0gan.cn:81&#x2F;" rel="noopener" target="_blank">i0gan</a></li><li class="links-of-blogroll-item"> <a href="https://hack-for.fun/" title="https:&#x2F;&#x2F;hack-for.fun&#x2F;" rel="noopener" target="_blank">M0nk3y</a></li><li class="links-of-blogroll-item"> <a href="http://happi0.gitee.io/" title="http:&#x2F;&#x2F;happi0.gitee.io&#x2F;" rel="noopener" target="_blank">happi0</a></li><li class="links-of-blogroll-item"> <a href="https://vino0o0o.github.io/" title="https:&#x2F;&#x2F;vino0o0o.github.io&#x2F;" rel="noopener" target="_blank">Vino0o0o</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">ooo</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i></span> <span class="post-meta-item-text">Symbols count total:</span> <span title="Symbols count total">371k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">Reading time total &asymp;</span> <span title="Reading time total">5:38</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script type="text/javascript" src="/js/src/clicklove.js"></script><script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"left",width:150,height:300},mobile:{show:!0},log:!1})</script></body></html>